window.require=function(){function require(name){var matches=require.lookup(name);if(!matches.length)throw new Error('failed to require "'+name+'"');var results={};for(var i in matches){var moduleName=matches[i],module=require.modules[moduleName];if(!("exports"in module)&&typeof module.definition==="function"){module.exports={};module.client=module.component=true;module.definition.call(this,module.exports,module,requireRelative.bind(this,moduleName))}results[moduleName]=module.exports}if(matches.length==1){return results[matches[0]]}return results}function requireRelative(parent,name){return require(resolve(parent,name))}require.requireRelative=requireRelative;require.lookup=function(name){var matches=[];if(!name.match(/\.js$/i)){name+=".js"}for(var m in require.modules){if(glob.match(name,m)){matches.push(m)}}return matches};require.modules={};require.register=function(name,definition){require.modules[name]={definition:definition}};require.define=function(name,exports){require.modules[name]={exports:exports}};require.resolve=resolve;function resolve(){var root="",leaf="",parents=[],children=[],_separator="/";for(var i=0,ii=arguments.length;i<ii;i++){var path=String(arguments[i]);if(""==path)continue;var parts=path.split(_separator);if(_isAbsolute(path)){root=parts.shift()+_separator;parents=[];children=[]}leaf=parts.pop();if("."===leaf||".."===leaf){parts.push(leaf);leaf=""}for(var j=0,jj=parts.length;j<jj;j++){var part=parts[j];if(".."===part){if(0!==children.length)children.pop();else if(!root)parents.push("..")}else if("."!==part&&""!==part)children.push(part)}}path=parents.concat(children).join(_separator);if(path)leaf=_separator+leaf;return root+path+leaf}function _isAbsolute(path){var parts=path.split("/"),head=parts[0];return parts.length==0?false:""===head||_isDrive(head)}function _isDrive(path){return path.indexOf(":")===--path.length}function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var glob=function(){var caches={};var make=function(str){if(caches[str]){return caches[str]}var reg=str.replace(/[.+^$()|{}]/g,function(match,offset,s){return s[offset-1]==="\\"?match:"\\"+match});reg=reg.replace(/[?*]/g,function(match,offset,s){if(s[offset-1]==="\\"){return match}return match==="?"?".":".*"});reg=reg.replace(/\\([dDsSwWtrnvfbB0cxu])/g,"$1");return caches[str]=new RegExp("^"+reg+"$")};var match=function(pattern,str){return str.match(typeof pattern==="string"?make(pattern):pattern)};return{make:make,match:match}}();return require}();window.require.register("/js/loggers.js",function(exports,module,require){var config=require("/js/config");function rewriteConsole(){var origs={},types=["log","error","warn","debug","info","group","end","groupEnd"],sret=true,noop=function(){};window.srat=function(){if(sret)return true;types.forEach(function(type){console[type]=origs[type]});sret=true;return true};window.neSrat=function(){if(!sret)return true;types.forEach(function(type){origs[type]=console[type];console[type]=noop});sret=false;return true};if(config.PROD&&!localStorage["srat"]){window.neSrat()}else{window.srat()}}rewriteConsole()});window.require.register("/js/app.js",function(exports,module,require){var route=require("/js/route"),promotions=require("/js/promotions"),config=require("/js/config"),docs=require("/js/docs"),storage=require("/js/local-storage"),user=require("/js/user"),notification=require("/component/editor/notification/notification"),tracking=require("/js/tracking/tracking"),isIframe=window.top!=window;var me={run:run};Vue.template=function(name){return Vue.component(name,{template:Handlebars.partials[name]()})};Vue.config({delimiters:["[","]"]});require("/component/common/*.js");require("/component/editor/*.js");require("/component/page/apps/*.js");require("/component/page/docs/*.js");require("/component/page/editor/*.js");require("/component/page/error/*.js");require("/component/page/free/*.js");require("/component/page/index/*.js");require("/component/page/popup2/*.js");require("/component/page/profile/*.js");require("/component/page/subscription/*.js");require("/component/page/util/*.js");module.exports=me;function run(){tracking.init();var href=document.location.href.replace(/m\/\//,"m/");if(href!=document.location.href){page(href)}me=new Vue({el:"body",data:{subSectionView:null,subView:null,mainView:null,currentRoute:null,mainLoading:true,dialogNotFound:false,username:"",user:{},document:{}},methods:{getDocument:getDocument,loading:loading,loaded:loaded,toDocument:function(doc){me.$document=doc;me.route.toDocument(doc.id)}}});me.$once("subview-load-start",loading);me.$once("subview-load-end",loaded);module.exports=me;me.route=route;route.init(me);initQApi(me);window.app=emitter(me);if(isIframe&&!testThirdPartyCookies()){me.blockedThirdParty=true;window.tracker.felog.event("blocked_third_party_cookie");window.top.postMessage({action:"removeSpinner"},"*");return}user.fetch(isIframe).then(onlogin,onerror);promotions(me)}function loaded(){me.mainLoading=false;me.$emit("app:loaded");$(".editor__loading_main").hide()}function loading(withoutTitle){me.mainLoading=true;me.withoutTitle=withoutTitle}function onlogin(){tracking.onlogin(me);user.isPhoenix()&&require("/custom/phoenix/phoenix")();if(user.$get("duplicateCookies"))me.$emit("track:duplicate-cookies");if(!user.canUseEditor())return route.toFree();if(user.isAnonymous()&&!isIframe)return route.toFunnel();me.docsApi=window.GrammarlyApi.Docs({token:user.$get("token"),docsUrl:config.DOCS_API_URL});var opts={path:"/",expires:100,domain:".grammarly.com"};if(user.isPremiumUser()){$.cookie("_premium",true,opts);$.removeCookie("_free",opts)}else{$.cookie("_free",true,opts);$.removeCookie("_premium",opts)}storage.save("haveToken",true);if(!config.PROD){capi.token=user.$get("token")}capi.clientVersion=config.PACKAGE_VERSION;capi.CLIENT_NAME=localStorage["capi-client-name"]||capi.CLIENT_NAME;me.username=user.$get("name");route.run();setTimeout(testSocket,4e3)}function onerror(e){var e=e||{};if(user.$get("duplicateCookies"))me.$emit("track:duplicate-cookies");_.extend(e,{missedToken:localStorage.haveToken=="true"&&!$.cookie("grauth"),returnAfterLogout:localStorage.haveToken=="false"&&!$.cookie("grauth")});if(!e.status||e.status==401){setTimeout(route.toFunnel,500);return window.tracker.felog.exception(new Error("User login error"),e)}window.tracker.felog.exception(new Error("Unknown backend error"),e);route.toError()}function testSocket(){var WebSocketClass=window.WebSocket||window.MozWebSocket,failCount=0;if(!WebSocketClass){trackSocketFail("Not supported or disabled websockets",true);return}testWebsocket();function testWebsocket(){var trackSocketFailTimer=setTimeout(testFail,5e3),socket=new WebSocketClass(config.CAPI_TEST_URL);socket.onmessage=function(){clearTimeout(trackSocketFailTimer);try{socket&&socket.close()}catch(e){console.log(e)}};socket.onerror=testFail;function testFail(e){clearTimeout(trackSocketFailTimer);socket&&socket.close();if(failCount>2){trackSocketFail(e)}else{failCount++;testWebsocket()}}}function trackSocketFail(e,notSupported){console.log("failed socket");e&&notification.show({message:"message_websocket_connect_error",autohide:false,sticky:true});me.$dispatch("track:websocket-test-failed",{isPopup:me.isPopup,byTimeout:!e,notSupported:notSupported})}}function getDocument(){if(me.$document&&me.$document.id==me.currentDocumentId)return $.Deferred().resolve(me.$document);return me.docsApi.get(me.currentDocumentId)}function initQApi(app){var promise;app.api={checkStatus:function(){promise=$.Deferred();me.$once("editor:finish-check",function(){promise.resolve({finish:true})});return promise}}}function testThirdPartyCookies(){try{localStorage.length;return true}catch(e){if(e&&e.name=="SecurityError"){return false}}}});window.require.register("/js/user.js",function(exports,module,require){var config=require("/js/config"),util=require("/js/util"),me,timeout=5e3,devToken=config.AUTH_USER&&config.AUTH_USER.token,auth=window.GrammarlyApi.Auth({authUrl:config.AUTH_SERVER_URL,dapiUrl:config.DAPI_URL,allowSetToken:!config.PROD}),subscription=window.GrammarlyApi.Irbis({irbisUrl:config.IRBIS_URL});if(devToken&&!config.PROD){auth.setToken(devToken)}var user=new Vue({isFn:true,data:{settings:{},dapiProps:{},paymentProfile:{}},created:function(){me=this},methods:{fetch:function(obj){var isIframe=obj.isIframe,userData=obj.userData;if(isIframe){me.extend(userData);return $.Deferred().resolve()}return me.fillUserData().then(function(){return $.when(me.fillMimic(),me.fillPaymentProfile(),me.fillDapiProps()).then(function getData(){return me.$data})}).fail(function(){return $.Deferred().reject()})},deleteAccount:function(){var storage=require("/js/local-storage");return subscription.deleteAccount().then(function(){storage.remove("seenWelcome");storage.save("haveToken",false);window.GR_EXTENSION_SEND&&window.GR_EXTENSION_SEND("cleanup")}).fail(me.logError)},login:function(data){return auth.login({email:data.email,password:data.password}).fail(me.logError)},setSettings:function(data){me.$set("settings",_.extend({},me.$get("settings")||{},data));return auth.setSettings(me.$get("settings")).then(function(settings){me.$set("settings",settings);return $.Deferred().resolve(settings)})},ackPremiumConversion:function(){subscription.ackPremiumConversion().then(function(){return $.Deferred().resolve()})},fillMimic:function(){var promise=$.Deferred(),timer=setTimeout(function(){me.logError({error:"requestTimeout"});promise.resolve()},timeout*2);auth.getMimic().then(function(data){data=data.groups||[];me.extend({mimic:data})}).fail(me.logError).always(function(){clearTimeout(timer);promise.resolve()});return promise},fillDapiProps:function(){var promise=$.Deferred(),timer=setTimeout(function(){me.logError({error:"requestTimeout"});promise.resolve()},timeout*2);var propName="dialectWeak";auth.getDapiProp(propName).then(function(data){me.extend({dapiProps:data})}).fail(me.logError).always(function(){clearTimeout(timer);promise.resolve()});return promise},setDapiProp:function(name,val){var newProps={};newProps[name]=val;me.$set("dapiProps",newProps);return auth.setDapiProp(name,val).then(function(){return $.Deferred().resolve(newProps)})},fillUserData:function(){var meta=window.tracker.gnar.meta(),data={containerId:meta&&meta.containerId||"",app:"editor"};var promise=$.Deferred(),timer=setTimeout(function(){me.logError({error:"requestTimeout"});promise.reject()},timeout*2);auth.getUser(data).then(function(data){if(data.anonymous)return promise.reject({status:401});me.extend(data);promise.resolve()}).fail(promise.reject).always(function(){clearTimeout(timer)});return promise},fillPaymentProfile:function(){var promise=$.Deferred(),timer=setTimeout(function(){me.logError({error:"requestTimeout"});promise.resolve()},timeout);subscription.status().then(function(data){me.$set("paymentProfile",data)}).fail(me.logError).always(function(){clearTimeout(timer);promise.resolve()});return promise},extend:function(data){var result={};$.extend(result,me.$data,data);me.$data=result},logError:function(e){window.tracker.felog.exception(new Error("User data request error"),e)},setUserData:auth.setUserData,ping:auth.ping,logout:function(){var route=require("/js/route"),storage=require("/js/local-storage");auth.logout().then(function(){storage.remove("seenWelcome");storage.save("haveToken",false);window.GR_EXTENSION_SEND&&window.GR_EXTENSION_SEND("cleanup");$.removeCookie("show-install-extension-later",{domain:".grammarly.com",path:"/"});$.removeCookie("GrammarlyReferral",{domain:".grammarly.com",path:"/"});if(util.isSafari()&&window.GR_EXTENSION_ID){auth.createAnonymous().then(function(res){route.toFunnel()})}else{route.toFunnel()}})},isMigration:function(){return me.$get("experiment.migration")||""},isPremiumUser:function(){return me.$get("type")=="Premium"||me.$get("paymentProfile.isPremium")},isPremiumNotFreeUser:function(){var isPremium=me.$get("type")=="Premium"||me.$get("paymentProfile.isPremium");var isNotFree=!me.$get("subscriptionFree");return isPremium&&isNotFree},isUserInReferralGroup:function(){var groups=me.$get("groups");return groups&&groups.some(function(el){return el.indexOf("referral")>-1})},isPaymentMethodDefined:function(){return!!me.$get("paymentProfile.paymentMethod")},isFreebie:function(){return!!me.$get("paymentProfile.isFreebie")},isFree:function(){return!me.isPremiumUser()},isSampleRemoved:function(){return me.$get("settings.sample")=="removed"},canUseEditor:function(){return me.$get("type")=="Premium"||me.$get("freemium")},isAnonymous:function(){return me.$get("anonymous")==true},isNewBilling:function(){return me.$get("paymentProfile.usesNewBilling")},isInstitutionUser:function(){return me.$get("institutionId")&&typeof me.$get("institutionId")=="number"},isProofitVisible:function(){var isInstitutionProofit=me.$get("institutionProofit");return user.isPaymentMethodDefined()||user.free&&user.freemium||isInstitutionProofit&&!user.isPhoenix()},isPhoenix:function(){return/Phoenix University/i.test(me.$get("institutionName"))||/phoenix/i.test(document.location.search)},changeName:function(data){var promise=$.Deferred(),failFn=function(e){me.logError(e);promise.reject()},timer=setTimeout(failFn.bind(this,{error:"requestTimeout"}),timeout);auth.changeName(data).then(function(res){if(!res||!res.ok)return failFn();me.$set("name",data.name);promise.resolve()}).fail(failFn).always(function(){clearTimeout(timer)});return promise},changeEmail:function(data){var promise=$.Deferred(),failFn=function(e){me.logError(e);promise.reject()},timer=setTimeout(failFn.bind(this,{error:"requestTimeout"}),timeout);auth.changeEmail(data).then(function(res){if(!res||!res.ok)return failFn();promise.resolve();me.$set("newEmail",data.newEmail)}).fail(failFn).always(function(){clearTimeout(timer)});return promise},changePassword:function(data){var promise=$.Deferred(),failFn=function(e){me.logError(e);promise.reject()},timer=setTimeout(failFn.bind(this,{error:"requestTimeout"}),timeout);auth.changePassword(_.extend({email:me.$get("email")},data)).then(function(){promise.resolve()}).fail(failFn).always(function(){clearTimeout(timer)});return promise},getUnderlineType:function(){return{newUnderline:true,premiumUnderlineYellow:true}}}});module.exports=user});window.require.register("/js/route.js",function(exports,module,require){var currentPage,currentSection,currentSubSection,body=$("body"),app,config=require("/js/config"),dialog=require("/component/common/dialog/dialog"),detect=require("/detect/detect"),isIframe=window.top!=window;var me={run:run,init:init,url:url,go:go,toLogin:toLogin,toFunnel:toFunnel,toAccountDeleteConfirmation:toAccountDeleteConfirmation,toError:toError,toFree:toFree,toSubscription:toSubscription,toSubscriptionBilling:toSubscriptionBilling,toDocument:toDocument,to404:to404,toIndex:toIndex,toIndexHard:toIndexHard,toCancelled:toCancelled,configure:configure,getSearchParams:getSearchParams};var routes={"/":"index.docs","/profile":"index.profile","/profile/language":"index.profile.language","/profile/dictionary":"index.profile.dictionary","/profile/account":"index.profile.account","/apps":"index.apps","/free":"free","/popup2":"popup2","/subscription":"index.subscription","/subscription/downgrade":"index.subscription.downgrade","/subscription/cancelled":"index.subscription.cancelled","/subscription/cancel":"index.subscription.cancel","/subscription/manage":"index.subscription.manage","/subscription/billing":"index.subscription.billing","/subscription/summary":"index.subscription.summary","*":"index.docs"};function toCancelled(){page("/subscription/cancelled")}function toIndex(){page("/")}function toSubscription(){page("/subscription")}function toSubscriptionBilling(){page("/subscription/billing")}function toDocument(id){page("/docs/"+id);refreshDocView()}function toFunnel(){changeLocation(config.FUNNEL.MAIN)}function toAccountDeleteConfirmation(){changeLocation(config.FUNNEL.ACCOUNT_DELETED)}function toLogin(){changeLocation(config.FUNNEL.LOGIN+"?status=not_authorized")}function toIndexHard(){changeLocation(document.location.protocol+"//"+document.location.host)}function changeLocation(location){if(!isIframe){document.location=location}else{app.$dispatch("track:popup-unexpected-location",location)}}function toFree(){page("/free")}function toError(){go("error_500")()}function to404(){go("error_404")()}function getSearchParams(){return location.search}function init(_app){app=_app;page("/docs/:id",goToDoc);for(var url in routes){page(url,go(routes[url]))}}function run(){page()}function goToDoc(ctx){var id=ctx.params.id;app.currentDocumentId=id;app.getDocument().then(function(doc){go("editor")(ctx);refreshDocView();app.$dispatch("tooltip:tooltip-hide")},function(){toIndex();dialog.show(p("document_404"));app.loaded()})}function setBodyClass(page,section,subsection){body.removeClass(currentPage).removeClass(currentSection).removeClass(currentSubSection);body.addClass(page).addClass(section).addClass(subsection)}function go(state){return function(ctx){var page=state.split(".")[0],section=state.split(".")[1],subsection=state.split(".")[2];app.currentRoute=state;if(currentPage!=page){app.mainView=p(page)}if(currentSection!=section){app.subView=p(section)}if(currentSubSection!=subsection){app.subSectionView=subsection}setBodyClass(page,section,subsection);currentPage=page;currentSection=section;currentSubSection=subsection}}function url(state){for(var u in routes){if(routes[u]==state)return u}return""}function refreshDocView(){if(app.mainView==p("editor")){app.mainView=null;Vue.nextTick(function(){app.mainView=p("editor")})}}function p(name){return"editor__"+name}function configure(cfg){config=cfg}function getBrowserType(){var browser=detect.browser,version=typeof detect.version=="string"?parseInt(typeof detect.version)||0:detect.version,supported={chrome:37,opera:27,ie:10,safari:6,firefox:21},unknown=!supported[browser],old=version<supported[browser];if(unknown)return"unknown";else if(old)return"unsupported";else return"supported"}module.exports=me});window.require.register("/js/textarea-client.js",function(exports,module,require){var ot,savingTimer,otDrain,otUpdate;var me={create:create,save:save,release:release,ot:null};function disable(txt,isDisabled){$("#txtDoc, #textarea").prop("disabled",isDisabled)}function create(txt,id){var config=require("/js/config"),user=require("/js/user"),skipedFirst=false;ot=window.GrammarlyApi.Docs.OtClient({id:id,token:user.$get("token"),docsUrl:config.DOCS_API_URL_WS});ot.on("ready",function(){});ot.on("message",function(data){console.log("message",data)});ot.ws.on("error",function(data){me.emit("serviceState",{type:"dox",available:false})});ot.ws.on("reconnect",function(){me.emit("socketReconnect");me.emit("serviceState",{type:"dox",available:true})});ot.on("disconnect",function(){});ot.on("change",function(text,transformSelection){if(!skipedFirst){skipedFirst=true;return}var s=txt[0].selectionStart,e=txt[0].selectionEnd;me.emit("ot",text);var newSelection=transformSelection(s,e);txt[0].selectionStart=newSelection[0];txt[0].selectionEnd=newSelection[1]});otUpdate=_.throttle(ot.update,1e3);txt.data("ot",ot);_.extend(me,ot);return ot}function save(value){clearTimeout(savingTimer);if(otDrain){otDrain.un();otDrain=null}var saved=function(){otDrain=null};savingTimer=setTimeout(function(){if(ot.unstagedChanges.length){otDrain=ot.one("drain",saved);return}saved()},800);otUpdate(value)}function release(){ot&&ot.release()}module.exports=me});window.require.register("/js/persistence-monitor.js",function(exports,module,require){var navigationMsg="You have unsaved changes to your document due to a slow connection. Continue and discard your progress?",preventNavigation=false,closeAttemptTime;function showNavigationAlert(e){closeAttemptTime=+new Date;window.tracker.felog.info("dox_close_before_save");e.returnValue=navigationMsg}function setConfirmNavigation(){preventNavigation=true;window.addEventListener("beforeunload",showNavigationAlert)}function removeConfirmNavigation(){if(closeAttemptTime){window.tracker.felog.info("dox_save_after_close_attempt",{time:new Date-closeAttemptTime});closeAttemptTime=null}preventNavigation=false;window.removeEventListener("beforeunload",showNavigationAlert);console.info("DOX: Doc saved")}var drainTimeout;var clearDrainTimeout=function(){clearTimeout(drainTimeout)};exports.watch=function(ot,app){if(!ot)return;function check(){ot.un("send",clearDrainTimeout);clearDrainTimeout();drainTimeout=setTimeout(function(){removeConfirmNavigation()},500);ot.one("send",clearDrainTimeout)}setConfirmNavigation();ot.one("ready",removeConfirmNavigation);ot.on("drain",check);ot.on("send",setConfirmNavigation);return function(){ot.un("ready",removeConfirmNavigation);ot.un("drain",check);ot.un("send",setConfirmNavigation);ot.un("send",clearDrainTimeout);removeConfirmNavigation()}};exports.isNavigationAllowed=function isNavigationAllowed(){if(preventNavigation){return window.confirm(navigationMsg+"\n\nAre you sure you want to leave this page?")}return true}});window.require.register("/storage/client.js",function(exports,module,require){"use strict";var _toArray=function(arr){return Array.isArray(arr)?arr:Array.from(arr)};var CrossDomainStorage=function(){var CrossDomainStorage=function CrossDomainStorage(config){if(!config.origin)throw"URL is not specified";this.origin=config.origin;this.path=config.path||"/";this.url=this.origin+this.path;this.iframe=false;this.ready=false;this.queue=[];this.reqId=0;this.callbacks={};this.init()};CrossDomainStorage.prototype.init=function(){var _this=this;var iframe=document.createElement("iframe");iframe.src=this.url;iframe.style.cssText="position:absolute;width:1px;height:1px;left:-9999px;";document.body.appendChild(iframe);on(iframe,"load",function(){return _this._ready()});on(window,"message",function(event){return _this._onMessage(event)});this.iframe=iframe};CrossDomainStorage.prototype.set=function(data,cb){if(!data)return;this._send({method:"set",data:data},cb)};CrossDomainStorage.prototype.get=function(key,cb){key=key||"";this._send({method:"get",data:key},cb)};CrossDomainStorage.prototype.remove=function(key,cb){key=key||"";this._send({method:"remove",data:key},cb)};CrossDomainStorage.prototype._send=function(msg,cb){if(cb===undefined)cb=function(){return false};if(!this.ready)return this._queue(msg.method,[msg.data,cb]);this.reqId++;this.callbacks[this.reqId]=cb;msg.id=this.reqId;this.iframe.contentWindow.postMessage(JSON.stringify(msg),this.url)};CrossDomainStorage.prototype._queue=function(method,args){console.log("Queued: ",method,args);this.queue.push(arguments)};CrossDomainStorage.prototype._ready=function(){this.ready=true;if(!this.queue.length)return;for(var _iterator=this.queue[Symbol.iterator](),_step;!(_step=_iterator.next()).done;){var call=_step.value;var method=call[0];var args=call[1];if(!this[method])continue;this[method].apply(this,_toArray(args))}this.queue=[]};CrossDomainStorage.prototype._onMessage=function(event){if(this.origin!=event.origin)return;var msg;try{msg=JSON.parse(event.data)}catch(e){console.error("Error while parsing response from remote storage",e)}var cb=this.callbacks[msg.id];cb&&cb(msg.data);delete this.callbacks[msg.id]};return CrossDomainStorage}();module.exports=CrossDomainStorage;function on(el,event,cb){el.addEventListener(event,cb,false)}});window.require.register("/js/local-storage.js",function(exports,module,require){function save(key,obj){try{if(_.isString(obj)){localStorage[key]=obj;return}localStorage[key]=JSON.stringify(obj)}catch(e){if(e.code==22||e.code==21||e.code==1014){var keys=[];for(var k in localStorage){if(k.indexOf("matches_")!=0)continue;var saved=JSON.parse(localStorage[k]);keys.push({date:saved.date,key:k})}keys.sort(function(o1,o2){return o1.date-o2.date});if(keys.length==0)return console.log("localStorage is empty");console.log("remove matches from localStorage of doc ",keys[0].key);delete localStorage[keys[0].key];save(key,obj)}else{console.error("Local storage write failure - "+e)}}}function get(key){if(!key||!localStorage[key])return;var data;try{data=JSON.parse(localStorage[key])}catch(e){console.error("Local storage get failure - "+e)}return data}function remove(key){try{localStorage.removeItem(key)}catch(e){console.error("Local storage write failure - "+e)}}module.exports={save:save,get:get,remove:remove}});window.require.register("/js/docs.js",function(exports,module,require){var api,app,storage=require("/js/local-storage");var route=require("/js/route"),uploader=require("/js/uploader"),config=require("/js/config"),user=require("/js/user"),notification=require("/component/editor/notification/notification");require("/js/generated-demoDoc");var lazySaveToStorage=_.throttle(saveToStorage,1e3);module.exports={saveErrors:saveErrors,saveTitle:saveTitle,saveSettings:saveSettings,save:save,newDoc:newDoc,upload:upload,download:download,loadSettings:loadSettings,loadMatches:loadMatches,titleFromContent:titleFromContent,fixTabs:fixTabs,uploadWithProgress:uploadWithProgress};function save(data){api=api||require("/js/app").docsApi;return api.save(data).then(function(doc){if(!data.id){loadSettings(doc);return doc}})}function newDoc(){save({content:""}).then(function(doc){app=app||require("/js/app");app.toDocument(doc)})}function download(id,name){api=api||require("/js/app").docsApi;var isTrackDownload=!user.isPhoenix();api.download(id,name,isTrackDownload)}function saveSettings(doc,settings){var settings=settings||{};_.extend(doc.settings,settings);return save({id:doc.id,mongodb:doc.settings})}function saveContent(doc){return save({id:doc.id,content:doc.content})}function saveErrors(doc,matches,count){if(count!=doc.errors){doc.errors=count;save({errors:count,id:doc.id})}lazySaveToStorage(doc.id,matches)}function fixTabs(doc){var cl=doc.content.length;doc.content=doc.content.replace(/\t/g,"    ");if(cl<doc.content.length){saveContent(doc)}}function title(doc){if(doc.title)return doc.title;if(doc.content)return titleFromContent(doc.content);return""}function titleFromContent(text){var maxLength=25;text=text.trim().replace(/\s+/g," ");var shortText=text.substr(0,maxLength);if(text[maxLength]&&text[maxLength]!=" ")shortText=shortText.replace(/ \S*$/,"");return shortText.replace(/ \S{1,3}$/,"")}function saveTitle(doc){save({title:title(doc),id:doc.id})}function saveToStorage(id,matches){matches=matches.filter(function(m){return!m.syn});matches=matches.map(function(m){var result={};if(m.syn)return delete m;for(var p in m){if(p!="r"&&p!="origReplacements"&&p!="rHtml"&&p!="examples"&&p!="references"&&(_.isFunction(m[p])||_.isObject(m[p])||p=="selected"&&!_.isArray(m[p])&&p!="header"))continue;if(p=="ts"||p=="renderTs"||p=="tracked")continue;result[p]=m[p]}return result});storage.save("matches_"+id,{matches:matches,date:new Date,version:config.CARDS_VSN,userType:user.$data.type,dialectStrong:user.$data.settings.dialectStrong})}function loadMatches(doc){var saved=localStorage["matches_"+doc.id];doc.matches=[];if(saved){try{var saved=JSON.parse(saved);if(saved.version!=config.CARDS_VSN||saved.userType!=user.$data.type||saved.dialectStrong!=user.$data.settings.dialectStrong){delete localStorage["matches_"+doc.id];console.log("remove outdated matches");return}doc.matches=saved.matches}catch(e){delete localStorage["matches_"+doc.id];console.log("not valid json, remove matches")}}}function uploadWithProgress(config){var me=config.context;var pb=me.$.progressbar;var onsuccess=config.onsuccess||_f;var onerror=config.onerror||_f;pb.$once("progressbar-end",onend);upload({event:config.event,onsuccess:function(doc){pb.end();app.toDocument(doc);onsuccess(doc);onend()},onprogress:pb.onprogress.bind(pb),onstart:onstart,onend:onend,onerror:onerror});function onstart(){me.uploading=true;pb.start()}function onend(){me.uploading=false}}function upload(config){var defaults={onstart:_f,onprogress:_f,onsuccess:_f,onend:_f,onerror:_f};var doc;config=_.extend(defaults,config);app=app||require("/js/app");api=api||app.docsApi;var form=null;if(config.event){form=uploader.fromInput(config.event,config.onerror);config.event.target.value=""}if(config.files)form=uploader.fromFiles({files:config.files,onerror:config.onerror});doc=null;if(!form)return;config.onstart();api.upload({data:form,xhr:function(){var xhr=$.ajaxSettings.xhr();xhr.upload.addEventListener("progress",config.onprogress,false);return xhr}}).success(function(data){data=typeof data!=="object"?$.parseJSON(data):data;doc=data;loadSettings(doc);config.onsuccess(doc);notification.show("message_upload_success")}).error(function(xhr,status,error){var errorKey=xhr.status;if(xhr.status===413){errorKey="too_big"}else{try{doc=JSON.parse(xhr.responseText);errorKey=doc.status=="error"?doc.info:doc.status}catch(e){}}config.onend();config.onerror(errorKey);uploader.error(errorKey)})}function safeParseSettings(str){try{return JSON.parse(str)}catch(e){try{str=str.replace(/(:")(.*?)(","\S)/g,function(m,g1,g2,g3){return g1+g2.replace(/"/g,"'")+g3});return JSON.parse(str)}catch(e){window.tracker.felog.exception(e,{badString:str});return{}}}}function loadSettings(docs){if(!_.isArray(docs))docs=[docs];for(var i=0,l=docs.length;i<l;i++){if(docs[i].mongodb){docs[i].settings=safeParseSettings(docs[i].mongodb)}if(!docs[i].settings)docs[i].settings={}}}});window.require.register("/detect/detect.js",function(exports,module,require){var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";this.isBot=this.isBot(navigator.userAgent)},addClasses:function(){},operationSystem:function(){var OSName="unknownos",ver=navigator.appVersion;if(ver.indexOf("Win")!=-1)OSName="windows";if(ver.indexOf("Mac")!=-1)OSName="macos";if(ver.indexOf("X11")!=-1)OSName="unix";if(ver.indexOf("Linux")!=-1)OSName="linux";return OSName},searchString:function(data){for(var i=0;i<data.length;i++){var str=data[i].string,dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(str){var subStr=data[i].subString,isRe=subStr instanceof RegExp;if(!isRe&&str.indexOf(subStr)!=-1)return data[i].identity;if(isRe&&subStr.test(str))return data[i].identity}else if(dataProp){return data[i].identity}}},searchVersion:function(str){str=str.toLowerCase();var index=str.indexOf(this.versionSearchString.toLowerCase());if(index==-1)return;return parseFloat(str.substring(index+this.versionSearchString.length+1))},isBot:function(userAgent){return/bot|googlebot|crawler|spider|robot|crawling/i.test(userAgent)},dataBrowser:[{string:navigator.userAgent,subString:/Android.*Chrome.*\d+\s+Safari/,versionSearch:"Chrome/",identity:"tabletChrome"},{string:navigator.userAgent,subString:/Android.*Chrome.*Mobile/,versionSearch:"Chrome/",identity:"mobileChrome"},{string:navigator.userAgent,subString:"Chrome",identity:"chrome"},{string:navigator.userAgent,subString:"BB10",versionSearch:"Version/",identity:"mobileBlackberry"},{string:navigator.userAgent,subString:"PlayBook",versionSearch:"Version/",identity:"mobileBlackberry"},{string:navigator.userAgent,subString:"BlackBerry",versionSearch:"Version/",identity:"mobileBlackberry"},{string:navigator.userAgent,subString:/Android.*\d+\s+Safari/,versionSearch:"Version/",identity:"tabletAndroid"},{string:navigator.userAgent,subString:/Android.*Mobile.*/,versionSearch:"Version/",identity:"mobileAndroid"},{string:navigator.userAgent,subString:/iPad.*CriOS/,versionSearch:"Version/",identity:"tabletChrome"},{string:navigator.userAgent,subString:"CriOS",versionSearch:"CriOS/",identity:"mobileChrome"},{string:navigator.userAgent,subString:"iPad",versionSearch:"Version/",identity:"tabletSafari"},{string:navigator.userAgent,subString:"iPhone",versionSearch:"Version/",identity:"mobileSafari"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"omniWeb"},{string:navigator.userAgent,subString:"Safari",identity:"safari",versionSearch:"Version"},{prop:window.opera,identity:"opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"firefox"},{string:navigator.vendor,subString:"Camino",identity:"camino"},{string:navigator.userAgent,subString:"Netscape",identity:"netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"ie",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Trident",identity:"ie",versionSearch:"rv"},{string:navigator.userAgent,subString:"Gecko",identity:"mozilla",versionSearch:"rv"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"win"},{string:navigator.platform,subString:"Mac",identity:"mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"linux"}]};
BrowserDetect.init();if(typeof module!="undefined")module.exports=BrowserDetect});window.require.register("/js/generated-demoDoc.js",function(exports,module,require){!function(){var content=typeof DEMO_TEXT!="undefined"?DEMO_TEXT:require("config").DEMO_TEXT;window.DemoDoc={matches:[],errors:25,content:content,title:"Demo document",first_content:content.substr(0,250),id:0}}()});window.require.register("/js/uploader.js",function(exports,module,require){var notification=require("/component/editor/notification/notification"),maxFileSize=1048576*4;function getInputFileName(e){var fileArr=e.target.files,file=fileArr[0],fileName=file.name,fileNameParts=fileName.split("\\"),fileNamePartsLength=fileNameParts.length;return fileNameParts[fileNamePartsLength-1]}function fromInput(e,onerror){var name=getInputFileName(e);return fromFiles({files:e.target.files,name:name,onerror:onerror})}function error(type){notification.show("message_"+(type||"default"))}function fromFiles(config){var files=config.files,name=config.name,onerror=function(type){error(type);config.onerror&&config.onerror(type)};if(!files||!files.length)return onerror("internal_error");var file=files[0];if(name)file.name=name;if(file.size>maxFileSize)return onerror("too_big");if(!file.size)return onerror("empty_file");var formData=new FormData;formData.append("source_file",file);return formData}module.exports={fromInput:fromInput,fromFiles:fromFiles,error:error}});window.require.register("/js/promotions.js",function(exports,module,require){var tutorial=require("/component/editor/tour/tutorial")(),tour=require("/component/editor/tour/tour")(),docs=require("/js/docs"),_app;module.exports=function(app){_app=app;app.$on("track:tutorial",tutorial.init);app.$on("track:docs-created",docsCreated);app.$on("track:document-open",documentOpen);app.$on("app:loaded",appLoaded);require("/js/upgrade")(app)};function documentOpen(doc){tour.welcome();if(!doc||!doc.content)return}function docsCreated(){tour.onDocsEnter()}function appLoaded(){if(window.parent!=window){tour.welcomeLite()}}});window.require.register("/js/upgrade.js",function(exports,module,require){var _app;module.exports=function(app){_app=app;app.$on("track:hook-clicked",hookClicked)};function hookClicked(data){var placement=data.placement||"";var matches=data.matches||[];var config=require("/js/config"),user=require("/js/user");_app.loading(true);var url=GrammarlyEditor.getUpgradeUrlFromMatches({baseUrl:config.FUNNEL.UPGRADE,returnUrl:document.location.href,appType:_app.isPopup?"popup":"app",matches:matches,queryParams:{page:"free"}});if(window.parent==window){setTimeout(function(){document.location.href=url},300)}else{if(window.chrome&&chrome.runtime){if(window.GR_EXTENSION_ID)chrome.runtime.sendMessage(GR_EXTENSION_ID,{openUrl:url,placement:placement})}window.top.postMessage({grammarly:true,action:"open-url",url:url,placement:placement},"*")}}});window.require.register("/js/util.js",function(exports,module,require){var detect=require("/detect/detect");var sfh=require("superfasthash/index");module.exports={guid:guid,wordCount:wordCount,svg:svg,docHidden:docHidden,declension:declension,isMac:isMac,isMobile:isMobile,isWindows:isWindows,isChrome:isChrome,isSafari:isSafari,utf_remove_low_surrogate:utf_remove_low_surrogate,DialogHeight:DialogHeight,normalizedHashCode:normalizedHashCode};function isWindows(){return detect.OS=="win"}function isChrome(){return detect.browser=="chrome"}function isSafari(){return detect.browser=="safari"}function S4(){return((1+Math.random())*65536|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}function wordCount(text){if(!text)return 0;var words=text.replace(/[\W\d]/gi," ").trim().replace(/\s+/gi," ").split(" ");return words.length===1&&words[0]===""?0:words.length}function utf_remove_low_surrogate(string){var output=[],counter=0,length=string.length,value,c,extra;while(counter<length){value=string.charCodeAt(counter++);c=String.fromCharCode(value);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){}else{output.push(c);counter--}}else{output.push(c)}}return output.join("")}function svg(name,attrs,container){var ns="http://www.w3.org/2000/svg";var obj=arguments[0];var el;if(typeof obj=="object"){el=svg(obj.tag,obj.attrs,obj.parent);var nodes=obj.childNodes||[];for(var i=0;i<nodes.length;i++){nodes[i].parent=$(el);svg(nodes[i])}return el}el=document.createElementNS(ns,name);for(var prop in attrs){el.setAttribute(prop,attrs[prop])}$(container)[0].appendChild(el);return el}function interval(cb,time){var items=interval.items=interval.items||{},item=items[cb];if(!item&&!time)return;if(item&&!time){clearTimeout(item);delete items[cb];return}else run();function run(){function _cb(){timeout();cb()}function timeout(){var tid=setTimeout(_cb,time);items[cb]=tid}timeout()}}function cancelInterval(cb){interval(cb)}_f=function(){};function docHidden(doc){if(typeof doc.hidden!=="undefined")return doc.hidden;if(typeof doc.mozHidden!=="undefined")return doc.mozHidden;if(typeof doc.webkitHidden!=="undefined")return doc.webkitHidden;if(typeof doc.msHidden!=="undefined")return doc.msHidden;return false}function visibilityEvent(doc){if(typeof doc.hidden!=="undefined")return"visibilitychange";if(typeof doc.mozHidden!=="undefined")return"mozvisibilitychange";if(typeof doc.webkitHidden!=="undefined")return"webkitvisibilitychange";if(typeof doc.msHidden!=="undefined")return"msvisibilitychange";return false}function declension(value,arr){return arr[value>1?1:0]}function isMac(){return navigator.platform?navigator.platform=="MacIntel":/(Mac_PowerPC|Macintosh)/.test(navigator.userAgent)}function isMobile(userAgent){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(userAgent.substr(0,4))}function DialogHeight(el,padding){var win=$(window),el=$(el);function start(){win.on("resize",onresize)}function stop(){win.off("resize",onresize)}function onresize(){var winH=win.height()-padding;var elH=el[0].scrollHeight;if(elH>winH)elH=winH;el.css("height",elH)}start();onresize();onresize();return{stop:stop,start:start}}function normalizedHashCode(str,base){if(!base)base=100;if(!str)return NaN;return parseInt(sfh.hash(str),16)%base}});window.require.register("/js/referral_util.js",function(exports,module,require){var user=require("/js/user");function prefix(){var beginPath="referral";var cta=user.$get("settings.002_referral.ctaClicked");var isOldCtaExist=cta!==undefined;if(isOldCtaExist&&cta>=3){beginPath="002_referral"}return beginPath}function isSeenBefore(type){return user.$get("settings."+createPath(prefix(),type)+".seenBefore")}function isWeekGone(type){var isWeek=user.$get("registrationDate"),weekTime=new Date(isWeek).getTime(),week=weekTime+7*24e3*3600;return(new Date).getTime()>=week}function isThreeDayGoneAfterClose(type){var closedTs=user.$get("settings."+createPath(prefix(),type)+".closedTs")||0,threeDays=closedTs+3*24e3*3600;return(new Date).getTime()>=threeDays}function seenBeforeFactory(type){return function saveSeenBefore(seen){if(!seen){var settings={};var settingKey=createPath(prefix(),type);settings[settingKey]={seenBefore:true};user.setSettings(settings)}}}function createPath(path,type){return path+"_"+type}exports.isWeekGone=isWeekGone;exports.createPath=createPath;exports.isThreeDayGoneAfterClose=isThreeDayGoneAfterClose;exports.seenBeforeFactory=seenBeforeFactory;exports.isSeenBefore=isSeenBefore;exports.prefix=prefix});window.require.register("/js/bing-uet.js",function(exports,module,require){module.exports=function UET(o){this.stringExists=function(n){return n&&n.length>0},this.domain="bat.bing.com",this.secondaryDomain="bat.bing.com",this.URLLENGTHLIMIT=2048,this.pageLoadEvt="pageLoad",this.customEvt="custom",o.Ver=o.Ver!==undefined&&(o.Ver==="1"||o.Ver===1)?1:2,this.supportsCORS=this.supportsXDR=!1,this.validKeyNames={ec:1,el:1,ev:1,ea:1},this.validCustomEventKeyNames={ec:1,el:1,ev:1,ea:1,gv:1},this.invalidKeyException="Invalid data: Key Name: ",this.invalidEventException="Invalid event type: Event Type: ",this.evq=o.q||[],delete o.q,this.evqDispatch=!1,this.pageLoadDispatch=!1,window.XMLHttpRequest!==undefined&&"withCredentials"in new XMLHttpRequest&&(this.supportsCORS=!0),typeof XDomainRequest!="undefined"&&(this.supportsXDR=!0),this.push=function(){var n=arguments;n.length===1&&(n[0]===this.pageLoadEvt?this.evt(this.pageLoadEvt):this.evt(this.customEvt,n[0]))},this.dispatchq=function(){this.evqDispatch=!0;for(var n=0;n<this.evq.length;n++)this.push(this.evq[n]),this.evq[n].qe=!0};var t=window.location.protocol,n=0;o.Ver===1&&o.advertiserId!==undefined&&(n=o.advertiserId),this.postURL=t+"//"+this.domain+"/action/"+n,this.urlPrefix=this.postURL+"?",this.secondPostURL=t+"//"+this.secondaryDomain+"/action/"+n,this.secondUrlPrefix=this.secondPostURL+"?",delete o.advertiserId,delete o.adv,o.Ver!==1&&(this.stringExists(o.tagId)&&!this.stringExists(o.ti)&&(o.ti=o.tagId),delete o.tagId,delete o.Sig),this.invisibleDiv=null,this.invisibleFrame=null,this.getGuid=function(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},o.mid=this.getGuid(),this.stringifyToRequest=function(n,t){var r="",u="",i;t&&(u=t+".");for(i in n)r+=typeof n[i]=="object"?this.stringifyToRequest(n[i],u+i):u+i+"="+n[i]+"&";return r},this.createInvisibleElement=function(n,t){var i=document.createElement(t);return i.setAttribute("style","width:0px; height:0px; display:none; visibility:hidden;"),i.id="batBeacon"+Math.random("bat"),n.appendChild(i),i},this.createInvisibleDiv=function(n){return this.invisibleDiv=this.createInvisibleElement(n,"div"),this.invisibleDiv.id},this.fireBeaconImg=function(n){var i=this.createInvisibleElement(this.invisibleDiv,"img"),t,r;return i.width=0,i.height=0,t=Math.floor(Math.random()*1e6),r=n+"&rn="+t,i.setAttribute("src",r),t},this.addLoadTime=function(n){var t,i;return window.performance&&(t=window.performance.timing.domContentLoadedEventEnd,window.performance.timing.loadEventEnd&&(t=window.performance.timing.loadEventEnd),t!==undefined&&t!==0&&(i=t-window.performance.timing.navigationStart,n.lt=i)),n},this.hashCode=function(n){var t=0,i,r;if(n.length===0)return t;for(i=0;i<n.length;i++)r=n.charCodeAt(i),t=(t<<5)-t+r,t=t&t;return t},this.addPluginData=function(n){for(var f=[],u,r,t,i=0;i<window.navigator.plugins.length;i++)f.push({name:window.navigator.plugins[i].name});for(u=f.sort(function(n,t){return n.name>t.name?1:n.name<t.name?-1:0}),r="",t=0;t<u.length;t++)r+=u[t].name;return n.pi=this.hashCode(r),n},this.addFraudSignals=function(n){n=this.addPluginData(n);var t=window.navigator.userLanguage||window.navigator.language;return this.stringExists(t)&&(n.lg=t),screen&&(screen.width&&(n.sw=screen.width),screen.height&&(n.sh=screen.height),screen.colorDepth&&(n.sc=screen.colorDepth)),n},this.addPageData=function(n){var r,t,i;return n=this.addLoadTime(n),n=this.addFraudSignals(n),r="",t=window.document.referrer,this.stringExists(t)&&(n.r=encodeURIComponent(t),r=t.split("?")[0]),i=window.document.title,this.stringExists(i)&&(n.tl=i),window.self!=window.top?n.hasOwnProperty("r")&&(n.p=n.r,n.r=""):(n.p=encodeURIComponent(window.location.href),n.r=encodeURIComponent(r)),n},this.removeTrailingAmp=function(n){var t=n.charAt(n.length-1);return(t==="&"||t==="?")&&(n=n.substring(0,n.length-1)),n},this.validateValue=function(n,t,i){var r=0,u=t;i=i===undefined?!1:i,t.toString().indexOf(",")!==-1&&(u=t.replace(/,/g,"")),r=parseFloat(u);if(isNaN(u)||isNaN(r)||i&&r.toString().indexOf(".")!==-1)throw n+" should be "+(i?"an integer":"a number");if(r>9999999)throw n+" cannot be greater than 9999999";return r},this.validateDataObject=function(n,t){var r,i;if(!n)throw this.invalidEventException+"undefined event.";if(n!==this.pageLoadEvt&&n!==this.customEvt)throw this.invalidEventException+n;if(!t)throw"undefined data object passed to validate";if(typeof t!="object")return;r=this.validKeyNames,n!==this.pageLoadEvt&&(r=this.validCustomEventKeyNames);for(i in t)if(!r[i])throw this.invalidKeyException+i;t.hasOwnProperty("ev")>0&&(t.ev=this.validateValue("ev",t.ev,!0)),t.hasOwnProperty("gv")>0&&(t.gv=this.validateValue("gv",t.gv,!1))},this.evt=function(n,t){var i,r;if(n===this.pageLoadEvt&&this.pageLoadDispatch===!0)return;t=t||{};if(t instanceof Array)if(t.length>0)t=t[0];else return;if(typeof t!="object")return;this.validateDataObject(n,t);if(n===this.customEvt){i=[];for(r in t)i.push(r);if(i.length===0)return}this.invisibleDiv||this.createInvisibleDiv(document.body),t.evt=n,window.self!=window.top&&(t.ifm=1),n===this.pageLoadEvt&&(t=this.addPageData(t),this.fireBeacon(t,!0),this.pageLoadDispatch=!0),this.fireBeacon(t),t.abf=!0,n===this.pageLoadEvt&&this.evqDispatch===!1&&this.dispatchq()},this.createIframe=function(n){return this.invisibleFrame=this.createInvisibleElement(n,"iframe"),this.invisibleFrame.src="",this.invisibleFrame.name=this.invisibleFrame.id,this.invisibleFrame.id},this.clone=function(n,t){t===undefined&&(t={});for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return t},this.combine=function(n,t){var i=this.clone(n);return i=this.clone(t,i)},this.addHiddenFields=function(n,t,i,r){var e="",u,f;r&&(e=r+".");for(u in n)n.hasOwnProperty(u)&&(typeof n[u]=="object"?this.addHiddenFields(n[u],t,i,e+u):(f=i.createElement("input"),f.setAttribute("type","hidden"),f.setAttribute("name",e+u),f.setAttribute("value",n[u]),t.appendChild(f)))},this.fireBeacon=function(n,t){var u=this.urlPrefix,f=this.postURL;t&&(u=this.secondUrlPrefix,f=this.secondPostURL);var i=this.combine(o,n),e=this.stringifyToRequest(i),r=this.removeTrailingAmp(u+e);r.length>this.URLLENGTHLIMIT?this.supportsCORS||this.supportsXDR?this.fireBeaconCORS(i,f):this.fireBeaconForm(i):this.fireBeaconImg(r)},this.createCORSRequest=function(n,t){var i=null;return this.supportsCORS?(i=new XMLHttpRequest,i.withCredentials=!0,i.open(n,t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")):this.supportsXDR&&(i=new XDomainRequest,i.open(n,t)),i},this.fireBeaconCORS=function(n,t){var i=this.createCORSRequest("post",t);i.send(this.removeTrailingAmp(this.stringifyToRequest(n)))},this.createForm=function(n){var t=document.createElement("form");return t.method="post",t.action=this.postURL,t.target=this.invisibleFrame.name,n.fp="1",this.addHiddenFields(n,t,document),t},this.fireBeaconForm=function(n){var i=document.getElementById(this.createIframe(document.body)),t;i.onload=function(){document.body.removeChild(i)},t=this.createForm(n,i.name),document.body.appendChild(t),t.submit(),document.body.removeChild(t)}}});window.require.register("/js/tracking/conversion.js",function(exports,module,require){module.exports=function(user){var paymentProfile=user.$get("paymentProfile")||{},settings=user.$get("settings")||{},userInfo=user.$data,forceConversion=!!paymentProfile.isPremiumConversion;if(!settings.trackedFirstVisit){user.setSettings({trackedFirstVisit:true});firstTouch(userInfo)}if(forceConversion)fireForceConverion(user);if(user.isPremiumUser())premium(user.$data)};function fireForceConverion(user){user.ackPremiumConversion();user.setSettings({trackedFirstVisit:true});conversion(user)}function conversion(user){var config=require("/js/config"),subscription=window.GrammarlyApi.Irbis({irbisUrl:config.IRBIS_URL}),data=user.$data;subscription.status().then(_track);function _track(paymentProfile){if(window.DEV)return;_.extend(data,{paymentProfile:paymentProfile});MixpanelPixel(data);GooglePixel(data);MstagPixel(data);GatTracking(data);UniversalTracking(data);UpsellIt(data);FacebookConversionPixel(data);TwitterConversionPixel(data);OptimizelyConversionTracker(data);PandoraConversionPixel(data);FacebookRetargetingPixel(data);InfolinksConversionPixel(data);LiveintentTrackingPixel(data);BingPixel(data);BingUniversalPixel(data);PandoraRetargetingPixel(data)}}function premium(data){if(window.DEV)return}function firstTouch(user){var config=require("/js/config"),d={};if(user.registrationDate){d["userCreatedDate"]=new Date(user.registrationDate);d["$created"]=new Date(user.registrationDate)}window.tracker.mixpanel.track("G:Grammarly_Product_Installed",{majorProductVersion:config.PACKAGE_VERSION,fullProductVersion:config.GIT_COMMIT_HASH});window.tracker.mixpanel.track("G:Grammarly_Product_First_Used",{dateWebEditorFirstUsed:new Date})}function MixpanelPixel(data){var product=$.cookie("gProduct"),payMethod=data.paymentProfile.paymentMethod;if(payMethod=="credit card")payMethod="creditCard";window.tracker.ga.page("/G:Payment_Form_Accepted");window.tracker.mixpanel.track("G:Payment_Form_Accepted",{methodOfPaymentAttempted:payMethod,gProduct:product})}function PandoraConversionPixel(){var image=new Image(1,1);image.src="https://pubads.g.doubleclick.net/activity;xsp=810496;ord=1?"}function GooglePixel(data){var frequency=data.paymentProfile.currentPlan.periodMonths;window.google_conversion_id=1054393954;window.google_conversion_language="en";window.google_conversion_format="3";window.google_conversion_color="ffffff";window.google_conversion_label="-eBYCKTnylgQ4ozj9gM";window.google_remarketing_only=false;if(frequency=="1"){window.google_conversion_label="DWnkCMbLrwkQ4ozj9gM"}if(frequency=="3"){window.google_conversion_label="lqBBCL7MrwkQ4ozj9gM"}if(frequency=="12"){window.google_conversion_label="w4TvCLbNrwkQ4ozj9gM"}var image=new Image(1,1);image.src="https://www.googleadservices.com/pagead/conversion/1054393954/?label="+window.google_conversion_label+"&guid=ON&script=0"}function BingPixel(data){var frequency=data.paymentProfile.currentPlan.periodMonths,revenue,actionId;if(frequency=="1"){revenue="45.76";actionId="263047"}if(frequency=="3"){revenue="139.48";actionId="263048"}if(frequency=="12"){revenue="98.62";actionId="263049"}$("body").append(Handlebars.partials.bing_conversion_pixel({revenue:revenue,actionId:actionId}))}function BingUniversalPixel(data){var m=data.paymentProfile.currentPlan.periodMonths,UET=require("/js/bing-uet"),plan=m=="1"?"monthly":m=="3"?"quarterly":m=="12"?"annual":"unknown";window.uetq=new UET({ti:"4001981",q:window.uetq});window.uetq.push("pageLoad");window.uetq.push({ec:"free trial sign up",ea:plan})}function MstagPixel(){var url="//flex.msn.com/mstag/tag/e22de80e-650e-4b7c-8986-b2792994c325/analytics.html?dedup=1&domainId=756081&type=1&revenue=40&actionid=14270";var frm=document.createElement("iframe");frm.style.visibility="hidden";frm.style.position="absolute";frm.style.right=0;frm.style.bottom=0;frm.height=0;frm.width=0;frm.src=url;document.body.appendChild(frm)}function UniversalTracking(data){var plan=data.paymentProfile.currentPlan;if(!window.ga)return;ga("send","pageview","/thankyou");ga("ecommerce:addTransaction",{id:data.email,affiliation:"",revenue:plan.price+"",shipping:"",tax:""});ga("ecommerce:addItem",{id:data.email,sku:plan.periodMonths+"M",name:plan.title+"",category:"Grammarly Subscription",price:plan.price+"",quantity:"1"});ga("ecommerce:send")}function GatTracking(data){try{var _gaq=window._gaq||[];var plan=data.paymentProfile.currentPlan;_gaq.push(["_trackPageview","/thankyou"]);_gaq.push(["_addTrans",data.email,"",plan.price+"","","","","",""]);_gaq.push(["_addItem",data.email,plan.periodMonths+"M",plan.title+"","Grammarly Subscription",plan.price+"","1"]);_gaq.push(["_trackTrans"]);window._gaq=_gaq}catch(err){}}function UpsellIt(data){var escape=window.encodeURIComponent;window.USI_orderID=data.email;window.USI_orderAmt=data.paymentProfile.currentPlan.price;window.USI_headID=document.getElementsByTagName("head")[0];window.USI_dynScript=document.createElement("script");window.USI_dynScript.setAttribute("type","text/javascript");window.USI_dynScript.src="http"+(document.location.protocol=="https:"?"s://www":"://www")+".upsellit.com/upsellitReporting.jsp?command=REPORT&siteID=8559&productID=77&position=1&orderID="+escape(window.USI_orderID)+"&orderAmt="+escape(window.USI_orderAmt);window.USI_headID.appendChild(window.USI_dynScript);window.USI_dynScript2=document.createElement("script");window.USI_dynScript2.setAttribute("type","text/javascript");window.USI_dynScript2.src="http"+(document.location.protocol=="https:"?"s://www":"://www")+".upsellit.com/hound/sale.jsp?orderID="+escape(window.USI_orderID)+"&orderAmt="+escape(window.USI_orderAmt);window.USI_headID.appendChild(window.USI_dynScript2)}function FacebookConversionPixel(){(function(){var _fbq=window._fbq||(window._fbq=[]);if(!_fbq.loaded){var fbds=document.createElement("script");fbds.async=true;fbds.src="//connect.facebook.net/en_US/fbds.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(fbds,s);_fbq.loaded=true}})();window._fbq=window._fbq||[];window._fbq.push(["track","6014413832548",{value:"0.00",currency:"USD"}])}function TwitterConversionPixel(){$("body").append(Handlebars.partials.twitter_conversion_pixel())}function OptimizelyConversionTracker(data){if(!data.paymentProfile.currentPlan.price)return;window.optimizely=window.optimizely||[];window.optimizely.push(["trackEvent","trial_complete",{revenue:data.paymentProfile.currentPlan.price*100}])}function FacebookRetargetingPixel(){(function(){var _fbq=window._fbq||(window._fbq=[]);if(!_fbq.loaded){var fbds=document.createElement("script");fbds.async=true;fbds.src="//connect.facebook.net/en_US/fbds.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(fbds,s);_fbq.loaded=true}_fbq.push(["addPixelId","828127113879905"])})();window._fbq=window._fbq||[];window._fbq.push(["track","PixelInitialized",{}])}function InfolinksConversionPixel(){$("body").append(Handlebars.partials.infolinks_conversion_pixel())}function LiveintentTrackingPixel(){$("body").append(Handlebars.partials.liveintent_tracking_pixel())}function PandoraRetargetingPixel(){var axel=Math.random()+"";var a=axel*1e13;$("body").append(Handlebars.partials.pandora_retargeting_pixel({a:a}))}});window.require.register("/js/tracking/document.js",function(exports,module,require){module.exports=function(app){var justToggledApp,statInterval,sessionData;resetSessionData();app.$on("track:document-app-toggled",appToggle);app.$on("track:document-open",docOpen);app.$on("track:document-close",docClose);app.$on("track:document-genre-changed",docGenre);app.$on("track:document-session-finished",sessionFinished);app.$on("track:document-check",docCheck);app.$on("track:report-download",reportDownload);app.$on("track:report-open",reportOpen);app.$on("tracking",function(data){var trackers={matchFound:matchFound,matchVisible:matchVisible,matchAccepted:matchAccepted,matchAcceptedCard:matchAcceptedCard,matchIgnored:matchIgnored,matchAddToDict:matchAlwaysIgnored,matchRemoved:matchRemoved,matchRemovedByServer:matchRemovedByServer,matchSeen:matchSeen,matchUndo:matchUndo,matchUndoIgnored:matchUndoIgnored,matchUndoAlwaysIgnored:matchUndoAlwaysIgnored,matchFirstInteraction:matchFirstInteraction,matchExpand:matchExpand,matchExpandMore:matchExpandMore},cb=trackers[data.event];if(!cb)return;cb(data.matches);calcMatches()});function resetSessionData(){sessionData={matches:{},switchedNum:{},sessionStarted:0}}function docGenre(type){if(type.id)type=type.id;window.tracker.gnar.send("editor/documentTypeSelected",{type:type})}function docOpen(doc){sessionFinished();resetSessionData();sessionData.sessionStarted=Date.now();matchFound(doc.matches)}function docClose(){clearInterval(statInterval)}function reportDownload(score){score=score||0;window.tracker.mixpanel.track("WE:Detailed_Report_Downloaded",{reportScore:score});window.tracker.gnar.send("editor/detailedReportDownloaded",{reportScore:score})}function reportOpen(score){score=score||0;window.tracker.mixpanel.track("WE:Detailed_Report_Opened",{reportScore:score});window.tracker.gnar.send("editor/detailedReportOpened",{reportScore:score})}function appToggle(app){window.tracker.gnar.send("editor/appToggled",{appName:app.id||"all",enabled:!!app.active});var storage=require("/js/local-storage"),lastSessionStat=storage.get("lastSessionStat");justToggledApp=true;setTimeout(function(){justToggledApp=false},200);var lbl="settingSwitchedNum"+(app.id||"All");sessionData.switchedNum[lbl]=(sessionData.switchedNum[lbl]||0)+1;var updatedDate=_.extend({},lastSessionStat,sessionData.switchedNum);storage.save("lastSessionStat",updatedDate)}function docCheck(data){var doc=data.doc,settings=doc.settings||{},session=settings.session||0,genre=data.genre,apps=data.apps;if(data.initial)incSession(doc,session);saveSessionStats(doc,session,apps,genre)}function incSession(doc,session){var docs=require("/js/docs");session+=1;docs.saveSettings(doc,{session:session});if(session!=1)return;window.tracker.mixpanel.track("WE:New_Document_Created",{methodCreated:"",actionFiredAt:""})}function saveSessionStats(doc,session,apps,genre){var totalSessionTime=Math.round((Date.now()-sessionData.sessionStarted)/6e4),totalSessionTimeSec=Math.round((Date.now()-sessionData.sessionStarted)/1e3),user=require("/js/user"),util=require("/js/util"),storage=require("/js/local-storage"),words=util.wordCount(doc.content),data=_.extend({},sessionData.switchedNum,{docID:doc.id,docSessionID:session,uniqEditingSessionID:[user.id,doc.id,session].join("."),documentGenre:genre&&genre[0],documentWordsCount:words,totalSessionTime:totalSessionTime,totalSessionTimeSec:totalSessionTimeSec});for(var i in apps)data["finalState"+i]=apps[i].active;var matches=calcMatches();_.extend(data,matches);storage.save("lastSessionStat",data)}function calcMatches(){var states="Found Visible Seen Accepted AcceptedCard AcceptedManual Ignored AlwaysIgnored UndoAccepted UndoIgnored UndoAlwaysIgnored RemainingVisible".split(" "),config=require("/js/config"),types="free paid total".split(" "),res={};for(var i in sessionData.matches){var m=sessionData.matches[i];if(m.removed)continue;for(var j in m){var lbl=m.type+"Alerts"+j,total="totalAlerts"+j;if(!m[j])continue;if(states.indexOf(j)==-1)continue;res[lbl]=(res[lbl]||0)+1;res[total]=(res[total]||0)+1}}for(var i=0;i<types.length;i++){var lbl=types[i]+"Alerts";res[lbl+"AcceptedManual"]=(res[lbl+"Accepted"]||0)-(res[lbl+"AcceptedCard"]||0);res[lbl+"RemainingVisible"]=(res[lbl+"Visible"]||0)-(res[lbl+"Accepted"]||0)-(res[lbl+"Ignored"]||0)-(res[lbl+"IgnoredAll"]||0)}if(config.TRACK_LOG)logRes(res);return res;function logRes(res){console.group();for(var i in res){if(res[i])console.info("Matches "+i+": ",res[i])}console.groupEnd()}}function matchFirstInteraction(time){var propertyName="matchFirstInteraction60";if(time>-1&&time<30){propertyName="matchFirstInteraction0"}else if(time>30&&time<60){propertyName="matchFirstInteraction30"}incSessionProperty(propertyName);app.$dispatch("track:match-first-interaction",time)}function matchExpand(){incSessionProperty("matchExpand");app.$dispatch("track:match-expand")}function matchExpandMore(){incSessionProperty("matchExpandMore");app.$dispatch("track:match-expand-more")}function incSessionProperty(prop){var storage=require("/js/local-storage"),lastSessionStat=storage.get("lastSessionStat")||{};lastSessionStat[prop]=!lastSessionStat[prop]?1:++lastSessionStat[prop];storage.save("lastSessionStat",lastSessionStat)}function sessionFinished(){var session=localStorage.lastSessionStat,config=require("/js/config");if(!session)return;try{session=JSON.parse(session)}catch(e){session={}}if(config.TRACK_LOG)log(session);window.tracker.mixpanel.track("G:Document_Session_Finished",session);app.$dispatch("track:session-finished",session);delete localStorage.lastSessionStat;function log(session){console.group();console.info("G:Document_Session_Finished");for(var i in session){console.info(i+": ",session[i])}console.groupEnd()}}function match(matches,propsTrue,propsFalse){if(!propsTrue||!matches)return;matches=matches instanceof Array?matches:[matches];propsTrue=propsTrue.split(" ");propsFalse=propsFalse&&propsFalse.split(" ");matches.forEach(save);function save(m){if(m.syn)return;var id=m.uid;if(!sessionData.matches[id])sessionData.matches[id]={type:m.free?"free":"paid"};for(var i=0;i<propsTrue.length;i++)sessionData.matches[id][propsTrue[i]]=true;if(propsFalse)for(var i=0;i<propsFalse.length;i++){var toFalse=propsFalse[i];if(toFalse=="Visible"&&sessionData.matches[id].Seen)continue;sessionData.matches[id][toFalse]=false}}}function matchInvisible(matches){match(matches,"Found","Visible")}function matchVisible(matches){match(matches,"Visible")}function matchFound(matches){match(matches,"Found")}function matchIgnored(matches){match(matches,"Ignored","UndoIgnored")}function matchAlwaysIgnored(matches){match(matches,"AlwaysIgnored","UndoAlwaysIgnored")}function matchAccepted(matches){if(justToggledApp)return;match(matches,"Accepted","UndoAccepted")}function matchAcceptedCard(matches){match(matches,"AcceptedCard","UndoAccepted")}function matchUndo(matches){match(matches,"UndoAccepted","Accepted AcceptedCard")}function matchUndoIgnored(matches){match(matches,"UndoIgnored","Ignored")}function matchUndoAlwaysIgnored(matches){match(matches,"UndoAlwaysIgnored","AlwaysIgnored")}function matchSeen(matches){match(matches,"Seen")}function matchRemovedByServer(match){var old=Date.now()-match.ts>1500,id=match.uid,m=sessionData.matches[id]||{},seen=m.Seen,lbl=(old&&seen?"Old":"New")+" Removed By Server";console.info(lbl,id);if(old&&seen)return matchAccepted(match);if(!sessionData.matches[id])return;sessionData.matches[id].removed=true}function matchRemoved(matches){if(justToggledApp)return matchInvisible(matches);if(matches.length>1)return;matches.forEach(function(m){if(m.addedToDict)return matchAlwaysIgnored(m);if(m.ignored)return matchIgnored(m);return matchAccepted(m)})}}});window.require.register("/js/tracking/monitoring.js",function(exports,module,require){module.exports=function(app){var config=require("/js/config"),user=require("/js/user"),storage=require("/js/local-storage"),statsc=window.tracker.statsc,felog=window.tracker.felog;initFelog(user);initStatsc(user);var detect=require("/detect/detect"),browser=["chrome","ie","firefox","safari"].indexOf(detect.browser)>-1?detect.browser:"other",statscWebsockets=statsc.createRoot({prefix:"grammarly.ui.connectivity.websockets",id:"ws"}),statscUI=statsc.createRoot({prefix:"grammarly.ui.actions",id:"ui"}),statscPerformance=statsc.createRoot({prefix:"grammarly.ui.performance",postfix:browser+".editor.world",id:"performance"}),statscEditor=statsc.createRoot({prefix:"grammarly.ui",postfix:browser+".editor.world",id:"perf"});
trackAjax();app.$on("app:loaded",function(){setTimeout(function(){trackFirstLoadTiming(app)},2e4)});app.$on("track:document-100-score",trackScore100);app.$on("track:document-loaded",trackDocumentLoaded);app.$on("track:document-open",trackDocOpen);app.$on("track:capi-error",trackCapiError);app.$on("track:service-state",trackServiceState);app.$on("track:subview-loaded",trackSubviewLoaded);app.$on("track:referral-iframe-open-start",trackReferralIframeOpenStart);app.$on("track:referral-iframe-open-end",trackReferralIframeOpenEnd);var otTimer;app.$on("track:docs-ot-change",function(){otTimer&&otTimer();otTimer=null});app.$on("track:editor",trackEditor);app.$on("track:docs-ot-send",function(){otTimer=statsc.timer("dox_ot_time")});app.$on("track:subscription-card-update",trackCardUpdate);app.$on("track:duplicate-cookies",function(cookies){felog.warn("Duplicate cookies",{cookies:user.$get("duplicateCookies")})});app.$on("track:message-capi-down",function(){felog.warn("stability.message_capi_down")});app.$on("track:cancel-subscription",function(status,time){felog.info("cancel_subscription",{success:status,time:time})});app.$on("track:update-subscription-plan",function(status,time,plan){felog.info("update_subscription_plan",{success:status,time:time,plan:plan})});app.$on("track:resume-subscription-plan",function(status,time){felog.info("resume_subscription_plan",{success:status,time:time})});app.$on("track:subscription-token-retries-failed",function(){felog.warn("stability.subscription-token-retries-failed")});app.$on("track:websocket-connect",function(){felog.info("stability.websocket-connect")});app.$on("track:websocket-reconnect",function(){felog.info("stability.websocket-reconnect")});app.$on("track:websocket-error-reconnect",function(){felog.warn("stability.websocket-reconnect-after-error");statscWebsockets.increment("reconnect-after-error")});app.$on("track:websocket-fail-count",function(count){felog.info("stability.websocket-fail-count",{failCount:count});statscWebsockets.increment("websocket-fail-count")});app.$on("track:websocket-disconnect",function(){felog.info("stability.websocket-disconnect")});app.$on("track:websocket-fail",function(e){felog.exception("stability.websocket-fail",e);felog.warn("stability.websocket-fail-document",e,"document");felog.warn("stability.websocket-fail-session",e,"session")});app.$on("track:websocket-test-failed",function(e){felog.exception("stability.websocket-test-failed",e)});app.$on("track:corrupted-underline",function(info){felog.warn("matches.corrupted-underline",info);console.log("tracked corrupted-underline")});app.$on("track:frequent-runtime-error",function(data){felog.error("stability.frequent-runtime-error",data)});app.$on("track:too-many-runtime-error",function(data){felog.error("stability.too-many-runtime-error",data)});app.$on("track:set-document-scope",function(){window.tracker.felog.setScope("document")});app.$on("track:menu-action",function(action){statscUI.increment(action)});app.$on("track:match-expand",function(){statscUI.increment("match-expand")});app.$on("track:match-expand-more",function(){statscUI.increment("match-expand-more")});app.$on("track:match-first-interaction",function(time){statscUI.timing("match-first-interaction",time)});app.$on("track:session-finished",function(data){if(data&&data.totalSessionTimeSec){statscUI.timing("document-session-time",data.totalSessionTimeSec)}});app.$on("track:popup-unexpected-location",function(location){felog.error("popup-unexpected-location",{location:location})});var startDateIframeReferral,endDateIframeReferral;function trackReferralIframeOpenEnd(date){endDateIframeReferral=date;var diff=endDateIframeReferral-startDateIframeReferral;statscEditor.timing("actions:referral_iframe_open_end",diff)}function trackReferralIframeOpenStart(date){startDateIframeReferral=date;statscEditor.increment("actions:referral_iframe_open_start")}function trackDocOpen(doc){var id=doc.id;statInterval=setInterval(function(){statsc.set("open_documents",id)},8e3)}function trackCardUpdate(status,time,errorMsg){var trackData={success:status,time:time};trackData.errorMessage=!status?errorMsg:undefined;felog.info("card_update_subscription",trackData)}function trackEditor(obj){if(!obj)return;var type=obj.type,key=obj.key,value=obj.value,data=obj.data;if(!key&&!data)return;if(key){statscEditor[type](key,value)}else{statscEditor[type](data)}}function trackDocumentLoaded(time){var initialLoad=localStorage["initialDocumentLoad"],isInitial=!initialLoad?".first.":".",eventName="load_time"+isInitial+"document_loaded";statscPerformance.timing(eventName,time);storage.save("initialDocumentLoad",true)}function trackSubviewLoaded(time,subview){if(!subview)return;var storageName="initialSubview_"+subview,initialLoad=localStorage[storageName],isInitial=!initialLoad?".first.":".",eventName="load_time"+isInitial+"subview."+subview;statscPerformance.timing(eventName,time);storage.save(storageName,true)}function trackServiceState(data){if(data.available)logState(data);else throttledLog(data)}var throttledLog=_.throttle(logState,1e3*60*3);function logState(data){felog.warn("Logging - Abnormal up/down",{Service:data.type,State:data.available?"up":"down"})}function trackCapiError(err){felog.error("stability.capi_error",{data:err})}function trackScore100(){if(!app.$.editor)return;felog.info("Document - 100 score",{capi:app.$.editor.capiUrl})}var isFirstLoad=false;function trackFirstLoadTiming(app){var isDocument=app.currentRoute=="editor";var storageName=isDocument?"initDocLoad":"initIndexLoad";var initialLoad=localStorage[storageName];var timing=window.performance&&window.performance.timing;if(isFirstLoad||!timing)return;var fullPageLoad=timing.loadEventEnd-timing.navigationStart,contentLoaded=timing.responseEnd-timing.navigationStart,network=timing.requestStart-timing.navigationStart,domReady=timing.domComplete-timing.domLoading,requestTime=timing.responseStart-timing.requestStart,responseTime=timing.responseEnd-timing.responseStart,onLoad=timing.loadEventEnd-timing.loadEventStart,isInitial=!initialLoad?".first.":".",eventName="load_time."+(isDocument?"editor":"index")+isInitial;var metrics=[{name:"nav_start_to_fullload",value:fullPageLoad},{name:"nav_start_to_response",value:contentLoaded},{name:"nav_start_to_request",value:network},{name:"response_to_dom_complete",value:domReady},{name:"load_start_to_load_end",value:onLoad},{name:"request_start_to_request_end",value:requestTime},{name:"response_start_to_response_end",value:responseTime}],v,n,statscName;metrics.forEach(function(item){n=item.name,v=item.value,statscName=eventName+n;statscPerformance.timing(statscName,v);if(v<0||v>6e4){felog.warn(v<0?"unexpected_timing_min":"unexpected_timing_max",{timing:timing,metric:n,value:v})}});if(document.readyState!="complete"){felog.warn("load_time_dom_incomplete",{timing:timing})}isFirstLoad=true;storage.save(storageName,true)}};function initStatsc(user){var id=user.$get("id");window.tracker.felog.setScope("session");window.tracker.statsc.set("users",id)}function initFelog(user){var email=user.$get("email"),id=user.$get("id");window.tracker.felog.setUser({id:id,email:email});if(document.cookie.length>3800)trackLongCookies()}function trackAjax(){var requests={};$.ajaxPrefilter(function(options){requests[options.url]=Date.now()});var throttledAjax=_.throttle(successAjax,1e3*30);function successAjax(event,jqxhr,settings){var url=settings.url,httpStatus=jqxhr.status,reqTime=requests[url]?Date.now()-requests[url]:0;window.tracker.felog.info("Ajax Successful",{url:url,http_status:httpStatus,req_time:reqTime,finish_time:event.timestamp})}$(document).ajaxError(function(event,jqxhr,settings,thrownError){var url=settings.url,httpStatus=jqxhr.status,reqTime=requests[url]?Date.now()-requests[url]:0;window.tracker.felog.exception(thrownError||"Ajax Error",{url:url,http_status:httpStatus,req_time:reqTime,finish_time:event.timestamp})})}function trackLongCookies(){window.tracker.felog.warn("cookie_too_long",{cookie_k:Math.floor(document.cookie.length/1e3),cookie_length:document.cookie.length,cookie_content:document.cookie})}function getStatscPrefix(type){var config=require("/js/config"),detect=require("/detect/detect"),browser=["chrome","ie","firefox","safari"].indexOf(detect.browser)>-1?detect.browser:"other";return"grammarly.ui."+type+"."+browser+".editor"+".world."}});window.require.register("/js/tracking/referral/index.js",function(exports,module,require){var utils=require("/js/referral_util");var isSeenBefore=utils.isSeenBefore;var seenBeforeFactory=utils.seenBeforeFactory;var prefix=utils.prefix;function trackReferralShowElement(type){var saveSeenBefore=seenBeforeFactory(type);return function(data){var isSeen=isSeenBefore(type);data=data||{};data["firstTime"]=!isSeen;saveSeenBefore(isSeen);window.tracker.mixpanel.track("WE:Referral_Notification_Shown",{placement:type});window.tracker.gnar.send("editor/referralNotificationShown",{placement:type})}}function trackReferralNotificationClosed(type){var user=require("/js/user"),savedObject={},currentTime=(new Date).getTime(),cta=user.$get("settings."+prefix()+"_"+type+".cta")||0;setingKey=prefix()+"_"+type;savedObject[setingKey]={seenBefore:isSeenBefore(type),cta:++cta,closedTs:currentTime};user.setSettings(savedObject);window.tracker.mixpanel.track("WE:Referral_Notification_Closed",{placement:type});window.tracker.gnar.send("editor/referralNotificationClosed",{placement:type})}function trackReferralIframeOpen(){window.tracker.gnar.send("editor/referralIframeOpened")}function trackReferralButtonClicked(data){window.tracker.mixpanel.track("WE:Referral_Button_Clicked",data)}module.exports=function(app){app.$on("track:referral-sidebar-shown",trackReferralShowElement("sidebar"));app.$on("track:referral-popuptool-shown",trackReferralShowElement("popuptool"));app.$on("track:referral-banner-shown",trackReferralShowElement("topBanner"));app.$on("track:referral-premium-notification-shown",trackReferralShowElement("topBannerPremium"));app.$on("track:referral-notification-closed",trackReferralNotificationClosed);app.$on("track:referral-iframe-open",trackReferralIframeOpen);app.$on("track:referral-button-clicked",trackReferralButtonClicked)}});window.require.register("/js/tracking/tracking-popup.js",function(exports,module,require){module.exports={onlogin:onlogin,init:init};function init(){var config=require("/js/config");function send(method,data,props){window.top.postMessage({action:"tracking",method:method,param:data,props:props,grammarly:true},"*")}var statsc={increment:function(data){send("statsc.increment",data)},decrement:function(data){send("statsc.decrement",data)},set:function(data){send("statsc.set",data)},gauge:function(data){send("statsc.gauge",data)},timer:function(data){send("statsc.timer",data)},timing:function(data){send("statsc.timing",data)}};window.tracker={felog:{exception:function(data){send("felog.error",data)},event:function(data){send("felog.event",data)},info:function(data){send("felog.info",data)},warn:function(data){send("felog.warn",data)},setUser:_f,setScope:_f},mixpanel:{track:function(data){send("mixpanel.track",data)}},gnar:{send:function(data,props){send("gnar.track",data,props)}},statsc:{set:statsc.set,timer:statsc.timer,createRoot:function(){return statsc}}}}function onlogin(app){var config=require("/js/config"),user=require("/js/user"),email=user.$get("email"),storage=require("/js/local-storage");require("/js/tracking/document")(app);require("/js/tracking/monitoring")(app);require("/js/tracking/referral/index")(app)}});window.require.register("/js/tracking/tracking.js",function(exports,module,require){module.exports={onlogin:onlogin,init:init};function init(){var config=require("/js/config");window.tracker.init({felog:{commit:config.GIT_COMMIT_HASH,application:"neweditor",url:config.FELOG_URL,key:config.FELOG_KEY,project:config.FELOG_PROJECT_ID,version:config.PACKAGE_VERSION,env:config.ENV},mixpanel:{key:config.MIXPANEL_KEY,qaKey:config.MIXPANEL_QA_KEY,dapi:config.DAPI_URL},gnar:{url:config.GNAR_URL,qaUrl:config.GNAR_QA_URL,app:"editor",appVersion:config.PACKAGE_VERSION},statsc:{url:config.STATSC_URL},ga:"UA-6331378-16",gaClassic:"UA-6331378-4",twitter:"//platform.twitter.com/oct.js",qualaroo:"//s3.amazonaws.com/ki.js/51077/aOV.js",optimizely:"//cdn.optimizely.com/js/283147288.js"});window.tracker.mixpanel.setUrlProps()}function onlogin(app){var config=require("/js/config"),user=require("/js/user"),email=user.$get("email"),storage=require("/js/local-storage");initQuaraloo(email);initMixpanel(user,config);initGnar(user);initMimicOptimizely();require("/js/tracking/document")(app);require("/js/tracking/conversion")(user);require("/js/tracking/monitoring")(app);require("/js/tracking/referral/index")(app);ping(user);$.cookie("isGrammarlyUser","true",{expires:365,path:"/",domain:".grammarly.com"});checkTestParticipation(user);app.$on("track:document-open",trackDocumentOpen);app.$on("track:document-copied",trackDocumentCopied);app.$on("track:document-paste",trackDocumentPaste);app.$on("track:document-download",trackDocumentDownload);app.$on("track:document-upload-accepted",trackDocumentUploadAccepted);app.$on("track:document-upload-rejected",trackDocumentUploadRejected);app.$on("track:proofread-document-download",trackProofitDocumentDownload);app.$on("track:documents",trackDocumentsPageVisit);app.$on("track:profile",trackProfilePageVisit);app.$on("track:support-button-clicked",trackSupportButtonClick);app.$on("track:new-document-button-clicked",trackNewDocumentButtonClick);app.$on("track:document-remove-button-clicked",trackDocumentRemoveButtonClick);app.$on("tracker:banner-show",trackBannerNotificationShow);app.$on("tracker:banner-later",trackBannerLaterClick);app.$on("tracker:banner-dismiss",trackBannerDismissClick);app.$on("tracker:banner-close",trackBannerCloseClick);app.$on("tracker:banner-click",trackBannerActionClick);app.$on("track:go-to-apps",trackGoToApps);app.$on("track:apps-learn-more",trackAppsLearnMore);app.$on("track:apps-install",trackAppsInstall);app.$on("track:subscription",function(){pageVisit("Subscription");trackPage("/WE:Subscritpion_Page_Visited")});app.$on("track:subscription-cancelled",function(){trackPage("/G:User_Subscription_Cancelled");window.tracker.mixpanel.track("G:User_Subscription_Cancelled")});app.$on("track:on-logout",function(){window.tracker.mixpanel.track("G:User_Logout_Attempted")});app.$on("track:on-not-authorized-logout",function(){window.tracker.gnar.send("editor/notAuthorizedUserLogout");window.tracker.felog.error("stability.not-authorized-logout")});app.$on("track:menu-action",function(action){window.tracker.mixpanel.track("WE:Editor_Menu_Action",{menuAction:action})});app.$on("track:editor-app",function(){pageVisit("Editor")});app.$on("track:account-delete-form-shown",function(){window.tracker.gnar.send("editor/accountDeleteFormShown");window.tracker.mixpanel.track("WE:Account_Delete_Form_Shown")});app.$on("track:account-delete-form-accepted",function(){window.tracker.gnar.send("editor/accountDeleteForm/accepted");window.tracker.mixpanel.track("WE:Account_Delete_Form_Accepted");window.tracker.felog.info("stability.account-delete-success")});app.$on("track:account-delete-form-rejected",function(){window.tracker.felog.info("stability.account-delete-server-error")});app.$on("track:account-delete-form-support-link-clicked",function(){window.tracker.gnar.send("editor/accountDeleteFormSupportLinkClicked");window.tracker.mixpanel.track("WE:Account_Delete_Form_Support_Link_Clicked")});app.$on("track:password-resete-form-rejected",function(){window.tracker.felog.info("stability.password-resete-form-rejected")});app.$on("track:language-strong-preference",function(data){var sameAsWeak;if(data.weak){sameAsWeak=data.weak==data.strong}var props={language:data.strong,sameAsWeak:sameAsWeak};window.tracker.mixpanel.track("G:Language_Strong_Preference",props);window.tracker.gnar.send("editor/languageStrongPreference",props);window.tracker.felog.info("stability.language-strong-preference",props)});app.$on("track:language-weak-preference",function(data){var props={dialect:data};window.tracker.mixpanel.track("G:Language_Weak_Preference",props);window.tracker.gnar.send("editor/languageWeakPreference",props);window.tracker.felog.info("stability.language-weak-preference",props)});app.$on("track:dictionary-remove",function(){window.tracker.gnar.send("editor/dictionaryRemove");window.tracker.mixpanel.track("WE:dictionary-remove")});app.$on("track:dictionary-add",function(){window.tracker.gnar.send("editor/dictionaryAdd");window.tracker.mixpanel.track("WE:dictionary-add")});app.$on("track:edit-name-button-clicked",function(){window.tracker.gnar.send("editor/editNameButtonClicked")});app.$on("track:edit-name-accepted",function(){window.tracker.gnar.send("editor/editNameForm/accepted");window.tracker.felog.info("stability.change-name-accepted")});app.$on("track:edit-name-rejected",function(){window.tracker.gnar.send("editor/editNameForm/rejected");window.tracker.felog.info("stability.change-name-rejected")});app.$on("track:edit-email-button-clicked",function(){window.tracker.gnar.send("editor/editEmailButtonClicked")});app.$on("track:edit-email-accepted",function(){window.tracker.gnar.send("editor/editEmailForm/accepted");window.tracker.felog.info("stability.change-email-accepted")});app.$on("track:edit-email-rejected",function(){window.tracker.gnar.send("editor/editEmailForm/rejected");window.tracker.felog.info("stability.change-email-rejected")});app.$on("track:edit-password-button-clicked",function(){window.tracker.gnar.send("editor/editPasswordButtonClicked")});app.$on("track:edit-password-accepted",function(){window.tracker.gnar.send("editor/editPasswordForm/accepted");window.tracker.felog.info("stability.change-password-accepted")});app.$on("track:edit-password-rejected",function(){window.tracker.gnar.send("editor/editPasswordForm/rejected");window.tracker.felog.info("stability.change-password-rejected")});app.$on("track:learn-more-button-clicked",function(){window.tracker.gnar.send("editor/learnmoreButtonClicked")});app.$on("track:popup-view-plans-button-clicked",function(){window.tracker.gnar.send("editor/popupViewPlansButtonClicked")});app.$on("track:popup-invite-friends-button-clicked",function(){window.tracker.gnar.send("editor/popupInviteFriendsButtonClicked")});app.$on("track:upgrade-text-button-clicked",function(){window.tracker.gnar.send("editor/upgradeTextButtonClicked")});app.$on("track:try-premium-free-button-clicked",function(){window.tracker.gnar.send("editor/tryPremiumFreeButtonClicked")});function trackDocumentOpen(doc){var docOpenCount=storage.get("docOpenCount"),count;if(!docOpenCount){docOpenCount={}}count=docOpenCount[doc.id]||0;count++;docOpenCount[doc.id]=count;storage.save("docOpenCount",docOpenCount);tracker.gnar.send("editor/documentOpened",doc.settings||{})}function trackNewDocumentButtonClick(){window.tracker.gnar.send("editor/newDocumentButtonClicked")}function trackDocumentRemoveButtonClick(){window.tracker.gnar.send("editor/documentRemoveButtonClicked")}function trackSupportButtonClick(){window.tracker.gnar.send("editor/supportButtonClicked")}function pageVisit(page){tracker.gnar.page(page)}function trackPage(url){var _gaq=window._gaq||[];_gaq.push(["_trackPageview",url]);if(!window.ga){console.error("Universal Analytics function ga is undefined");return}ga("send","pageview",url)}function trackDocumentsPageVisit(){pageVisit("Documents")}function trackProofitDocumentDownload(){window.tracker.mixpanel.track("PROOF:Document_Downloaded",{proofitJobID:""})}function trackProfilePageVisit(){pageVisit("Profile");trackPage("/WE:Profile_Page_Visited")}function trackDocumentCopied(){window.tracker.mixpanel.track("WE:Entire_Document_Copied");window.tracker.gnar.send("editor/entireDocumentCopied")}function trackDocumentPaste(){tracker.gnar.send("editor/entireDocumentPaste")}function trackDocumentDownload(){window.tracker.mixpanel.track("WE:Entire_Document_Taken");window.tracker.gnar.send("editor/documentDownloaded")}function trackDocumentUploadAccepted(){window.tracker.mixpanel.track("WE:Document_Upload");window.tracker.gnar.send("editor/documentUpload/accepted")}function trackDocumentUploadRejected(type){window.tracker.gnar.send("editor/documentUpload/rejected",{errotType:type})}function trackBannerNotificationShow(name){window.tracker.mixpanel.track("WE:Banner_Show",{bannerName:name});window.tracker.gnar.send("editor/bannerShow",{bannerName:name})}function trackBannerLaterClick(name){window.tracker.mixpanel.track("WE:Banner_Later_Click",{bannerName:name});window.tracker.gnar.send("editor/bannerLaterClick",{bannerName:name})}function trackBannerDismissClick(name){window.tracker.mixpanel.track("WE:Banner_Dismiss_Click",{bannerName:name});window.tracker.gnar.send("editor/bannerDismissClick",{bannerName:name})}function trackBannerCloseClick(name){window.tracker.mixpanel.track("WE:Banner_Close_Click",{bannerName:name});window.tracker.gnar.send("editor/bannerCloseClick",{bannerName:name})}function trackBannerActionClick(name){window.tracker.mixpanel.track("WE:Banner_Action_Click",{bannerName:name});window.tracker.gnar.send("editor/bannerActionClick",{bannerName:name})}function trackGoToApps(){window.tracker.mixpanel.track("WE:Apps_Page_Visited");window.tracker.gnar.send("editor/pageVisited/Apps")}function trackAppsInstall(name){window.tracker.mixpanel.track("WE:Apps_Install_Click",{appName:name});window.tracker.gnar.send("editor/appsInstallClick",{appName:name})}function trackAppsLearnMore(name){window.tracker.mixpanel.track("WE:Apps_More_Click",{appName:name});window.tracker.gnar.send("editor/appsMoreClick",{appName:name})}}function getOptimizelyDataForUser(mimicApi){var gnarContainerId=$.cookie("gnar_containerId");if(!window.optimizely||!gnarContainerId){return}var variationIdsMap=window.optimizely.variationIdsMap;if(!variationIdsMap){return}var allExperimentsForUser=Object.keys(variationIdsMap).map(function(experimentId){return experimentId+":"+variationIdsMap[experimentId][0]}).join("|");mimicApi.sendGnarContainerId(gnarContainerId);$.cookie("optimizely_current",allExperimentsForUser,{expires:1})}function sendOptimizelyInfo(mimicApi){if(!window.optimizely){return null}var allExperiments=window.optimizely.allExperiments;var allVariations=window.optimizely.allVariations;if(!allExperiments||!allVariations){return null}var experiments=Object.keys(allExperiments).map(function(experiment){return{id:experiment,name:allExperiments[experiment].name,variationIds:allExperiments[experiment].variation_ids,active:allExperiments[experiment].enabled==true}});var variations=Object.keys(allVariations).map(function(variation){return{id:variation,name:allVariations[variation].name}});var optimizelyInfo={experiments:experiments,variations:variations};optimizelyInfo&&mimicApi.sendOptimizelyInfo(optimizelyInfo)}function checkTestParticipation(user){var config=require("/js/config"),trackingApi=window.GrammarlyApi.Tracking({dapiUrl:config.DAPI_URL+"/api/mimic"}),mp_cookie=$.cookie("mp_"+config.NEW_MIXPANEL_KEY+"_mixpanel"),optimizely=trackingApi.parseTestParticipation(mp_cookie);if(!optimizely)return;var storage=require("/js/local-storage"),label="optimizely_"+user.$get("id"),saved=localStorage[label]?localStorage[label].split(","):[];for(var i in optimizely){if(saved.indexOf(i)==-1)saved.push(i);else delete optimizely[i]}storage.save(label,saved.join(","));if(!optimizely||!_.size(optimizely))return;user.setUserData(optimizely)}function ping(user){if(Date.now()<localStorage.nextPingDate){return}var nextPingDate=getNextPingDate(),storage=require("/js/local-storage");storage.save("nextPingDate",nextPingDate);user.ping({type:localStorage["auth-client-name"]?localStorage["auth-client-name"]:"webeditor"});window.tracker.mixpanel.dapiEvent("Daily_Ping",{gProduct:localStorage["tracking-product"]?localStorage["tracking-product"]:"Online-Editor"});function getNextPingDate(){var now=new Date;if(now.getHours()>2){now.setDate(now.getDate()+1)}now.setHours(3);now.setMinutes(Math.floor(Math.random()*60));return now.getTime()}}function initQuaraloo(email){window._kiq.push(["identify",email])}function initMixpanel(user,config){var id=user.$get("id"),product=localStorage["tracking-product"]?localStorage["tracking-product"]:"Online-Editor";var data={lastSeenTimestamp:(new Date).getTime(),fullProductVersion:config.PACKAGE_VERSION,gProduct:product};window.tracker.mixpanel.initProps();window.tracker.mixpanel.identify(id);window.tracker.mixpanel.initUser(user);window.tracker.mixpanel.setProps(data);window.tracker.mixpanel.set(data)}function initGnar(user){var id=user.$get("id");window.tracker.gnar.trackTrackTrack();window.tracker.gnar.setUser(id)}function initMimicOptimizely(){var config=require("/js/config");var mimicApi=window.GrammarlyApi.Tracking({dapiUrl:config.DAPI_URL+"/api/mimic"});getOptimizelyDataForUser(mimicApi);sendOptimizelyInfo(mimicApi)}});window.require.register("/component/common/button/button.js",function(exports,module,require){});window.require.register("/component/common/dialog/dialog.js",function(exports,module,require){var Dialog=Vue.extend({template:Handlebars.partials.common__dialog(),replace:true}),dialog;function show(){var defaults={sel:"body",closeBtn:true,closeEsc:true,closeOnOverlayClick:true,message:""};params=arguments,config=processCfg(defaults,params);if(dialog)hide();config=_.extend(defaults,config);Vue.partial("message",config.message);if(config.closeEsc)$(window).on("keydown",onEscClick);dialog=new Dialog({data:config,methods:{hide:hide}});dialog.$appendTo(config.sel)}function onEscClick(e){if(e.keyCode==27)hide()}function hide(){$(window).off("keydown",onEscClick);dialog.$destroy();dialog=null}module.exports={show:show,hide:hide};function processCfg(defaults,params){var tmpl,options;if(_.isString(params[0])){tmpl=params[0];options={};if(_.isObject(params[1]))options=params[1];else options.data={".":params[1]};options.message=tmpl}else{options=params[0]}var hb=Handlebars.partials,template=hb[options.message];options.cls=options.message;options.message=template?template():options.message;return _.extend(defaults,options)}});window.require.register("/component/common/logo/logo.js",function(exports,module,require){module.exports=Vue.component("common-logo",{template:Handlebars.partials.common__logo(),replace:true,created:function(){}})});window.require.register("/component/common/tooltip/tooltip.js",function(exports,module,require){var tooltip;Vue.directive("common-tooltip",{isEmpty:true,bind:function(){tooltip=tooltip||new Tooltip}});var Tooltip=function(cfg){var $body=$("body"),$document=$(document),$tooltip=$("<span />",{"class":"common__tooltip","data-content":""}),selector=cfg||"[data-tooltip]";$body.append($tooltip).on("mousemove",selector,show).on("mouseout",selector,hide);try{var app=require("/js/app");app.$on("tooltip:tooltip-hide",hide)}catch(e){}function bind(){$document.on("keyup",closeOnEscButton);$body.on("click",selector,hide).on("scroll",hide)}function unbind(){$document.off("keyup",closeOnEscButton);$body.off("click",selector,hide).off("scroll",hide)}function closeOnEscButton(e){if(e.keyCode==27)hide()}function show(e){var $target=$(e.target),pos,position,left,leftOffset,targetRect,label;if(isUndoCard($target))return;$target=getEl($target);label=e.target.dataset.tooltip;targetRect=e.target.getClientRects()||{};pos=calculateCoordinate($target);leftOffset=e.target.className.indexOf("first-replacement")>-1&&targetRect.length>1?$tooltip.width()/2-targetRect[targetRect.length-1].width:($tooltip.width()-e.target.getBoundingClientRect().width)/2;left=parseInt(pos.left-leftOffset);position=$target.data("tooltip-position")||"bottom";$tooltip.attr("data-content",label);$tooltip.addClass("active "+position);$tooltip.css({top:pos.top,left:left});$body.css("overflow-x","hidden");bind()}function getEl($element){var $parents=$element.parents(selector),$target;$target=$parents.length?$parents:$element;return $target}function isUndoCard($wrapper){return $wrapper.parents(".undo").length}function calculateCoordinate($wrapper){var pos=$wrapper.offset(),position=$wrapper.data("tooltip-position")||"bottom",top=Math.round(pos.top);if(position==="bottom")top+=parseInt($wrapper.outerHeight());if(position==="top")top-=parseInt($tooltip.height()+10);return{top:top,left:pos.left}}function hide(){$tooltip.removeClass("active top bottom");$tooltip.css("top",-9999);$body.css("overflow-x","initial");unbind()}}});window.require.register("/component/common/util/crossdomain.js",function(exports,module,require){var urls={dev:"https://newfunnel.grammarly.com",qa:"https://nspl.grammarly.com",staging:"https://grammarly.com/nspl",prod:"https://grammarly.com"};var config=require("/js/config");module.exports=function(pathname){var url=urls[config.ENV];return new CrossDomainStorage(url,pathname)};function CrossDomainStorage(origin,path){this.origin=origin;this.path=path;this._iframe=null;this._iframeReady=false;this._queue=[];this._requests={};this._id=0}CrossDomainStorage.prototype={constructor:CrossDomainStorage,init:function(){var that=this;if(!this._iframe){if(window.postMessage&&window.JSON&&window.localStorage){this._iframe=document.createElement("iframe");this._iframe.style.cssText="position:absolute;width:1px;height:1px;left:-9999px;";document.body.appendChild(this._iframe);if(window.addEventListener){this._iframe.addEventListener("load",function(){that._iframeLoaded()},false);window.addEventListener("message",function(event){console.log(event);that._handleMessage(event)},false)}else if(this._iframe.attachEvent){this._iframe.attachEvent("onload",function(){that._iframeLoaded()},false);window.attachEvent("onmessage",function(event){that._handleMessage(event)})}}else{throw new Error("Unsupported browser.")}}this._iframe.src=this.origin+this.path},requestValue:function(key,callback){var request={key:key,id:++this._id},data={request:request,callback:callback};if(this._iframeReady){this._sendRequest(data)}else{this._queue.push(data)}if(!this._iframe){this.init()}},_sendRequest:function(data){this._requests[data.request.id]=data;this._iframe.contentWindow.postMessage(JSON.stringify(data.request),this.origin)},_iframeLoaded:function(){this._iframeReady=true;if(this._queue.length){for(var i=0,len=this._queue.length;i<len;i++){this._sendRequest(this._queue[i])}this._queue=[]}},_handleMessage:function(event){if(event.origin==this.origin){var data=JSON.parse(event.data);this._requests[data.id].callback(data.key,data.value);delete this._requests[data.id]}}}});window.require.register("/component/common/util/date.js",function(exports,module,require){module.exports=function(fromDate,toDate,levels,prefix){var lang={"date.past":"{0} ago","date.future":"in {0}","date.now":"now","date.year":"{0} year","date.years":"{0} years","date.years.prefixed":"{0} years","date.month":"{0} month","date.months":"{0} months","date.months.prefixed":"{0} months","date.day":"{0} day","date.days":"{0} days","date.days.prefixed":"{0} days","date.hour":"{0} hour","date.hours":"{0} hours","date.hours.prefixed":"{0} hours","date.minute":"{0} minute","date.minutes":"{0} minutes","date.minutes.prefixed":"{0} minutes","date.second":"{0} second","date.seconds":"{0} seconds","date.seconds.prefixed":"{0} seconds"},langFn=function(id,params){var returnValue=lang[id]||"";if(params){for(var i=0;i<params.length;i++){returnValue=returnValue.replace("{"+i+"}",params[i])}}return returnValue},toDate=toDate?toDate:new Date,diff=fromDate-toDate,past=diff<0?true:false,diff=diff<0?diff*-1:diff,date=new Date(new Date(1970,0,1,0).getTime()+diff),returnString="",count=0,years=date.getFullYear()-1970;if(years>0){var langSingle="date.year"+(prefix?"":""),langMultiple="date.years"+(prefix?".prefixed":"");returnString+=(count>0?", ":"")+(years>1?langFn(langMultiple,[years]):langFn(langSingle,[years]));count++}var months=date.getMonth();if(count<levels&&months>0){var langSingle="date.month"+(prefix?"":""),langMultiple="date.months"+(prefix?".prefixed":"");
returnString+=(count>0?", ":"")+(months>1?langFn(langMultiple,[months]):langFn(langSingle,[months]));count++}else{if(count>0)count=99}var days=date.getDate()-1;if(count<levels&&days>0){var langSingle="date.day"+(prefix?"":""),langMultiple="date.days"+(prefix?".prefixed":"");returnString+=(count>0?", ":"")+(days>1?langFn(langMultiple,[days]):langFn(langSingle,[days]));count++}else{if(count>0)count=99}var hours=date.getHours();if(count<levels&&hours>0){var langSingle="date.hour"+(prefix?"":""),langMultiple="date.hours"+(prefix?".prefixed":"");returnString+=(count>0?", ":"")+(hours>1?langFn(langMultiple,[hours]):langFn(langSingle,[hours]));count++}else{if(count>0)count=99}var minutes=date.getMinutes();if(count<levels&&minutes>0){var langSingle="date.minute"+(prefix?"":""),langMultiple="date.minutes"+(prefix?".prefixed":"");returnString+=(count>0?", ":"")+(minutes>1?langFn(langMultiple,[minutes]):langFn(langSingle,[minutes]));count++}else{if(count>0)count=99}var seconds=date.getSeconds();if(count<levels&&seconds>0){var langSingle="date.second"+(prefix?"":""),langMultiple="date.seconds"+(prefix?".prefixed":"");returnString+=(count>0?", ":"")+(seconds>1?langFn(langMultiple,[seconds]):langFn(langSingle,[seconds]));count++}else{if(count>0)count=99}if(prefix){if(returnString==""){returnString=langFn("date.now")}else if(past)returnString=langFn("date.past",[returnString]);else returnString=langFn("date.future",[returnString])}return returnString}});window.require.register("/component/common/util/directives.js",function(exports,module,require){module.exports=function(){Vue.directive("base-class",{update:function(value){var baseClass=this.key,el=$(this.el),gclass=el.attr("gclass");if(!gclass)return el.addClass(baseClass);gclass=gclass.trim().split(" ");gclass=baseClass+" "+gclass.map(function(cls){return baseClass+"__"+cls}).join(" ");el.addClass(gclass)}});var dom_events=["BeforeUnloadEvent","CheckboxStateChange","DOMAttrModified","DOMAttributeNameChanged","DOMCharacterDataModified","DOMContentLoaded","DOMElementNameChanged","DOMMenuItemActive","DOMMenuItemInactive","DOMMouseScroll","DOMNodeInserted","DOMNodeInsertedIntoDocument","DOMNodeRemoved","DOMNodeRemovedFromDocument","DOMSubtreeModified","DragEvent","HashChangeEvent","MozAudioAvailable","MozGamepadButtonDown","MozGamepadButtonUp","MozMousePixelScroll","MozOrientation","MozScrolledAreaChanged","MutationEvent","MutationNameEvent","PageTransitionEvent","PopStateEvent","RadioStateChange","SVGAbort","SVGError","SVGEvent","SVGLoad","SVGResize","SVGScroll","SVGUnload","SVGZoom","SVGZoomEvent","SensorEvent","TimeEvent","ValueChange","abort","afterprint","afterscriptexecute","alerting","animationend","animationiteration","animationstart","audioprocess","beforeprint","beforescriptexecute","beforeunload","beginEvent","blocked","blur","broadcast","busy","cached","callschanged","canplay","canplaythrough","cardstatechange","cfstatechange","change","chargingchange","chargingtimechange","checking","click","close","command","commandupdate","compassneedscalibration","complete","compositionend","compositionstart","compositionupdate","connected","connecting","connectionInfoUpdate","contextmenu","copy","cut","datachange","dataerror","dblclick","delivered","devicelight","devicemotion","deviceorientation","deviceproximity","dialing","disabled","dischargingtimechange","disconnected","disconnecting","downloading","drag","dragend","dragenter","dragleave","dragover","dragstart","drop","durationchange","emptied","enabled","endEvent","ended","error","focus","focusin","focusout","fullscreenchange","fullscreenerror","gamepadconnected","gamepaddisconnected","hashchange","held","holding","icccardlockerror","iccinfochange","incoming","input","invalid","keydown","keypress","keyup","levelchange","link","load","loadeddata","loadedmetadata","loadend","loadstart","localized","message","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","mousewheel","mozbrowserclose","mozbrowsercontextmenu","mozbrowsererror","mozbrowsericonchange","mozbrowserloadend","mozbrowserloadstart","mozbrowserlocationchange","mozbrowseropenwindow","mozbrowsersecuritychange","mozbrowsershowmodalprompt","mozbrowsertitlechange","moztimechange","notification","noupdate","obsolete","offline","online","open","orientationchange","overflow","pagehide","pageshow","paste","pause","play","playing","pointerlockchange","pointerlockerror","popstate","popuphidden","popuphiding","popupshowing","popupshown","progress","ratechange","readystatechange","received","repeatEvent","reset","resize","resuming","scroll","seeked","seeking","select","sent","show","smartcard-insert","smartcard-remove","stalled","statechange","statuschange","stkcommand","stksessionend","storage","submit","success","suspend","timeout","timeupdate","touchcancel","touchend","touchenter","touchleave","touchmove","touchstart","transitionend","underflow","unload","updateready","upgradeneeded","userproximity","ussdreceived","versionchange","visibilitychange","voicechange","volumechange","waiting","wheel"];var prefixes=["-webkit-","-moz-","-ms-"];var utils=Vue.require("utils"),directive={isFn:true,bind:function(){this.context=this.binding.isExp?this.vm:this.binding.compiler.vm},update:function(handler){if(typeof handler!=="function"){utils.warn('Directive "v-on:'+this.expression+'" expects a method.');return}this.unbind();var vm=this.vm,context=this.context;this.handler=function(e){e.targetVM=vm;context.$event=e;var res=handler.call(context,e);context.$event=null;return res};var k=vm==context?this.arg:this.key;if((this.el.hasOwnProperty("on"+this.arg)||dom_events.indexOf(this.arg)!=-1)&&!context[this.arg]){return this.el.addEventListener(this.arg,this.handler)}if(context[k]){this.handler=handler.bind(context);return vm.$on(this.arg,this.handler)}},unbind:function(){if(this.context[this.arg]){return this.vm.$off(this.arg,this.handler)}this.el.removeEventListener(this.arg,this.handler)}},with_directive={bind:function(){var self=this,childKey=self.arg,parentKey=self.key,compiler=self.compiler,owner=self.binding.compiler;if(compiler===owner){this.alone=true;return}if(childKey){if(!compiler.bindings[childKey]){compiler.createBinding(childKey)}compiler.observer.on("change:"+childKey,function(val){if(compiler.init)return;if(!self.lock){self.lock=true;utils.nextTick(function(){self.lock=false})}owner.vm.$set(parentKey,val)})}},update:function(value){if(!this.alone&&!this.lock){if(this.arg){this.vm.$set(this.arg,value)}else if(this.vm.$data!==value){this.vm.$data=this.vm.$data?utils.extend(this.vm.$data,value):value}}}};Vue.directive("with-custom",with_directive);Vue.directive("on-component",directive);Vue.directive("on",directive)}()});window.require.register("/component/common/util/filter.js",function(exports,module,require){module.exports=function(){var regArr=/\[|\]/i,arr=[];function makeArr(str){return str.replace(/\[|\]/gi,"").split(",")}Vue.filter("contain",function(value,contain){if(!value||typeof value!="string")return false;if(regArr.test(contain)){arr=makeArr(contain);return _.some(arr,function(name){return value.toLowerCase().indexOf(name)!=-1})}return value.toLowerCase().indexOf(contain)!=-1});Vue.filter("notcontain",function(value,contain){if(!value)return false;if(regArr.test(contain)){arr=makeArr(contain);return _.some(arr,function(name){return value.toLowerCase().indexOf(name)==-1})}return value.toLowerCase().indexOf(contain)==-1});Vue.filter("paymentmonth",function(value){if(!value)return"MM";var month=""+value;if(month.length<2)month="0"+month;return month});Vue.filter("normalprice",function(planName,price){if(!planName)return false;var plan=_.find(this.$get("plans"),{name:planName});return plan&&plan.price});Vue.filter("humannumber",function(value){if(!value)return;return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")})}()});window.require.register("/component/common/util/mobile.js",function(exports,module,require){module.exports=function(userAgent){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(userAgent.substr(0,4))}});window.require.register("/component/common/util/validators.js",function(exports,module,require){var validator=function(){var validators={cvv:isCVVValid,encryptedCvv:isCVVValid,cc_exp_mm:isValidMonth,encryptedMonth:isValidMonth,cc_exp_yyyy:isValidYear,encryptedYear:isValidYear,zip:isZipValid,billingZip:isZipValid,cc_no:isCardNumberValid,encryptedCardNumber:isCardNumberValid,dateinpast:isDateInThePast};function isCVVValid(value){return/^\d{3,4}$/.test(value)}function isZipValid(value){var zipReg=/^[-\w\s]{3,12}$/;return zipReg.test(value)||value.length==0}function checkLuhn(cardNo){var s=0;var doubleDigit=false;for(var i=cardNo.length-1;i>=0;i--){var digit=cardNo.charAt(i)-"0";if(doubleDigit){digit=digit*2;if(digit>9)digit=digit-9}s=s+digit;doubleDigit=!doubleDigit}return s%10==0}function isDateInThePast(options){var isDateInPast=false;var currentYear=(new Date).getFullYear()-2e3,yearData=options["cc_exp_yyyy"]||options["encryptedYear"],monthData=options["cc_exp_mm"]||options["encryptedMonth"],currentMonth=(new Date).getMonth()+1,year=parseInt(yearData),month=parseInt(monthData);if(currentYear==year&&currentMonth>month){isDateInPast=true}return isDateInPast}function isValidMonth(value){var intMonth=parseInt(value);var regularMonth=/^\d{1,2}$/;return regularMonth.test(value)&&intMonth<=12}function isValidYear(value){var currentYear=(new Date).getFullYear();var currentYearLastTwoNumbers=currentYear-2e3;return value>=currentYearLastTwoNumbers&&value.length>1&&value-currentYearLastTwoNumbers<=10}function isCardNumberValid(cardnumber){var cardNumber=cardnumber.replace(/\s/g,"");if(!(cardNumber&&checkLuhn(cardNumber)&&cardNumber.length==16&&(cardNumber[0]==4||cardNumber[0]==5&&cardNumber[1]>=1&&cardNumber[1]<=5||(cardNumber.indexOf("6011")==0||cardNumber.indexOf("65")==0))||cardNumber.length==15&&(cardNumber.indexOf("34")==0||cardNumber.indexOf("37")==0)||cardNumber.length==13&&cardNumber[0]==4)){return false}return true}return validators}();module.exports=validator});window.require.register("/component/editor/advanced-dialog/advanced-dialog.js",function(exports,module,require){var AdvancedDialog=function(options){var options=options,statesList=["uninitialized","showen","hidden"],defaultState="uninitialized",state=defaultState;var events=AdvancedDialog.Events({handleHide:hideStatusMessage}),autoHide=AdvancedDialog.AutoHide({handleHide:hideStatusMessage,autoHideTime:options.autoHideTime,autoHide:options.autoHide}),templater=AdvancedDialog.Templater(options);function showStatusMessage(statusData){autoHide.clearAutoHideTimer();templater.append(statusData);if(autoHide.isAutoHide())autoHide.addAutoHide();state="showen"}function changeConfig(config){for(var option in config){options[option]=config[option]}}function hideStatusMessage(){autoHide.clearAutoHideTimer();templater.hide();if(options.onHide)options.onHide();state="hidden"}function getState(){return state}function removeStatusMessage(){events.unbind();templater.remove();state=defaultState}return{getState:getState,events:events,config:changeConfig,remove:removeStatusMessage,show:showStatusMessage,hide:hideStatusMessage}};AdvancedDialog.Templater=function(options){var $template,showClass="showed",hideClass="hidden";function createTemplate(data){var template=Handlebars.partials[options.templateName](data);$template=$(template)}function appendToContainer(statusData){if(!$template)createTemplate(statusData);$template.removeClass(hideClass).addClass(options.type).addClass(showClass);$(options.container).prepend($template);_changeInitialType(options.type)}function removeTemplate(){if(!$template)return;$template.remove();$template=undefined}function hideTemplate(){if(!$template)return;var initialState=_getInitialType(options.type);$template.removeClass(initialState).removeClass(showClass).addClass(hideClass)}function _changeInitialType(type){$template.data("initial-type",type)}function _getInitialType(type){return $template.data("initial-type")}return{hide:hideTemplate,create:createTemplate,remove:removeTemplate,append:appendToContainer}};AdvancedDialog.AutoHide=function(options){var timeoutID,AUTO_HIDE_TIMEOUT=7e3;function isAutoHide(){return options.autoHide}function clearAutoHideTimer(){if(timeoutID)clearTimeout(timeoutID)}function addAutoHide(){timeoutID=setTimeout(options.handleHide,options.autoHideTime||AUTO_HIDE_TIMEOUT)}return{isAutoHide:isAutoHide,clearAutoHideTimer:clearAutoHideTimer,addAutoHide:addAutoHide}};AdvancedDialog.Events=function(options){var UI={$document:$("document"),$body:$("body")};var eventsList=[];function unbindEvents(){eventsList.forEach(function(obj){UI.$body.off(obj["type"],obj["element"])})}function addEvent(eventsObj){for(var name in eventsObj){var elementAndEvent=_extractElementAndEventFromString(name),element=elementAndEvent[0],event=elementAndEvent[1],callback=eventsObj[name];UI.$body.on(event,element,callback);eventsList.push({type:event,element:element})}}function _extractElementAndEventFromString(string){return string.split(":")}return{bind:addEvent,unbind:unbindEvents}};module.exports=AdvancedDialog});window.require.register("/component/editor/apps-list/apps-list.js",function(exports,module,require){var user=require("/js/user"),detect=require("/detect/detect"),util=require("/js/util"),config=require("/js/config"),isWindows=util.isWindows(),isMac=util.isMac();module.exports=Vue.component("editor-apps-list",{template:Handlebars.partials.editor__apps_list(),replace:true,data:{items:[]},methods:{onInstall:function(item){switch(item){case"extension-chrome":chrome.webstore.install("https://chrome.google.com/webstore/detail/"+config.LITE_ID,function(){this.$dispatch("track:apps-install",item)}.bind(this),function(){});break;case"extension-firefox":var url="https://addons.mozilla.org/firefox/downloads/latest/566314/addon-566314-latest.xpi";window.InstallTrigger.install({Grammarly:{URL:url,IconURL:"https://addons.cdn.mozilla.net/user-media/addon_icons/566/566314-32.png",toString:function(){return url}}});this.$dispatch("track:apps-install",item);break;default:this.$dispatch("track:apps-install",item);break}},onLearningMore:function(item){this.$dispatch("track:apps-learn-more",item)}},attached:function(){var groups=user.$get("groups")||[],extensionID=window.GR_EXTENSION_ID;var browserItem=initBrowserItem(),officeAddinItem={item:"office-addin",title:"Grammarly for Microsoft® Office",text:"If you prefer to write documents using Microsoft® Word, then installing Grammarly’s add-in is a must. As a bonus, this add-in also integrates with Outlook™ to help you ensure your emails are grammatically correct before you hit send.",installed:false,tooltip:"Grammarly for Microsoft® Office is already installed",link:"http://download-office.grammarly.com/latest/GrammarlyAddInSetup.exe",more:"http://www.grammarly.com/office-addin/windows",img:"img_ms_office"},desktopMacItem={item:"desktop-mac",title:"Grammarly for OS X",text:"Grammarly’s native app will be right at home on your desktop. Access your documents or start a new project with one simple click.",installed:false,tooltip:"Grammarly for OS X is already installed.",link:"http://download-editor.grammarly.com/osx/Grammarly.dmg",more:"https://www.grammarly.com/native/mac",img:"img_osx"},desktopWinItem={item:"desktop-windows",title:"Grammarly for Windows",text:"Grammarly’s native app will be right at home on your desktop. Access your documents or start a new project with one simple click.",installed:false,tooltip:"Grammarly for Windows is already installed.",link:"http://download-editor.grammarly.com/windows/GrammarlySetup.exe",more:"https://www.grammarly.com/native/windows",img:"img_windows"};this.items=initApps();function initApps(){var items=[];browserItem&&items.push(browserItem);if(detect.operationSystem()=="windows"){officeAddinItem.installed=groups.some(function(group){return group&&group.indexOf("office-addin")>-1});items.push(officeAddinItem)}if(isMac){desktopMacItem.installed=groups.some(function(group){return group&&group.indexOf("desktop_editor_used")>-1});items.push(desktopMacItem)}else{desktopWinItem.installed=groups.some(function(group){return group&&group.indexOf("desktop_editor_used")>-1});items.push(desktopWinItem)}return items}function initBrowserItem(){var item={title:"Grammarly for ",text:"Grammarly’s free browser extension helps you write mistake-free in Gmail, Facebook, WordPress, Linkedin, and anywhere else you write on the Web.",installed:false,img:"img_"+detect.browser,item:"extension-"+detect.browser};item.installed=groups.some(function(group){return group&&group.indexOf("extension-"+detect.browser)>-1})||extensionID;switch(detect.browser){case"safari":item.title+="Safari";item.tooltip="Grammarly’s Safari Browser Extension is already installed";item.link="https://safary-grammarly-plugin.s3.amazonaws.com/grammarly.safariextz";item.more="https://www.grammarly.com/safari_install";break;case"chrome":item.title+="Chrome";item.tooltip="Grammarly’s Chrome Browser Extension is already installed";item.more="https://chrome.google.com/webstore/detail/grammarly-spell-checker-g/kbfnbcaeplbcioakkpcpgfkobkghlhen?hl=en";break;case"firefox":item.title+="Firefox";item.tooltip="Grammarly’s Firefox Browser Extension is already installed";item.more="https://addons.mozilla.org/en-US/firefox/addon/grammarly-1/";break;default:return}return item}}})});window.require.register("/component/editor/banner/banner.config.js",function(exports,module,require){var list=[{name:"referral",priority:1,content:{title:"Free Premium Upgrade",description:"Get a friend to try Grammarly, and you’ll both get one FREE week of Premium."},button:{label:"Go Premium!"}},{name:"no-referral",priority:1,later:false,dismiss:false,content:{title:"Sorry. This offer is for free users only.",description:"You are already a Premium Grammarly user. <br />This referral program works only for free users."},button:{label:"Got it"}},{name:"desktop-mac",priority:2,content:{title:"Add Grammarly to OS X ",description:"Now you can launch Grammarly with just one click straight from your desktop. Mistake-free writing has never been easier."},link:{href:"http://download-editor.grammarly.com/osx/Grammarly.dmg",label:"Install now"}},{name:"desktop-windows",priority:2,content:{title:"Add Grammarly to Windows",description:"Now you can launch Grammarly with just one click straight from your desktop. Mistake-free writing has never been easier."},link:{href:"http://download-editor.grammarly.com/windows/GrammarlySetup.exe",label:"Install now"}},{name:"office-addin",priority:3,content:{title:"You can now use Grammarly within Microsoft Office&trade;",description:"Grammarly Add-in works great with Word and Outlook."},link:{href:"http://www.grammarly.com/office-addin",label:"Download the Grammarly Add-in now"}},{name:"safari-extension",priority:4,content:{title:"Add Grammarly extension to Safari",description:"Grammarly helps you write mistake-free in&nbsp;Gmail, Facebook, WordPress, Linkedin, and anywhere else you write on&nbsp;the Web."},button:{label:"Install now"}},{name:"firefox-extension",priority:5,content:{title:"Add Grammarly extension to Firefox",description:"Grammarly helps you write mistake-free in&nbsp;Gmail, Facebook, WordPress, Linkedin, and anywhere else you write on&nbsp;the Web."},button:{label:"Install now"}},{name:"chrome-extension",priority:6,content:{title:"Add Grammarly extension to Chrome",description:"Grammarly helps you write mistake-free in&nbsp;Gmail, Facebook, WordPress, Linkedin, and anywhere else you write on&nbsp;the Web."},button:{label:"Install now"}},{name:"campaign-end",priority:7,content:{title:"Sorry, but this offer is no longer valid :(",description:"However, you can select one of&nbsp;the plans below and improve your writing in&nbsp;no&nbsp;time."}},{name:"proofit",priority:8}];var structure={banners:{showen:[],dismiss:[],later:[]}};exports.structure=structure;exports.getList=function(){return _.sortBy(list,"priority").reverse()}});window.require.register("/component/editor/banner/banner.controller.js",function(exports,module,require){var model=require("/component/editor/banner/banner.model");var referral=require("/component/editor/referral/referral");var user=require("/js/user");var util=require("/js/util");var storage=require("/js/local-storage");var detect=require("/detect/detect");var app,extensionID,groups,isWindows=util.isWindows(),isMac=util.isMac();function initNotificationController(){extensionID=window.GR_EXTENSION_ID;app=require("/js/app");groups=user.$get("groups")||[];checkLaterBanner();initializeBanners();app.$on("banner:dismiss",dismissNotification);app.$on("banner:later",laterNotification)}function addNotification(name){model.add(name)}function showNotification(){var listNotifications=model.list(),showenNotifications=listNotifications.showen[0];if(showenNotifications=="office-addin"){storage.save("addinBannerShowed",true)}app.$broadcast("banner:show",showenNotifications)}function checkLaterBanner(){var banners=model.list();banners.later.map(function(fullname){var now=(new Date).getTime(),laters=fullname.split(":"),time=laters[1];if(now>time){model.remove("later",fullname)}})}function initializeBanners(){var isFreemium=user.$get("freemium");model.removeAll("showen");if(isWindows){initWindowsBanner()}else{model.remove("showen","office-addin")}isFreemium&&initExtensionBanner();isMac&&initMacBanner();initReferralBanner()}function initReferralBanner(){var isCookieDiscount=$.cookie("GrammarlyDiscount");var isCookieReferral=$.cookie("GrammarlyReferral");if(isCookieReferral&&user.isPremiumNotFreeUser())return model.add("no-referral");if(user.isInstitutionUser()||!referral.showBanner()||!!isCookieDiscount)return;model.removeAll("showen");model.add("referral")}function initWindowsBanner(){var addinBannerShowed=storage.get("addinBannerShowed");var isAddinInstalled=groups.some(function(group){return group&&group.indexOf("office-addin")>-1});if(!isAddinInstalled&&!addinBannerShowed){model.add("office-addin")}initDesktopBanner("windows")}function initMacBanner(){initDesktopBanner("mac")}function initDesktopBanner(os){var isDesktopInstalled=groups.some(function(group){return group&&group.indexOf("desktop_editor_used")>-1});if(!isDesktopInstalled){model.add("desktop-"+os)}}function initExtensionBanner(){var browser=detect.browser,hasGroup;if(browser=="firefox"){hasGroup=groups.some(function(group){return group&&group.indexOf("extension-"+browser)>-1})}if(extensionID||hasGroup)return;var bannerName=browser+"-extension";model.add(bannerName)}function destroyEvents(){var app=require("/js/app");app.$off("banner:dismiss");app.$off("banner:later")}function dismissNotification(name){model.dismiss(name);app.$broadcast("banner:dismiss",name)}function laterNotification(name){model.later(name);app.$broadcast("banner:later",name)}exports.later=laterNotification;exports.show=showNotification;exports.dismiss=dismissNotification;exports.add=addNotification;exports.init=initNotificationController;exports.destroy=destroyEvents});window.require.register("/component/editor/banner/banner.model.js",function(exports,module,require){var user=require("/js/user");var banners=require("/component/editor/banner/banner.config").getList();var defaultBanners=_.map(banners,"name");var structure=require("/component/editor/banner/banner.config").structure;function inArray(name,el){var nameReg=new RegExp(name,"ig");return nameReg.test(el)}function getUserBanners(){return user.$get("settings.banners")||structure.banners}function add(name){if(add.timer)clearTimeout(add.timer);if(inSomeList(name))return false;var banners=getUserBanners();var showen=banners.showen;showen.push(name);banners.showen=_.intersection(defaultBanners,showen);add.timer=setTimeout(function(){save(banners)},400)}function inList(listname,name){var banners=getUserBanners()||{};return _.some(banners[listname],inArray.bind(null,name))}function inSomeList(name){return inList("dismiss",name)||inList("later",name)||inList("showen",name)}function save(data){user.setSettings({banners:data})}function remove(listname,name){var banners=getUserBanners();_.remove(banners[listname],inArray.bind(null,name));user.$set("settings.banners",banners)}function removeAll(listname){var banners=getUserBanners();banners[listname]=[];user.$set("settings.banners",banners)}function dismiss(name){var banners=getUserBanners();remove("showen",name);banners.dismiss.push(name);save(banners)}function later(name){var now=(new Date).getTime()+24*3600*1e3;var banners=getUserBanners();remove("showen",name);banners.later.push(name+":"+now);save(banners)}function contain(){if(arguments.length==1)return inSomeList;else if(arguments.length==2)return inList}function inSpecificList(name){var chain={};chain.contain=contain.bind(name);return chain}exports.in=inSpecificList;exports.list=getUserBanners;exports.add=add;exports.later=later;exports.dismiss=dismiss;exports.remove=remove;exports.removeAll=removeAll;exports.contain=contain});window.require.register("/component/editor/banner/banner.view.js",function(exports,module,require){var _f=function(){};var config=require("/js/config");var notificationConfig=require("/component/editor/banner/banner.config").getList();var user=require("/js/user");Vue.component("banner:container-main",{replace:true,template:Handlebars.partials.banner__container(),created:function(){this.$on("banner:show",this.showBanner);this.$on("banner:close",this.handleClose)},data:{name:undefined},methods:{showBanner:function(name){if(!name)this.name=undefined;else this.name="banner:"+name;this.className=name;this.show=true},handleClose:function(){this.show=false}}});var Notification=Vue.extend({replace:true,data:{show:true,dismiss:true,later:true},template:Handlebars.partials.banner__item(),methods:{handleDismiss:function(){this.$dispatch("tracker:banner-dismiss",this.name);this.$dispatch("banner:dismiss",this.name);this.handleClose(true)},handleClose:function(isTracked){this.show=false;this.$dispatch("banner:close",this.name);if(!isTracked){this.$dispatch("tracker:banner-close",this.name)}},handleLater:function(){this.$dispatch("banner:later",this.name);this.$dispatch("tracker:banner-later",this.name);this.handleClose(true)},handleClick:function(){this.$dispatch("tracker:banner-click",this.name);this.handleClose(true)},showNotification:function(name){this.show=true}}});var NotificationChromeExtension=Notification.extend({data:_.find(notificationConfig,{name:"chrome-extension"}),created:function(){if(user.isInstitutionUser()){this.$set("show",false)}else{this.$dispatch("tracker:banner-show",this.$data.name)}},methods:{handleAction:function(){var me=this;this.$dispatch("tracker:banner-click",this.name);chrome.webstore.install("https://chrome.google.com/webstore/detail/"+config.LITE_ID,me.handleLater.bind(me),_f)}}});var NotificationFirefoxExtension=Notification.extend({data:_.find(notificationConfig,{name:"firefox-extension"}),created:function(){if(user.isInstitutionUser()){this.$set("show",false)}else{this.$dispatch("tracker:banner-show",this.$data.name)}},methods:{handleAction:function(){this.$dispatch("tracker:banner-click",this.name);var url="https://addons.mozilla.org/firefox/downloads/latest/566314/addon-566314-latest.xpi";window.InstallTrigger.install({Grammarly:{URL:url,IconURL:"https://addons.cdn.mozilla.net/user-media/addon_icons/566/566314-32.png",toString:function(){return url}}})}}});var NotificationSafariExtension=Notification.extend({data:_.find(notificationConfig,{name:"safari-extension"}),created:function(){if(user.isInstitutionUser()){this.$set("show",false)}else{this.$dispatch("tracker:banner-show",this.$data.name)}},methods:{handleAction:function(){this.$dispatch("tracker:banner-click",this.name);document.location="https://safary-grammarly-plugin.s3.amazonaws.com/grammarly.safariextz"}}});var NotificationOfficeAddin=Notification.extend({data:_.find(notificationConfig,{name:"office-addin"}),created:function(){if(user.isInstitutionUser()){this.$set("show",false)}else{this.$dispatch("tracker:banner-show",this.$data.name)}}});var NotificationEndCampaign=Notification.extend({data:_.find(notificationConfig,{name:"campaign-end"})});var NotificationReferral=Notification.extend({data:_.find(notificationConfig,{name:"referral"}),created:function(){this.$dispatch("track:referral-banner-shown",{placement:"referral_topbanner",product:"editor"})},methods:{handleClose:function(){this.show=false;this.$dispatch("banner:close",name);this.$dispatch("track:referral-notification-closed","topBanner")},handleAction:function(){this.$dispatch("track:referral-button-clicked",{placement:"referral_topbanner",product:"editor"});this.$dispatch("referral:show-dialog")}}});var NotificationNoReferral=Notification.extend({data:_.find(notificationConfig,{name:"no-referral"}),created:function(){this.$dispatch("track:referral-premium-notification-shown",{placement:"referral_topbanner",product:"editor"})},methods:{handleClose:function(){this.show=false;this.$dispatch("banner:close",name);this.$dispatch("track:referral-notification-closed","topBannerPremium")},handleAction:function(){$.removeCookie("GrammarlyReferral",{domain:".grammarly.com",path:"/"});this.show=false}}});var NotificationDesktopMac=Notification.extend({data:_.find(notificationConfig,{name:"desktop-mac"}),created:function(){if(user.isInstitutionUser()){this.$set("show",false)}else{this.$dispatch("tracker:banner-show",this.$data.name)}}});var NotificationDesktopWindows=Notification.extend({data:_.find(notificationConfig,{name:"desktop-windows"}),created:function(){if(user.isInstitutionUser()){this.$set("show",false)}else{this.$dispatch("tracker:banner-show",this.$data.name)}}});Vue.component("banner:referral",NotificationReferral);Vue.component("banner:no-referral",NotificationNoReferral);Vue.component("banner:chrome-extension",NotificationChromeExtension);Vue.component("banner:office-addin",NotificationOfficeAddin);Vue.component("banner:safari-extension",NotificationSafariExtension);Vue.component("banner:firefox-extension",NotificationFirefoxExtension);Vue.component("banner:campaign-end",NotificationEndCampaign);
Vue.component("banner:desktop-mac",NotificationDesktopMac);Vue.component("banner:desktop-windows",NotificationDesktopWindows)});window.require.register("/component/editor/button-upgrade/button-upgrade.js",function(exports,module,require){module.exports=Vue.component("editor:button-upgrade",{template:Handlebars.partials.editor__button_upgrade(),replace:true,methods:{upgrade:function(){this.$emit("upgradeClicked")}}})});window.require.register("/component/editor/counter-plus-premium/counter-plus-premium.js",function(exports,module,require){module.exports=Vue.component("editor:counter-plus-premium",{template:Handlebars.partials.editor__counter_plus_premium(),replace:true})});window.require.register("/component/editor/counter-plus/counter-plus.js",function(exports,module,require){var user=require("/js/user");module.exports=Vue.component("editor:counter-plus",{template:Handlebars.partials.editor__counter_plus(),data:{isLearnMore:false,isTryPremium:false},created:function(){var isLearnMore=user.$get("mimic").indexOf("editor_upgrade_variation_1")>-1;var isTryPremium=user.$get("mimic").indexOf("editor_upgrade_variation_2")>-1;this.$set("isLearnMore",isLearnMore);this.$set("isTryPremium",isTryPremium)},replace:true})});window.require.register("/component/editor/dd-upload/dd-upload.js",function(exports,module,require){Vue.component("editor:dd-upload",{template:Handlebars.partials.editor__dd_upload(),replace:true,data:{active:false,hovered:false,dd_uploading:false},methods:{leave:leave},created:function(){this.over=over.bind(this);this.drop=drop.bind(this);this.leave=leave.bind(this);$(document).on("dragover",this.over).on("drop",this.drop)},beforeDestroy:function(){$(document).off("dragover",this.over).off("drop",this.drop)}});function canDrop(e){return $(e.target).is(".editor__dd_upload *")}function over(e){this.active=true;this.hovered=canDrop(e);clearTimeout(this.timer);this.timer=setTimeout(this.leave,100);e.stopPropagation();e.preventDefault();return false}function leave(){this.active=false;this.hovered=false;this.dd_uploading=false}function drop(e){var files=e.originalEvent.dataTransfer.files;if(!canDrop(e)||!files||!files.length)return;leave();e.preventDefault();e.stopPropagation();var me=this;this.$emit("drop-files",{files:files,onstart:function(){me.dd_uploading=true},onsuccess:function(doc){me.leave();app.toDocument(doc)},onend:me.leave})}});window.require.register("/component/editor/document-cards/cardHeight.js",function(exports,module,require){module.exports=function(card){var cardWrapHeight,longElHeight;var cardWrap=card.find(".card-wrap"),cardContent=card.find(".card-content"),btns=card.find(".btns"),btnsHeight=btns.height(),btnsMarginTop=parseInt(btns.css("margin-top")),btnsPaddingTop=parseInt(btns.css("padding-top")),longEl=card.find(".long"),shortElHeight=card.find(".short").height(),longWrap=card.find(".long-wrap"),cardScroller=card.find(".card-scroller");var maxHeight=Infinity;var margin=btnsPaddingTop+btnsMarginTop+1;function cardHeight(h){if(h==""){cardWrap.css("height",h);longEl.css("height",h);card.data("fullHeight",h);card.data("height",card.data("defaultHeight"));card.css("height","")}if(h!=""){initialScroll();cardWrap.css("height",h);card.css("height",h+1);card.data("height",h+btnsMarginTop)}}function initialScroll(){cardScroller.removeClass("scroll").css("height","");cardScroller.scrollTop(0)}function getContentHeight(){return cardContent.find(".mini").outerHeight(true)+cardContent.find(".short").outerHeight(true)+btnsHeight+margin}function setContentHeight(){if(card.hasClass("expand")){cardWrapHeight=getContentHeight();var h=card.hasClass("more")?parseInt(card.data("fullHeight")):cardWrapHeight;h=Math.round(h);cardHeight(h)}else{cardHeight("")}}function setMoreElHeight(force){longElHeight=longWrap.outerHeight(true);cardWrapHeight=getContentHeight();if(card.hasClass("more")){longEl.css("height",longElHeight+5);if(!card.data("fullHeight")||force){card.data("fullHeight",cardWrapHeight+longElHeight)}var h=parseInt(card.data("fullHeight")+6);h=Math.round(h);cardHeight(h)}else{cardWrapHeight=parseInt(card.data("fullHeight"));cardWrapHeight-=longElHeight;cardHeight(cardWrapHeight);longEl.css("height","");initialScroll()}}this.setContentHeight=setContentHeight;this.setMoreElHeight=setMoreElHeight}});window.require.register("/component/editor/document-cards/cardRenderer.js",function(exports,module,require){var user;try{user=require("/js/user")}catch(e){user={$get:function(){}}}module.exports=function(cards){var isInstitutionUser=typeof user.$get("institutionId")=="number";var pnl=cards.pnl;var container=pnl.find(".error-list-errors");function createCardEl(match,_top){var el=$("<div/>");if(match.syn)el.html(Handlebars.partials.synonyms_card(match));else el.html(Handlebars.partials.card(match));el=$(el[0].children[0]);el.css({transform:"translateY("+_top+"px)"});el.attr({"data-id":match.id});return el}function willMoveNext(card){return true}function updateMultiReplaceHead(el){var replaceWrap=el.find(".replace-wrap"),mini=el.find(".mini"),btns=el.find(".inline-btns"),lbl=el.find(".link-label");var replaceWrapWidth=parseInt(replaceWrap[0].getAttribute("data-scrollWidth"));if(isNaN(replaceWrapWidth)){replaceWrapWidth=replaceWrap[0].scrollWidth;replaceWrap[0].setAttribute("data-scrollWidth",replaceWrapWidth)}var lblPadding=parseInt(lbl.css("padding-left")),titleWidth=lblPadding+replaceWrapWidth,maxWidth=el[0].clientWidth-btns[0].clientWidth;var hideReplace=titleWidth>maxWidth;if(true){el.addClass("hideMultiReplace");el.removeClass("showMultiReplace")}else{el.removeClass("hideMultiReplace");el.addClass("showMultiReplace")}}function updateWrapping(el){if(el.hasClass("multiReplace")){return updateMultiReplaceHead(el)}if(!el||!el.hasClass("card-Spelling"))return;var replace=$(".replace",el),linkLabel=$(".link-label",el);if(replace.width()>=linkLabel.width()){var ins=$(".ins",replace),del=$(".del",replace),arr=$(".arr",replace);if(!ins.length||!del.length||!arr.length)return;var w=ins.outerWidth(),arrW=arr.outerWidth(),W=replace.outerWidth(),delta=Math.floor((1-(w+arrW)/W)*100);del.css({"max-width":delta+"%"})}}function processReplacements(el){updateWrapping(el)}function appendCard(match,prevEl,top){var el=createCardEl(match,top);el.data("y",top);el.data("defaultHeight",HEIGHT);el.data("height",HEIGHT);match.card=el;if(prevEl){if(willMoveNext(match))setTimeout(function(prevEl,el,match){if(!match.card)return;if(prevEl.parent().length){prevEl.after(el)}else{container.append(el)}processReplacements(el);if(match.selectCard){delete match.selectCard;cards.openAndScrollToCard(el,match)}}.bind(this,prevEl,el,match),200);else prevEl.after(el)}else{container.append(el);processReplacements(el);if(match.selectCard){delete match.selectCard;cards.openAndScrollToCard(el,match)}}if(match.syn){var sel=cards.selCard();if(sel)cards.closeCard(sel);cards.cardToText(match);cards.select(match,true);cards.updateOpenCardHeight()}}var HEIGHT=36;function render(){var CARD_MARGIN=10,GROUP_MARGIN=16,max=0,margin=0,prevEl;cards.cardY=[];var renderedIndex=0,prevTop,prevHeight=0,matchesLen=cards.matches.length;pnl[matchesLen==1?"addClass":"removeClass"]("one-card");for(var i=0;i<matchesLen;i++){var match=cards.matches[i];if(match.silent)continue;if(match.removed||!match.box){delete match.y;continue}var expanded=match.card&&match.card.hasClass("expand");if(!match.inViewPort&&!expanded){if(match.card)match.card.css("dislay","none");delete match.y;continue}var top=match.box.y1,marginedTop=top,cardTop,h=expanded?parseInt(match.card.data("height"))+GROUP_MARGIN:HEIGHT;if(prevTop!=top){margin=0;if(top<max)margin=max-top+GROUP_MARGIN;marginedTop=top+margin;prevTop=top;cardTop=marginedTop}else{cardTop=cards.cardY[renderedIndex-1]+prevHeight+CARD_MARGIN}cards.cardY.push(cardTop);match.margin=cardTop-top;match.y=cardTop;match.eduUser=isInstitutionUser;match.disableTitle=isInstitutionUser?!user.$get("institutionQuickReplacement"):true;match.eduCardHideReplacements=isInstitutionUser?!user.$get("institutionQuickReplacement"):false;match.eduShowFullCard=isInstitutionUser?user.$get("institutionFullCards"):false;match.isNotDeletingEnhancement=match.enhancement&&match.r&&match.r.filter(function(i){return i!==""}).length>0;if(match.card){if(!expanded){match.card.css({transform:"translateY("+cardTop+"px)"});match.card.data("y",cardTop)}}else{appendCard(match,prevEl,cardTop)}match.card.data("i",i);match.card.css("display","block");prevEl=match.card;max=cardTop+h;prevHeight=h;renderedIndex++}}this.render=render;this.updateWrapping=updateWrapping}});window.require.register("/component/editor/document-cards/cardScroll.js",function(exports,module,require){module.exports=function(cards){var pnl=cards.pnl;var pnlParent=pnl.parent().parent();var bg=$(".error-container");var txtContainer=$(".textarea-container .textarea-wrap");var textarea=txtContainer.find("textarea");var txtTop=0,animating=false,topPadding=46;var win=$(window),scrollEl=$(".main-scroller");win.on("resize",onScroll);scrollEl.scroll(onScroll);function onScroll(){var textareaHeight=textarea[0].clientHeight;var cardsHeight=cards.height();h=Math.max(textareaHeight,cardsHeight);var currentScroll=scrollEl.scrollTop();if(currentScroll>0)pnlParent.addClass("scroll");else pnlParent.removeClass("scroll");pnl.css({height:h});bg.css({height:h})}function finishAnimation(){animating=false}function textToCard(match){pnl.css({transform:"translateY(0px)"});txtTop=match.margin+11;if(getTransfromY(txtContainer)!=txtTop){txtContainer.css({transform:"translateY("+txtTop+"px)"});cards.txtStartAnimation()}}function cardToText(match){pnl.css({transform:"translateY("+(-match.margin-11)+"px)"});txtTop=0;txtContainerToInitial()}function txtContainerToInitial(){if(getTransfromY(txtContainer)!="0px"){txtContainer.css({transform:"translateY(0px)"});cards.txtStartAnimation()}textarea.scrollTop=0}function toViewPort(card,match){var top=parseInt(card.data("y"));var bottom=parseInt(card.data("height"))+top;var scroll=scrollEl.scrollTop();var winHeight=win.height()-topPadding;var delta=bottom-(winHeight+scroll);var maxDelta=top-scroll-10;delta=match&&match.syn?delta-match.margin-11:delta;if(delta>0){if(delta>maxDelta)delta=maxDelta;animating=true;scrollEl.data({scrollTop:scroll+delta});scrollEl.animate({scrollTop:scroll+delta},200,finishAnimation)}if(top<scroll){animating=true;scrollEl.data({scrollTop:top-15});scrollEl.animate({scrollTop:top-15},200,finishAnimation)}}function toTop(){scrollEl.scrollTop(0)}function toInitial(){pnl.css({transform:"translateY(0px)"});txtTop=0;txtContainerToInitial()}function update(){onScroll()}function scrollTop(){return scrollEl.scrollTop()}function txtScroll(){var result=getTransfromY(txtContainer);if(isNaN(result))return 0;return result}function getTransfromY(el){var matrix=(el.css("transform")||"").replace(/[^0-9\-.,]/g,"").split(",");return parseInt(matrix[5]||matrix[13]||0,10)}return{txtScroll:txtScroll,scrollTop:scrollTop,update:update,toInitial:toInitial,toTop:toTop,textToCard:textToCard,cardToText:cardToText,toViewPort:toViewPort}}});window.require.register("/component/editor/document-cards/cards.js",function(exports,module,require){var CardScroll=require("cardScroll"),CardRenderer=require("cardRenderer"),CardHeight=require("cardHeight"),Guide=require("guide"),user;try{user=require("/js/user")}catch(e){user={$get:function(){}}}module.exports=function(config){config=config||{};var isInstitutionUser=typeof user.$get("institutionId")=="number";var configDisableReplacement=isInstitutionUser?!user.$get("institutionFullCards"):true;var configEnableMiniCard=isInstitutionUser?user.$get("institutionQuickReplacement"):true;var pnl=$(".error-list");var container=pnl.find(".error-list-errors");var txtContainer=$(".textarea-container .textarea-wrap");var me=emitter({});var $window=$(window),$document=$(document);me.pnl=pnl;me.cardY=[];var scroll=new CardScroll(me);var renderer=new CardRenderer(me);me.matches=[];var selCard,deselectTimeout;var guide=new Guide({htmlElSelector:config.htmlElSelector});me.selCard=function(){return selCard};var emptyMatch={deselect:_f,select:_f,remove:_f};function matchById(id){return _.findWhere(me.matches,{id:id})||emptyMatch}function cardMatch(card){return matchById(card.attr("data-id"))}function renderCards(){renderer.render()}function removeCards(arr){for(var i=0;i<arr.length;i++){if(!arr[i].card)continue;if(selCard&&selCard[0]==arr[i].card[0])selCard=null;arr[i].card.remove();arr[i].card=null}}function trackInteraction(match){if(match.iterTracked||!match.renderTs)return;var time=Math.round((Date.now()-match.renderTs)/1e3);me.emit("tracking",{event:"matchFirstInteraction",matches:time});match.iterTracked=true}function trackOpen(){me.emit("tracking",{event:"matchExpand"})}function trackOpenMore(){me.emit("tracking",{event:"matchExpandMore"})}function selectCard(card){var match=cardMatch(card);deselectCurrent();selCard=card;card.addClass("sel");cardMatch(card).select(true);removeUndo();me.emit("tracking",{event:"matchSeen",matches:match})}function removeUndo(card){var undoCard=$(".b-card.undo");card=card||selCard;if(onRemoveUndo){onRemoveUndo();onRemoveUndo=null}if(undoCard.length>0){if($(card)[0]==undoCard[0])return;var id=undoCard.attr("data-id");var match=matchById(id);match&&match.remove()}}function deselectCard(card){if(!card)return;closeCard(card);card.removeClass("sel");var m=cardMatch(card);if(!m)return;m.deselect(true);selCard=null;clearTimeout(deselectTimeout);deselectTimeout=setTimeout(function(){scroll.toInitial()},90)}function closeCard(card){guide.remove();card.removeClass("expand");card.addClass("closed");card.removeClass("more");card.find(".btn-expand").attr("data-tooltip","Expand card");var replaceWrap=card.find(".replace-wrap");var match=cardMatch(card);if(match&&match.todo&&match.todo.indexOf("expand")!=-1){replaceWrap.attr("data-tooltip","Click to expand card")}replaceWrap.replaceWith(replaceWrap[0].outerHTML);var cardHeight=new CardHeight(card);cardHeight.setContentHeight();card.css({transform:"translateY("+parseInt(card.data("y"))+"px)"});renderCards();setTimeout(function(){scroll.update()},0)}function openCard(card,noScroll){guide.remove();card.addClass("expand");card.removeClass("closed");card.find(".btn-expand").attr("data-tooltip","Collapse card");var replaceWrap=card.find(".replace-wrap");var match=cardMatch(card);if(match&&match.todo&&match.todo.indexOf("expand")!=-1){replaceWrap.attr("data-tooltip","Click to collapse card")}replaceWrap.replaceWith(replaceWrap[0].outerHTML);var cardHeight=new CardHeight(card);cardHeight.setContentHeight();renderCards();scroll.update();trackInteraction(match);trackOpen();if(!noScroll)scroll.toViewPort(card,match)}me.openAndScrollToCard=openAndScrollToCard;function openAndScrollToCard(card,match){selectCard(card);openCard(card);if(!match.syn)textToCard(card)}function toggleMore(card){card.toggleClass("more");var cardHeight=new CardHeight(card);cardHeight.setMoreElHeight();renderCards();scroll.update();if(card.hasClass("more")){scroll.toViewPort(card);trackOpenMore()}}me.toggleExpand=toggleExpand;function toggleExpand(card,noScroll){guide.remove();var sameCard=false;if(selCard)sameCard=selCard[0]==card[0];var selectedSameCard=sameCard&&!selCard.hasClass("expand");if(!sameCard||selectedSameCard){if(!selectedSameCard)selectCard(card);openCard(card,noScroll);if(!noScroll)textToCard(card);clearTimeout(deselectTimeout)}else{deselectCard(card);scroll.toInitial()}if(card.hasClass("closed")){selCard=null}}me.textToCard=textToCard;function textToCard(card){scroll.textToCard(cardMatch(card))}function onKeydown(e){if(e.keyCode==27){if(selCard&&selCard.hasClass("expand")){toggleExpand(selCard);selCard=null}}}function deselectCurrent(){if(selCard&&selCard.hasClass("expand")){if(!$.contains(document.body,selCard[0])){return selCard=null}deselectCard(selCard);selCard=null}}function replace(card,match,el){var value=_.isString(el)?el:el.attr("data-value")||el.text();deselectCurrent();removeUndo();guide.remove();match.replace(value);card.addClass("undo not_hover");deselectCard(card);scroll.toInitial();trackInteraction(match)}function undo(card,match){onRemoveUndo=null;removeUndo(card);match.selected=false;guide.remove();if(match.ignored||match.addedToDict){var label=match.ignored?"matchUndoIgnored":"matchUndoAlwaysIgnored";match.replaced=false;match.ignored=false;match.addedToDict=false;$(".gr_"+match.id).removeClass("gr_replaced");me.emit("tracking",{event:label,matches:match})}else{match.undo()}card.removeClass("undo");if(match.selected){selectCard(card);openCard(card)}scroll.toInitial()}var onRemoveUndo;function ignore(card,match){removeUndo();guide.remove();deselectCard(card);setTimeout(scroll.toInitial,0);card.addClass("undo not_hover");match.replaced=true;match.ignored=true;$(".gr_"+match.id).addClass("gr_replaced");onRemoveUndo=function(){match.ignore()};trackInteraction(match);me.emit("ignore",match)}function acknowledged(card,match){removeUndo();guide.remove();deselectCard(card);setTimeout(scroll.toInitial,0);card.addClass("undo not_hover");match.replaced=true;match.ignored=true;$(".gr_"+match.id).addClass("gr_replaced");onRemoveUndo=function(){match.acknowledged()};trackInteraction(match)}function ignoreAll(card,match){removeUndo();guide.remove();match.ignoreAll();scroll.toInitial();trackInteraction(match);me.emit("ignoreAll",match)}function addToDict(card,match){removeUndo();guide.remove();deselectCard(card);setTimeout(scroll.toInitial,0);card.addClass("undo not_hover");match.replaced=true;match.addedToDict=true;$(".gr_"+match.id).addClass("gr_replaced");onRemoveUndo=function(){match.addToDict()};trackInteraction(match)}function nextCard(card){removeUndo();var i=parseInt(card.data("i"));var m=me.matches[i+1]||me.matches[0];var card=m.card;toggleExpand(card);scroll.toViewPort(card)}function onDocClick(e){var el=$(e.target);if(!el.is(".error-list, .error-panel, .textarea-container, .textarea-container *, .tool-panel *"))return;deselectCurrent();removeUndo()}function onCardClick(e){var el=e.currentTarget,$el=$(el);var id=el.getAttribute("data-id");var match=matchById(id);var target=$(e.target);var isSynonymCard=$el.hasClass("Synonyms");var isReplace=configEnableMiniCard&&target.is(".replace, .replace *");var isMini=target.is(".mini, .mini *");var isExpand=target.is(".btn-expand");var notClickable=!configEnableMiniCard||$el.hasClass("not-clickable-title");if(isSynonymCard)return procSyn($el,target,match);if($el.hasClass("undo"))return undo($el,match);if(!$el.hasClass("expand")&&target.is("a"))e.preventDefault();if($el.hasClass("expand")&&target.is("a"))return;if(target.is(".btn-undo"))return undo($el,match);if(target.is(".btn-ignore"))return ignore($el,match);if(target.is(".btn-more"))return toggleMore($el);if(target.is(".btn-ignore-all"))return ignoreAll($el,match);if(target.is(".btn-next"))return nextCard($el);if(target.is(".btn-dict, .btn-dict *"))return addToDict($el,match);if(target.is(".btn-acknowledged, .btn-acknowledged *"))return acknowledged($el,match);if(isExpand)return toggleExpand($el);if(target.is(".replacement span.btn-r"))return replace($el,match,$(e.target));if(target.parents(".replacement span.btn-r").length)return replace($el,match,target.parents(".replacement span.btn-r"));if(target.parents(".replacement-in-card").length)return replace($el,match,target.parents(".replacement-in-card").find(".ins"));if(target.is(".card-scroller, .card-scroller *"))return;if(notClickable)return toggleExpand($el);if(!target.is(".replace-wrap, .replace-wrap *"))return toggleExpand($el);if(!isExpand&&!notClickable&&!target.is(".replacements *"))return replace($el,match,match.rFirst);if(target.is(".b-card, .b-card .mini, .b-card .btn-expand"))return toggleExpand($el)}function onEduCardClick(e){var el=e.currentTarget,$el=$(el);var userShowFullCard=!user.$get("institutionFullCards");if($el.is(".expand")||$el.is(".undo")||userShowFullCard)return;$(".did-you-mean").find(".long").css({display:"none"});setTimeout(function(){toggleMore($el)},0)}function procSyn(el,target,match){if(match)match.selected=true;if(el.hasClass("undo")){undo(el,match);me.emit("undoSyn",match)}if(target.is(".replacement span.btn-r")){me.emit("replaceSyn");return replace(el,match,target)}}function replaceToInitial(el){el.html(el.data("initial"));var card=el.parents(".b-card");var delEl=card.find(".replace-wrap .del");delEl.html(delEl.data("initial"))}function highlightReplacements(el){if(el.is(".btn-r, .btn-r *")){if(!el.is(".btn-r"))el=el.parent();var card=el.parents(".b-card");var delEl=card.find(".replace-wrap .del");var insEl=el;var ins=insEl.text();var del=delEl.text();if(!delEl.data("initial"))delEl.data("initial",delEl.html());if(hoveredReplaceEl&&hoveredReplaceEl[0]!=insEl[0]){replaceToInitial(hoveredReplaceEl);hoveredReplaceEl=insEl}if(!hoveredReplaceEl){hoveredReplaceEl=insEl}var newDel=diffochka(ins,del);delEl.html(newDel)}else if(hoveredReplaceEl){replaceToInitial(hoveredReplaceEl);hoveredReplaceEl=null}}var hoverExpandCard;function updateHoverExpand(){if(hoverExpandCard)hoverExpandCard.removeClass("hover-expand");hoverExpandCard=null}function highlightMore(el){if(!el.is(".replace, .link-label, .hacky")){updateHoverExpand();return}var card=el.parents(".b-card");if(hoverExpandCard&&hoverExpandCard[0]!=card[0])updateHoverExpand();card.addClass("hover-expand");hoverExpandCard=card}me.txtContainerAnimationEnd=txtContainerAnimationEnd;function txtContainerAnimationEnd(){clearTimeout(animationTimer);txtContainer.removeClass("animating");txtAnimation=false}var txtAnimation,animationTimer;me.txtStartAnimation=function(){animationTimer=setTimeout(txtContainerAnimationEnd,300);txtContainer.addClass("animating");txtAnimation=true};function isTxtAnimation(){return txtAnimation}function drawGuide(card,id){guide.draw(card,$("#"+id),function(underline){if(!cardMatch(card)||!underline[0]){card.remove();renderCards();console.warn("potential error","removing card "+card);return true}return false},isTxtAnimation,scroll)}var hoveredSelector,hoveredCard,hoveredReplaceEl,undoHoveredCard;var guideTimer;function onMousemove(e){var el=$(e.target);if(undoHoveredCard&&!el.hasClass("btn-undo")){undoHoveredCard.removeClass("hover_undo").addClass("hover_transition");setTimeout(function(){this.removeClass("hover_transition")}.bind(undoHoveredCard),200);guide.remove();clearTimeout(guideTimer);var id=undoHoveredCard.attr("data-id");$(".gr_"+id).removeClass("sel");matchById(id).deselect(true);undoHoveredCard=null;return}highlightReplacements(el);highlightMore(el);if(!el.is(".b-card, .b-card *")){if(hoveredSelector&&!$(hoveredCard).is(".sel")){$(hoveredSelector).removeClass("sel");$(hoveredCard).removeClass("open-replacements");var m=matchById($(hoveredCard).attr("data-id"));m&&m.deselect(true);hoveredSelector=null;hoveredCard=null;guide.remove()}$(".b-card.undo.not_hover").removeClass("not_hover");return}var card=el.is(".b-card")?el:el.parents(".b-card");if(card.hasClass(".sel")||card.hasClass("hover_transition"))return;var id=card.attr("data-id");var selector=".gr_"+id;var sameCard=selector==hoveredSelector;if(!sameCard&&!$(hoveredCard).is(".sel")){$(hoveredSelector).removeClass("sel");$(hoveredCard).removeClass("open-replacements");if(hoveredSelector){var m=matchById(hoveredSelector.replace(".gr_",""));m&&m.deselect(true)}}var m=matchById(id);m&&m.select(true);if(card.hasClass("undo")){if(card.hasClass("hover_undo"))return;if(el.hasClass("btn-undo")&&!card.hasClass("not_hover")){card.addClass("hover_undo");guideTimer=setTimeout(function(){drawGuide(card,id)},200);undoHoveredCard=card}else{undoHoveredCard=null}card.css("height","");card.find(".card-wrap").css("height","");card.find(".long").css("height","");return}drawGuide(card,id);if(el.is(".replace, .replace *, .mini .replacements, .mini .replacements *")){if(card.is(".show-replacements")){if(!card.hasClass("calculated-replacements")){setMargin(card);card.addClass("calculated-replacements")}card.addClass("open-replacements")}}else{$(".open-replacements").removeClass("open-replacements")}if(!sameCard){me.emit("tracking",{event:"matchSeen",matches:m})}hoveredSelector=selector;hoveredCard=card}function setMargin(card){var repl=card.find(".mini .replacements"),margin=repl.find(".header-width:first-child").width();repl.css("margin-left",margin-19)}function updateOpenCardHeight(){var card=$(".b-card.expand");if(card.length==0)return;var cardHeight=new CardHeight(card);if(card.hasClass("more"))return cardHeight.setMoreElHeight(true);cardHeight.setContentHeight()}function updateDimensions(matches){updateOpenCardHeight();matches.forEach(function(match){var el=match.card;if(!el)return;renderer.updateWrapping(el);el.removeClass("calculated-replacements")})}me.height=function(){if(me.matches.length==0)return 0;var card=me.matches[me.matches.length-1].card;if(!card)return 0;return parseInt(card.data("height"))+parseInt(card.data("y"))};me.cardToText=scroll.cardToText;me.selectCard=selectCard;me.openCard=openCard;me.closeCard=closeCard;$document.on("click",".edu-card",onEduCardClick);$document.on("click",".b-card",onCardClick);$document.on("click",onDocClick);$window.on("keydown",onKeydown);$window.on("mousemove",onMousemove);$(".textarea-container").on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",txtContainerAnimationEnd);function close(){$document.off("click",".b-card",onCardClick);$document.off("click",onDocClick);$window.off("keydown",onKeydown);$window.off("mousemove",onMousemove);$(".textarea-container").unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",txtContainerAnimationEnd)}return _.extend(me,{removeUndo:removeUndo,render:function(_matches,added,removed){me.matches=_matches.sort(function(a,b){return a.s-b.s});if(removed.length!=0)removeCards(removed);renderCards()},clear:function(){removeCards(me.matches)},updateDimensions:updateDimensions,updateOpenCardHeight:updateOpenCardHeight,select:function(match,fromTextarea){if(!match.card||match.card.parent().parent().length==0){return match.selectCard=true}clearTimeout(deselectTimeout);selectCard(match.card);scroll.cardToText(match);if(!match.syn)toggleExpand(match.card,fromTextarea)},scrollTop:scroll.toTop,closeCard:closeCard,deselect:function(match){deselectCard(match.card)},collapse:function(){$(".b-card.expand").trigger("click")},close:close})}});window.require.register("/component/editor/document-cards/document-cards.js",function(exports,module,require){var Cards=require("cards");Vue.component("editor:document-cards",{template:Handlebars.partials.editor__document_cards(),replace:true,attached:function(){var cards=new Cards;_.extend(this,cards);cards.emit=this.$emit.bind(this)}})});window.require.register("/component/editor/document-cards/guide.js",function(exports,module,require){var svg=require("/js/util").svg;module.exports=function(config){config=config||{};var guideCard;var guideUnderline;var cardPanel=$(".error-panel")[0];var textareaEl=$("#textarea");var textareaWrap=$(".textarea-wrap");var scrollEl=$(".main-scroller");var hackHeight=1;var app=require("/js/app");var draw=function(card,underline,removeCard,isTxtAnimation,scroll){if(isTxtAnimation())return;if(guideCard&&guideCard[0]==card[0])return;if(guideCard)remove();if(card.hasClass("expand"))return;if(!card[0])return;guideCard=card;guideUnderline=underline;if(removeCard(guideUnderline))return;var svgConf;var el=underline[underline.length-1];var underlineEl=$(el);var cardPos=card[0].getBoundingClientRect();var underlinePos=underlineEl[0].getClientRects()[0];var underlineRight=underlinePos.right;var cardPanelLeft=cardPanel.getBoundingClientRect().left;var y1=Math.min(cardPos.bottom,underlinePos.top);var y2=Math.max(cardPos.bottom,underlinePos.top);var docTitleMarginTop=20;svgConf={underlineHeight:underlinePos.height,underlineTop:underlinePos.top,bottom:cardPos.top-underlinePos.top<-20,width:cardPos.right-underlineRight,cardBottom:cardPos.bottom,cardWidth:cardPos.width,height:Math.abs(y1-y2)+hackHeight,d:0,fontSize:parseInt(underlineEl.css("font-size"))};if(svgConf.height<svgConf.underlineHeight){svgConf.d=svgConf.underlineHeight-svgConf.height;svgConf.height=svgConf.underlineHeight}var top=y1-svgConf.d+scroll.scrollTop()+(app.isPopup?0:docTitleMarginTop);var left=underlineRight-cardPanelLeft;svgConf.top=top;svgConf.left=left;var txtTop=parseInt(textareaWrap.css("transform").replace(/[^0-9\-.,]/g,"").split(",")[5],10)||0;var marginTop=-(textareaEl[0].getBoundingClientRect().top+scrollEl.scrollTop())+txtTop;var style=createSvgStyle({width:svgConf.width,height:svgConf.height,top:top,left:left,marginTop:marginTop});svg({tag:"svg",attrs:{width:svgConf.width,height:svgConf.height,style:style,"class":"guide"},parent:".svg-container",childNodes:composePath(svgConf)})};var composePath=function(config){var calloutStart=70;var calloutEnd=calloutStart-20;var pathStart,pathAngle,pathEnd;var lastY=[config.height-hackHeight,config.d];config.bottom&&lastY.reverse();var y=lastY[1]+(config.bottom?0:config.underlineHeight);if(!config.bottom&&config.d>0){y=config.d}var startPoint="M0 "+y;var centerPoint=config.width-config.cardWidth-calloutStart+" "+y;var preEndPoint=config.width-config.cardWidth-calloutEnd+" "+lastY[0];var endPoint=config.width+" "+lastY[0];pathStart=startPoint+" L "+centerPoint;pathAngle="M "+centerPoint+" "+preEndPoint;pathEnd="M "+preEndPoint+" L "+endPoint;return createNodes(pathStart,pathAngle,pathEnd)};function createNodes(pathStart,pathAngle,pathEnd){var nodes=[];pathStart&&nodes.push({tag:"path",attrs:{d:pathStart,"class":"crispEdges"}});pathAngle&&nodes.push({tag:"path",attrs:{d:pathAngle,"class":"crispEdges"}});pathEnd&&nodes.push({tag:"path",attrs:{d:pathEnd}});return nodes}var remove=function(){$(".guide").remove();guideCard=null};var update=function(){if(!guideCard)return;draw(guideCard,guideUnderline)};function createSvgStyle(params){return"width="+params.width+"px;"+"height:"+params.height+"px;"+"top:"+params.top+"px;"+"left:"+params.left+"px;"+"margin-top:"+params.marginTop+"px;"}return{draw:draw,remove:remove,update:update}}});window.require.register("/component/editor/document-item/document-item.js",function(exports,module,require){var api,user;Vue.component("editor:document-item",{template:Handlebars.partials.editor__document_item(),replace:true,created:function(){api=api||require("/js/app").docsApi;this.$dispatch("createdItem",this);var me=this;me.$on("document-item:status:change",function(id,settings){if(id!==me.id)return false;me.settings=settings})},data:{removed:false,cls:"",proofread:false,proofreading:false,cancelled:false,clicked:false},methods:{fire:function(e,name){e.preventDefault();e.stopPropagation();this.$emit(name,this)},onclick:function(e){if(this.proofreading){this.$dispatch("proofit:open-proofreading-document",this);e.preventDefault();return false}if(this.id!=0||this.clicked)return;this.fire(e,"demoClick");this.clicked=true},onDownloadClick:function(e){this.$dispatch("track:document-download");this.fire(e,"download")},onDownloadProofreadClick:function(e){this.fire(e,"downloadProofread")},onDeleteClick:function(e){this.$dispatch("track:document-remove-button-clicked");this.fire(e,"remove")}},directives:{"check-proofit":function(settings){var vm=this.vm;vm.$set("proofread",false);vm.$set("proofreading",false);vm.$set("cancelled",false);if(!vm.settings||!vm.settings.proofit)return false;if(settings.proofit.status==="Completed")vm.proofread=true;else if(settings.proofit.status==="Cancelled")vm.cancelled=true;else vm.proofreading=true}}});Vue.component("editor:document-new",{template:Handlebars.partials.editor__document_item__new(),replace:true,methods:{onchange:function(e){e.preventDefault();this.$emit("upload",e)},onclick:function(){this.$dispatch("track:new-document-button-clicked");this.$emit("create")}}});Vue.component("editor:document-item-tooltip",{template:Handlebars.partials.editor__document_item_tooltip(),replace:true,created:function(){user=user||require("/js/user");var settings=user.$get("settings");this.shown=!settings.seenMigrationTooltip;
if(this.shown)user.setSettings({seenMigrationTooltip:true})},methods:{onclose:function(){this.shown=false}}})});window.require.register("/component/editor/document-search/document-search.js",function(exports,module,require){Vue.component("editor:document-search",{template:Handlebars.partials.editor__document_search(),replace:true,data:{query:""},methods:{onInput:function(){this.$emit("search",this.query)},onKeydown:function(e){if(!e.ctrlKey&&!e.shiftKey&&!e.metaKey&&e.keyCode>32&&(e.keyCode<37||e.keyCode>40)){this.$inputEl.focus()}},btnClick:function(e){if(!this.query)return;this.reset()},reset:function(){this.query="";this.$emit("search",this.query)}},created:function(){this.onKeydown=this.onKeydown.bind(this);this.$inputEl=this.$el.querySelector(".search-input");$(document).on("keydown",this.onKeydown)},beforeDestroy:function(){$(document).off("keydown",this.onKeydown)}});Vue.component("editor:document-search-empty",{template:Handlebars.partials.editor__document_search__empty(),replace:true})});window.require.register("/component/editor/document-status/document-status.js",function(exports,module,require){var me,text,matches,unhighlightTimer;var config=require("/js/config"),plagiarism=require("../plagiarism-percent/plagiarism-percent"),score=require("../score/score"),user=require("/js/user"),track100ScoreMinLimit=500;module.exports=Vue.component("editor:document-status",{template:Handlebars.partials.editor__document_status(),replace:true,data:{plagiarism:"",fixed:0,remaining:0,score:"",checking:false,plusCount:0,premium:false,isShow:false,showUpgradePopup:false},methods:{update:update,highlight:highlight,unhighlight:unhighlight,incFixed:incFixed,decFixed:decFixed,handleInviteFriends:function(){this.$dispatch("track:popup-invite-friends-button-clicked");this.goToReferral()},handleTryPremium:function(){this.$dispatch("track:try-premium-free-button-clicked");this.goToReferral()},handleUpgrade:function(){var mimic=user.$get("mimic"),isLearnMore=mimic.indexOf("editor_upgrade_variation_1")>-1,newUpgrade=mimic.indexOf("editor_upgrade_variation_2")>-1;isLearnMore?this.showLearnMore():this.goToUpgrade();newUpgrade&&this.$dispatch("track:upgrade-text-button-clicked")},goViewPlans:function(){this.$dispatch("track:popup-view-plans-button-clicked");this.goToUpgrade()},goToReferral:function(){window.open(config.FUNNEL.REFERRAL,"_blank")},goToUpgrade:function(){this.$emit("hookClicked","popup_editor_statusbar")},showLearnMore:function(){this.$dispatch("track:learn-more-button-clicked");this.$set("showUpgradePopup",true);document.addEventListener("click",handleClick.bind(this));function handleClick(event){var className=event.target.className;var show=className.indexOf("upgrade-learn-more-popup")>-1||className.indexOf("plus-upgrade")>-1;if(!show){document.removeEventListener("click",handleClick);this.$set("showUpgradePopup",false)}}},onReportClick:onReportClick},attached:function(){me=this},beforeDestroy:function(){clearTimeout(unhighlightTimer);text=null;matches=null}});function incFixed(){me.fixed++;if(matches)update()}function decFixed(){me.fixed--;if(matches)update()}function highlight(){clearTimeout(unhighlightTimer);me.checking=true;unhighlightTimer=setTimeout(unhighlight,2e4)}function unhighlight(){me.checking=false}function remaining(matches){return matches.filter(function(m){return!m.syn&&!m.replaced&&m.group!="Plagiarism"})}function plusCount(matches){return matches.filter(function(m){return!m.free}).length}function freeCount(matches){return matches.filter(function(m){return m.free}).length}function withoutReplaced(matches){return matches.filter(function(m){return!m.replaced})}function update(cfg){cfg=cfg||{};text=cfg.text||text;matches=cfg.matches||matches;var plusMatchesLength=(cfg.hiddenMatches||[]).length,statusMatches=withoutReplaced(matches),remainingMatches=remaining(matches),genre=cfg.genre||[""],isShow=false;me.premium=user.isPremiumUser();me.remaining=me.premium?freeCount(remainingMatches):remainingMatches.length;me.plusCount=plusCount(remainingMatches)+plusMatchesLength;me.plagiarism=plagiarism(text,matches);me.$.textStat&&me.$.textStat.update(text);me.genre=genre.join(" · ");me.score=score(text,matches);setTimeout(function(){if(me.score==100&&text&&text.length>track100ScoreMinLimit&&!me.checking){trackScore()}},2e3);me.$set("isShow",user.isPremiumUser())}var trackScore=_.debounce(function(){me.$dispatch("track:document-100-score")},1e4);function onReportClick(){if(me.checking)return;me.$emit("report");if(user.isInstitutionUser()&&user.$get("institutionScoreDisabled")){$(".report-finish").trigger("click");setTimeout(function(){$(".report-close").trigger("click")},6e3)}}});window.require.register("/component/editor/document-text/document-text.js",function(exports,module,require){var me,editor,tools,startDoc;var util=require("/js/util.js"),detect=require("/detect/detect"),lbl=detect.OS=="mac"?"⌘":"Ctrl+",notification=require("/component/editor/notification/notification"),config=require("/js/config"),user=require("/js/user"),textarea,maxTextLength=4e3*25,settings,dapiProps,dialect,dialectWasDetected=false;Vue.component("editor:document-text",{template:Handlebars.partials.editor__document_text({attr:detect.browser=="chrome"?"gramm_editor":"gramm_editor gramm"}),replace:true,created:function(){me=this;startDoc=Date.now()},attached:function(){$(window).on("keydown",onkeydown);textarea=$("#textarea");textarea.on("focus",ontxtfocus);$(document).on("mouseup",onmouseup)},beforeDestroy:function(){$(window).off("keydown",onkeydown);textarea.off("focus",ontxtfocus);$(document).off("mouseup",onmouseup)},data:{placeholder:"Type or paste ("+lbl+"V) your text here. Upload a document to save original formatting.",contenteditable:false,textarea:true},methods:{create:createEditor,focus:function(){$("#textarea")[0].focus()}}});function onkeydown(e){var cmdKey=e.metaKey||e.ctrlKey;if(!cmdKey&&e.keyCode!=97)return;if($(document.activeElement).is("input"))return;var txt=$("#textarea")[0];if(txt==document.activeElement)return;txt.focus()}function ontxtfocus(){setTimeout(function(){editor&&editor.updateTextareaHeight()},100)}function onmouseup(){textarea[0].scrollTop=0}function canRemoveSynonym(clickedEl){clickedEl=$(clickedEl);if(clickedEl.is(".b-card.Synonyms .btn-close"))return true;return!clickedEl.is(".b-card.Synonyms, .b-card.Synonyms *")}function disableSynonym(){GrammarlyEditor.Synonyms=function(){return{removeUnderline:_f,completeAnimation:_f}}}function createEditor(options){var doc=options.doc||{settings:{},content:""},isContenteditable=options.type=="contenteditable";tools=options.apps;var editorType={textarea:true,value:"textarea"};if(isContenteditable){editorType={contenteditable:true,value:"contenteditable"};if(!me.contenteditable){Vue.nextTick(function(){createEditor(options)});me.contenteditable=true;me.textarea=false;return}}var capiUrl=user.$get("freemium")?config.CAPI_FREEMIUM_SERVER_URL:config.CAPI_SERVER_URL;var regex=/({(\d).*(\d)})/;var test=capiUrl.match(regex);if(test){var subdomain=Math.floor(Math.random()*(test[3]-test[2]))+parseInt(test[2]);capiUrl=capiUrl.replace(test[0],subdomain)}settings=user.$data.settings||{};dapiProps=user.$data.dapiProps||{};dialect=settings.dialectStrong||dapiProps.dialectWeak;editor=GrammarlyEditor({el:$("#textarea")[0],sid:doc.settings.sid,docid:doc.id,matches:doc.matches,value:doc.content,filter:filter,apps:tools,editorType:editorType,canRemoveSynonym:canRemoveSynonym,asPlainText:true,capiUrl:capiUrl,createWs:options.socket||createWs,textareaWrapSelector:".textarea-wrap",plagiarismCheckDelay:1e4,dialect:dialect,extendParams:function(capiParams){capiParams.genre=doc.settings.genre}});editor.el.scrollTop=0;editor.capiUrl=capiUrl;var origGetMatchClass=editor.getMatchClass;editor.getMatchClass=function(m,text){var cls=origGetMatchClass(m,text);if(m.renderedOnce||util.isSafari())cls+=" gr_disable_anim_appear";m.renderedOnce=true;return cls};var availableCapi=true;if(window.top==window){editor.el.focus()}me.$el=$(editor.el);_.extend(me,editor);var origEmit=editor.emit,websocketErrorTimeout;editor.emit=function(name,data){origEmit(name,data);me.$emit(name,data)};editor.on("serverRemove",function(match,rev){if(match.card&&match.card.hasClass("undo")||match.undoed)match.cancelServerRemove=true});editor.on("corruptedUnderline",function(info){me.$dispatch("track:corrupted-underline",info)});editor.on("socketError",function(e){me.$dispatch("track:websocket-fail",e);websocketErrorTimeout=setTimeout(showSocketError,15e3)});var showSocketError=_.once(function(){notification.show({message:"message_websocket_connect_error",autohide:false,sticky:true})});editor.on("socketConnect",function(){me.$dispatch("track:websocket-connect");notification.hide(true);clearTimeout(websocketErrorTimeout)});editor.on("socketReconnect",function(){me.$dispatch("track:websocket-reconnect");notification.hide(true);clearTimeout(websocketErrorTimeout)});editor.on("socketReconnectAfterError",function(){me.$dispatch("track:websocket-error-reconnect")});editor.on("socketFailCount",function(data){me.$dispatch("track:websocket-fail-count",data)});editor.on("disconnect",function(){me.$dispatch("track:websocket-disconnect")});editor.on("frequent_runtime_error",function(data){me.$dispatch("track:frequent-runtime-error",data)});editor.on("too_many_runtime_error",function(data){me.$dispatch("track:too-many-runtime-error",data)});editor.on("frequent_not_authorized_error",function(data){user.logout();me.$dispatch("track:on-not-authorized-logout",data)});editor.on("serviceState",function(data){if(data.type!="capi")return;if(!data.available){if(!availableCapi)return;var watcher=require("/component/editor/offline-overlay/watcher")();if(watcher.online){watcher.check();watcher.one("success",showCapiDown)}availableCapi=false}else{availableCapi=true}});editor.on("finish",function(data){me.$dispatch("editor:finish-check");if(dialectWasDetected)return;if(!dialect&&data.dialect&&data.dialect!=="undefined"){dialectWasDetected=true;user.setDapiProp("dialectWeak",data.dialect).then(function(){me.$dispatch("track:language-weak-preference",data.dialect)})}});editor.on("track",function(data){me.$dispatch("track:editor",data)});editor.on("fix",function(){try{var fixed=parseInt(localStorage.gr__fixed_errors);if(isNaN(fixed))fixed=0;fixed++;localStorage.gr__fixed_errors=fixed}catch(e){}});editor.on("beforeUpdate",function(updateData){if(window.top!=window)return;var val=updateData.text,cleaned=util.utf_remove_low_surrogate(val.replace(/\t/g,"    "));if(editor.currentText!=val&&doc.settings&&doc.settings.proofit)me.$dispatch("proofit:document:changed",doc.id,doc);if(val!=cleaned){editor.setText(cleaned);updateData.cancel=true}var tooLong=cleaned.length>maxTextLength;if(tooLong){var sel=editor.getSelection();editor.setText(editor.currentText);editor.setCursor({s:sel.s-1,e:sel.e-1});notification.show("message_too_big");me.$emit("saveDoc",editor.currentText);updateData.cancel=true}});editor.run();editor.updateTextareaHeight();setTimeout(editor.updateTextareaHeight,1e3);if(options.created)options.created();me.$dispatch("track:set-document-scope");app.documentWasLoaded=true;me.$dispatch("track:document-loaded",Date.now()-startDoc)}function showCapiDown(){me.$dispatch("track:message-capi-down");notification.show({message:"message_capi_down",delay:3e3})}function filter(matches){if(!matches||!matches.length)return[];var result=getSynonyms(matches);var current=tools.getCurrentApp();for(var i in current){if(!current[i].active)continue;result=result.concat(getAppMatches(matches,i))}result=excludeHidden(result);return result}function getSynonyms(matches){return matches.filter(function(m){return m.syn})}function excludeHidden(matches){return matches.filter(function(m){return!m.hidden})}function getAppMatches(matches,id){id=id||"";return matches.filter(function(m){return m.group==id&&!m.syn})}});window.require.register("/component/editor/document-title/document-title.js",function(exports,module,require){var el;module.exports=Vue.component("editor:document-title",{template:Handlebars.partials.editor__document_title(),replace:true,data:{tooltip:""},attached:function(){el=$(this.el).find("#txtDoc");this.setTooltip()},methods:{setTooltip:function(){if(el.is(":focus"))return this.tooltip="";var msg=["Click to add document title","Click to edit document title"];this.tooltip=msg[this.title?0:1]},placeholder:function(val){return _.escape(val)+"aa"},emitExit:function(){this.$emit("exit")}}})});window.require.register("/component/editor/form/form.js",function(exports,module,require){});window.require.register("/component/editor/loading/loading.js",function(exports,module,require){var Loading=Vue.extend({template:Handlebars.partials.editor__loading(),replace:true,methods:{showIndicator:function(){this.indicator=true}}});Vue.directive("editor-loading",function(value){var el=$(this.el),$body=$("body"),sel=".editor__loading."+this.key,app=require("/js/app");if(value){$(sel).remove();this.loading=new Loading({data:{title:app.withoutTitle?"":el.data("editor-loading-title"),cls:this.key,indicator:false}});$body.toggleClass("loading",true);clearTimeout(this.timeout);this.timeout=setTimeout(this.loading.showIndicator.bind(this.loading),10);if($(sel).length==0)this.loading.$appendTo("body");return}$body.toggleClass("loading",false);clearTimeout(this.timeout);$(sel).remove();this.loading&&this.loading.$destroy();delete this.loading})});window.require.register("/component/editor/nav-main/nav-main.js",function(exports,module,require){var detect=require("/detect/detect"),user=require("/js/user"),referral=require("/component/editor/referral/referral"),referralTrackingParams={placement:"referral_new_sidebar",product:"editor"},model=Vue.extend({template:Handlebars.partials.editor__nav_main(),data:{user:{},proVersion:false,plusVersion:false,isFreebie:false,os:detect.operationSystem(),isPhoenix:false,notInstitution:true,showReferralInMenu:false,supportUrl:"http://support.grammarly.com/login"},computed:{migration:function(){var exp=user&&user.$get("experiment");return _.size(exp)>0}},methods:{goToUpgrade:function(placement){this.$dispatch("track:hook-clicked",placement)},logout:function(){var user=require("/js/user");user.logout();this.$dispatch("track:on-logout")},tutorial:function(){this.$dispatch("track:tutorial");this.$dispatch("track:menu-action","tutorial")},goReferral:function(){this.$dispatch("referral:show-dialog");this.$dispatch("track:referral-button-clicked",referralTrackingParams)}},created:function(){var user=require("/js/user"),groups=user.$get("groups")||[],showReferralInMenu=referral.showSidebar()&&user.$get("mimic").indexOf("editor_main_referral_menu")>-1,supportUrl;this.user=user.$data;this.proVersion=user.isPremiumUser();this.$set("isFreebie",user.isFreebie&&user.isFreebie());this.plusVersion=user.isPremiumUser();this.$set("isPhoenix",user.isPhoenix());this.isAppsVisible=detect.browser=="chrome"||detect.browser=="safari"||detect.browser=="firefox"||detect.operationSystem()=="windows";this.appNumber=getAppsNumber();this.isAppFull=this.appNumber==0;if(user.isInstitutionUser()){this.$set("notInstitution",false)}if(user.isPhoenix()){this.$set("supportUrl","https://ecampus.phoenix.edu/common/contactus/reportProblem.jsp")}if(showReferralInMenu){this.$set("showReferralInMenu",showReferralInMenu);this.$dispatch("track:referral-sidebar-shown",referralTrackingParams)}function getAppsNumber(){var totalNumber=3,addinInstalled=groups.some(function(group){return group&&group.indexOf("office-addin")>-1}),desktopInstalled=groups.some(function(group){return group&&group.indexOf("desktop_editor_used")>-1}),extensionInstalled=groups.some(function(group){return group&&group.indexOf("extension-"+detect.browser)>-1})||window.GR_EXTENSION_ID;if(addinInstalled||detect.operationSystem()!="windows"){totalNumber--}if(desktopInstalled){totalNumber--}if(extensionInstalled){totalNumber--}return totalNumber}},replace:true});Vue.component("editor:nav-main",model);module.exports=model});window.require.register("/component/editor/notification/notification.js",function(exports,module,require){var Notify=Vue.extend({template:Handlebars.partials.editor__notification(),replace:true,filters:{appstate:function(name){var correctName=name;if(!name)return;if(/enhance/gi.test(name))correctName="Vocabulary enhancement";return correctName},isNotEnhance:function(name){if(!name)return false;return!/enhance/gi.test(name)}}}),notify,timer=null;function show(){var defaults={message:"",autohide:true,delay:7e3},config=processCfg(defaults,arguments);Vue.partial("message",config.message);if(notify&&!notify.$data.sticky)hide();var data=config.data||{};data.sticky=config.sticky;notify=new Notify({data:data});notify.$appendTo("body");if(config.autohide)timer=setTimeout(hide,config.delay);return{hide:hide}}function hide(hideSticky){if(!notify||hideSticky&&!notify.sticky)return;clearTimeout(timer);notify.$destroy();notify=timer=null}function processCfg(defaults,params){var tmpl,options;if(typeof params[0]=="string"){tmpl=params[0];options={};if(typeof params[1]=="object")options=params[1];else options.data={".":params[1]};options.message=tmpl}else{options=params[0]}if(typeof options.data=="string")options.data={".":options.data};var hb=Handlebars.partials,template=hb[options.message];options.message=template?template():DOMPurify.sanitize(options.message||"");return _.extend(defaults,options)}module.exports={show:show,hide:hide}});window.require.register("/component/editor/offline-overlay/offline-overlay.js",function(exports,module,require){Vue.component("editor:offline-overlay",{template:Handlebars.partials.editor__offline_overlay(),replace:true,data:{watcher:require("watcher")()},methods:{reconnect:function(){this.watcher.check()}},created:function(){this.watcher.bind()},beforeDestroy:function(){this.watcher.unbind()}})});window.require.register("/component/editor/offline-overlay/watcher.js",function(exports,module,require){module.exports=function(){var doc=document,interval=3e4,currentVsn=$("body").attr("data-vsn"),checkTimer,clockTimer,config=require("/js/config");var me=emitter({online:true,visible:true,needUpdate:false,check:check,reconnectIn:0,bind:function(){resetClock();checkTimer=setTimeout(check,interval);clock();doc.addEventListener(visibilityEvent(),onVisibilityChange)},unbind:function(){clearTimeout(checkTimer);clearTimeout(clock);doc.removeEventListener(visibilityEvent(),onVisibilityChange)}});module.exports=function(){return me};return me;function onVisibilityChange(){if(docHidden(doc)){me.visible=false;me.emit("invisible");return clearTimeout(checkTimer)}me.visible=true;me.emit("visible");check()}function resetClock(){me.reconnectIn=Math.round(interval/1e3)}function restart(){resetClock();clearTimeout(checkTimer);checkTimer=setTimeout(check,interval);clock()}function clock(){clearTimeout(clockTimer);me.reconnectIn--;if(me.reconnectIn==0)resetClock();clockTimer=setTimeout(clock,1e3)}function check(){$.ajax({url:"/online-test.json",crossDomain:true,success:function(res){var vsn=res.commit;if(vsn!==currentVsn&&!me.needUpdate){me.needUpdate=true;me.emit("update",vsn)}me.emit("success");if(!me.online){me.online=true;console.log("online");me.emit("online")}restart()},error:function(xhr,reason){if(me.online&&reason!="abort"){me.online=false;console.log("offline");me.emit("offline")}restart()}})}function docHidden(doc){if(typeof doc.hidden!=="undefined")return doc.hidden;if(typeof doc.mozHidden!=="undefined")return doc.mozHidden;if(typeof doc.webkitHidden!=="undefined")return doc.webkitHidden;if(typeof doc.msHidden!=="undefined")return doc.msHidden;return false}function visibilityEvent(){if(typeof doc.hidden!=="undefined")return"visibilitychange";if(typeof doc.mozHidden!=="undefined")return"mozvisibilitychange";if(typeof doc.webkitHidden!=="undefined")return"webkitvisibilitychange";if(typeof doc.msHidden!=="undefined")return"msvisibilitychange";return false}}});window.require.register("/component/editor/page-header/page-header.js",function(exports,module,require){module.exports=Vue.component("editor:page-header",{template:Handlebars.partials.editor__page_header(),replace:true})});window.require.register("/component/editor/plagiarism-percent/plagiarism-percent.js",function(exports,module,require){module.exports=function(text,matches){matches=matches.filter(function(m){return m.category=="Plagiarism"});var result=0;matches.forEach(function(m){result+=m.e-m.s});text=text||"";result=(result/text.length).toFixed(2)*100;result=Math.round(result);if(result>100)result=100;return result||0}});window.require.register("/component/editor/profile/account/account.js",function(exports,module,require){var route=require("/js/route");var user=require("/js/user"),notification=require("/component/editor/notification/notification");Vue.component("profile-account",{template:Handlebars.partials.editor__account(),data:{notPhoenix:true,user:{},passwordResetForm:{show:false,top:"",left:""},accountDeleteForm:{show:false},accountNameChangeForm:{show:false},accountEmailChangeForm:{show:false}},attached:function(){var me=this;me.user=user.$data;me.$set("notPhoenix",!user.isPhoenix());me.$on("password-reset:submit",function(newPass,oldPass){user.changePassword({new_pwd:newPass,old_pwd:oldPass}).done(function(){notification.show("message_profile_password_success");me.hidePasswordResetForm();me.$dispatch("track:edit-password-accepted")}).fail(function(){me.$dispatch("track:edit-password-rejected");notification.show("message_profile_password_incorrect");me.hidePasswordResetForm()})});me.$on("name-change:submit",function(name){user.changeName({name:name}).done(function(){notification.show("message_profile_name_changed");me.$set("user.name",name);me.$dispatch("track:edit-name-accepted")}).fail(function(){notification.show("message_profile_error");me.$dispatch("track:edit-name-rejected")});me.hideAccountNameChangeForm()});me.$on("email-change:submit",function(email,password){user.changeEmail({newEmail:email,password:password}).done(function(){notification.show("message_profile_email_changed",{data:{email:email}});me.$set("user.newEmail",email);me.$dispatch("track:edit-email-accepted")}).fail(function(){notification.show("message_profile_error");me.$dispatch("track:edit-email-rejected")});me.hideAccountEmailChangeForm()});me.$on("password-reset:cancel",function(){me.hidePasswordResetForm()});me.$on("account-delete:cancel",function(){me.hideAccountDeleteForm()});me.$on("name-change:cancel",function(){me.hideAccountNameChangeForm()});me.$on("email-change:cancel",function(){me.hideAccountEmailChangeForm()})},detached:function(){this.hidePasswordResetForm();this.hideAccountDeleteForm();this.hideAccountNameChangeForm();this.hideAccountEmailChangeForm()},methods:{hideAccountDeleteForm:function(){this.$set("accountDeleteForm.show",false)},hidePasswordResetForm:function(){this.$set("passwordResetForm.show",false)},hideAccountNameChangeForm:function(){this.$set("accountNameChangeForm.show",false)},hideAccountEmailChangeForm:function(){this.$set("accountEmailChangeForm.show",false)},hideAllForms:function(){this.$set("accountDeleteForm.show",false);this.$set("passwordResetForm.show",false);this.$set("accountNameChangeForm.show",false);this.$set("accountEmailChangeForm.show",false)},showAccountNameChangeForm:function(e){this.hideAllForms();this.$set("accountNameChangeForm.show",true);this.$dispatch("track:edit-name-button-clicked")},showAccountEmailChangeForm:function(e){this.hideAllForms();this.$set("accountEmailChangeForm.show",true);this.$dispatch("track:edit-email-button-clicked")},showPasswordResetForm:function(e){this.hideAllForms();var pos=$(e.target).position();this.$set("passwordResetForm.top",parseInt(pos.top-25)+"px");this.$set("passwordResetForm.left",parseInt(pos.left-30)+"px");this.$set("passwordResetForm.show",true);this.$dispatch("track:edit-password-button-clicked")},showAccountDeleteForm:function(){this.hideAllForms();this.$dispatch("track:account-delete-form-shown");this.$set("accountDeleteForm.show",true)}}});Vue.component("account-delete",{template:Handlebars.partials.editor__account_delete(),data:{isFree:false,proVersion:false,password:"",wrongPassword:false},methods:{supportClick:function(e){e.preventDefault();var url=$(e.target).attr("href");setTimeout(function(){window.location=url},400);this.$dispatch("track:account-delete-form-support-link-clicked")},cancel:function(){this.$dispatch("account-delete:cancel")},submit:function(){var me=this;me.$set("wrongPassword",false);user.login({password:this.password,email:user.$data.email}).done(onComplete).fail(onError);function onComplete(data){user.deleteAccount().done(function(){me.$dispatch("track:account-delete-form-accepted");setTimeout(function(){route.toAccountDeleteConfirmation()},500)}).fail(onError)}function onError(error){if(error.status===401){me.$set("wrongPassword",true)}else{me.$dispatch("track:account-delete-form-rejected");notification.show("message_profile_server_error")}}}},attached:function(){this.$set("isFree",user.isFree());this.$set("proVersion",user.isPremiumUser())}});Vue.component("account-name-change",{template:Handlebars.partials.editor__account_name_change(),data:{name:""},methods:{cancel:function(){this.reset();this.$dispatch("name-change:cancel")},submit:function(){this.validate();if(this.invalidName)return;this.$dispatch("name-change:submit",this.name);this.reset()},reset:function(){this.$set("name",this.name)},validate:function(){this.$set("invalidName",!nameValidation(this.name))}},attached:function(){this.$set("name",user.name)}});Vue.component("account-email-change",{template:Handlebars.partials.editor__account_email_change(),data:{email:"",password:""},methods:{cancel:function(){this.reset();this.$dispatch("email-change:cancel")},submit:function(){this.validate();if(this.invalidEmail||this.invalidPassword)return;this.$dispatch("email-change:submit",this.email,this.password);this.reset()},reset:function(){this.$set("email",this.email)},validateEmail:function(){this.$set("invalidEmail",!emailValidation(this.email))},validatePassword:function(){this.$set("invalidPassword",!passwordValidation(this.password))},validate:function(){this.validateEmail();this.validatePassword()}},attached:function(){this.$set("email",user.email)}});Vue.component("account-password-reset",{template:Handlebars.partials.editor__account_password_reset(),data:{oldPassword:"",newPassword:"",newPasswordConfirm:""},methods:{cancel:function(){this.reset();this.$dispatch("password-reset:cancel")},submit:function(){this.validate();if(this.invalidOldPass||this.invalidNewPass||this.differentPasswords)return;this.$dispatch("password-reset:submit",this.newPassword,this.oldPassword);this.reset()},reset:function(){this.$set("oldPassword","");this.$set("newPassword","");this.$set("newPasswordConfirm","")},validateOldPass:function(){this.$set("invalidOldPass",!passwordValidation(this.oldPassword))},validate:function(){var sameNewPasswords=this.newPassword==this.newPasswordConfirm;this.validateOldPass();this.$set("invalidNewPass",!passwordValidation(this.newPassword));this.$set("differentPasswords",!sameNewPasswords);!sameNewPasswords&&notification.show("message_profile_passwords_different")}}});function nameValidation(name){var regex=/[!$%^&*()_+|~={}\[\]:";<>?,.\/]/g;return!regex.test(name)&&name.trim().length}function emailValidation(email){var regex=/^\w+[-+.'\w+]*@\w+[-.\w+]*\.\w+[-.\w+]*$/i;return regex.test(email)}function passwordValidation(password){return password&&password.length>=6}});window.require.register("/component/editor/profile/dictionary/dictionary.js",function(exports,module,require){var me,user=require("/js/user"),notification=require("/component/editor/notification/notification"),config=require("/js/config"),dictionary=window.GrammarlyApi.Dictionary({dictionaryUrl:config.CAPI_API});Vue.component("profile-dictionary",{template:Handlebars.partials.editor__dictionary(),data:{newWord:"",words:[]},attached:function(){me=this;me.dictionaryAddLoading=true;me.currentNotification=null;this.getWords()},methods:{transfromWords:function(words){return _(words).groupBy(function(item){return item[0].toUpperCase()}).map(function(words,letter){return{letter:letter,words:words.sort()}}).sort(function(a,b){return a.letter.localeCompare(b.letter)}).value()},showMsg:function(msg){me.currentNotification=notification.show({message:msg,autohide:true})},showError:function(){me.showMsg("An error occurred, please try again later")},hideCurrentNotification:function(){if(me.currentNotification)me.currentNotification.hide(true)},getWords:function(){return dictionary.get().success(function(words){me.$data.words=me.transfromWords(words)})},onRemoveClick:function(word){me.hideCurrentNotification();dictionary.remove(word).then(me.getWords).then(function(){me.showMsg("“"+word+"” removed from dictionary")}).fail(me.showError);this.$dispatch("track:dictionary-remove")},onAddClick:function(e){if(!me.newWord||me.addLoading)return;if(!/^[a-zA-Z]+$/.test(me.newWord)){return me.showMsg("Words must contain English letters only")}if(me.newWord.length>40){return me.showMsg("Words must be shorter than 40 characters")}me.hideCurrentNotification();me.addLoading=true;dictionary.save(encodeURIComponent(me.newWord)).then(me.getWords).then(function(){me.showMsg("“"+me.newWord+"” added to dictionary");me.newWord=""}).fail(me.showError).always(function(){me.addLoading=false});this.$dispatch("track:dictionary-add")}}})});window.require.register("/component/editor/profile/language/language.js",function(exports,module,require){var me,user=require("/js/user"),settings,dapiProps,notification=require("/component/editor/notification/notification");Vue.component("profile-language",{template:Handlebars.partials.editor__lang(),data:{dialectStrong:"",dialectWeak:"",dialect:"american"},attached:function(){me=this;settings=user.$data.settings||{};dapiProps=user.$data.dapiProps||{};this.dialectStrong=settings.dialectStrong;this.dialectWeak=dapiProps.dialectWeak;me.dialect=this.dialectStrong||this.dialectWeak||this.dialect;this.$on("settings-update",function(newSettings){me.$data.dialectStrong=newSettings.settings.dialectStrong||this.dialectStrong;me.$data.dialectWeak=newSettings.dapiProps.dialectWeak||this.dialectWeak;me.$data.dialect=me.$data.dialectStrong||me.$data.dialectWeak||this.dialect})},methods:{onDialectChange:function(e){var val=e.target.value;var _this=this;this.dialectStrong=val;user.setSettings({dialectStrong:val}).done(function(){window.GR_EXTENSION_SEND&&window.GR_EXTENSION_SEND("changed-dialect");_this.$dispatch("track:language-strong-preference",{strong:val,weak:_this.dialectWeak})}).fail(function(){notification.show({message:"An error occurred, please try again later",autohide:true})})}}})});window.require.register("/component/editor/progressbar/progressbar.js",function(exports,module,require){var TIME_FOR_UPLOAD_ANIMATION=500;function enoughTime(startedAt){return+new Date-startedAt>TIME_FOR_UPLOAD_ANIMATION}Vue.component("editor-progressbar",{template:Handlebars.partials.editor__progressbar(),replace:true,data:{value:0,label:""},methods:{start:function(){this.value=0;this.startedAt=+new Date},end:function(){if(!enoughTime(this.startedAt)){return setTimeout(this.end.bind(this),TIME_FOR_UPLOAD_ANIMATION)}this.$emit("progressbar-end");this.value=""},onprogress:function(e){if(e.lengthComputable){var value=e.loaded/e.total*100;this.value=value;this.label=Math.round(value);return}this.value=40}}})});window.require.register("/component/editor/proofit/plans/plans.js",function(exports,module,require){var user=require("/js/user"),config=require("/js/config"),proofit=window.GrammarlyApi.Proofit({irbisUrl:config.IRBIS_URL});module.exports=Vue.component("editor:proofit-plan",{template:Handlebars.partials.proofit_options_table(),replace:true,isFn:true,data:{selected:false,placeOrder:false,proofitSending:false,payment:{}},methods:{clickSelect:function(){if(!this.enabled||this.proofitSending)return;this.$dispatch("proofit:select:plan",this);
this.selected=true},proofitSendStatus:function(value){this.proofitSending=value},changeSelect:function(vm){if(vm==this)return;this.selected=false},createOrder:function(){var me=this,payMethod=me.$data.payMethod;if(me.proofitSending)return;me.$dispatch("proofit:sending:plan",true);me.proofitSending=true;window.tracker.mixpanel.track("PROOF:Payment_Form_Attempted",{methodOfPaymentAttempted:payMethod});app.getDocument().then(createJob);function createJob(doc){proofit.createJob({turnaround:me.turnaround,docID:doc.id}).done(function(response){if(response.status=="paymentError"){me.$dispatch("proofit:error:payment");window.tracker.mixpanel.track("PROOF:Payment_Form_Rejected",{methodOfPaymentAttempted:payMethod,paymentErrorType:"",paymentErrorMsg:""})}else if(response.status=="duplicate"){me.$dispatch("proofit:error:duplicate")}else{window.tracker.mixpanel.track("PROOF:Payment_Form_Accepted",{methodOfPaymentAttempted:payMethod})}}).error(function(response){me.$dispatch("proofit:error:payment");window.tracker.mixpanel.track("PROOF:Payment_Form_Rejected",{methodOfPaymentAttempted:payMethod,paymentErrorType:"",paymentErrorMsg:""})}).always(function(){me.$dispatch("proofit:sending:plan",false);me.proofitSending=false})}},showErrorMessage:function(){}},attached:function(){this.$set("payment",user.$get("paymentProfile"));this.$on("changeSelect",this.changeSelect.bind(this));this.$on("proofit:sending:plan",this.proofitSendStatus.bind(this));this.$on("proofit:sended",this.proofitSendStatus.bind(this))}})});window.require.register("/component/editor/proofit/popup-cancelled/popup-cancelled.js",function(exports,module,require){var Popup=require("../popup/popup"),_docs=require("/js/docs");var el=Popup.extend({data:{content:Handlebars.partials.message__popup_cancelled(),pclass:"cancelled",loading:true,proofit:{},user:{},supportUrl:"http://support.grammarly.com/login"},methods:{closePopup:function(){this.hidePopup();$("textarea").focus()}},attached:function(){var me=this;this.$on("proofit:show:cancelled",function(id,settings){me.proofit=settings.proofit;me.showPopup()})}});Vue.component("editor:proofit-cancelled",el);module.exports=el});window.require.register("/component/editor/proofit/popup-duplicate/popup-duplicate.js",function(exports,module,require){var Popup=require("../popup/popup"),docs=require("/js/docs");var el=Popup.extend({replace:true,data:{content:Handlebars.partials.proofit_payment_error_duplicate(),pclass:"duplicate",doc:"",user:{},proofit:{}},methods:{gotToNew:function(){this.hidePopup();docs.newDoc()},closePopup:function(){this.hidePopup();$("textarea").focus()}},attached:function(){var me=this;me.$on("proofit:show:error:duplicate",function(){me.showPopup()})}});module.exports=Vue.component("editor:proofit-duplicate",el)});window.require.register("/component/editor/proofit/popup-error/popup-error.js",function(exports,module,require){var Popup=require("../popup/popup"),user=require("/js/user"),route=require("/js/route");var el=Popup.extend({replace:true,data:{content:Handlebars.partials.proofit_payment_error_content(),pclass:"error",doc:"",proofit:{}},computed:{payment:function(){var payment={creditCard:{suffix:""}};return user.$get("paymentProfile.paymentMethod")||payment}},methods:{gotToSubscription:function(){this.hidePopup();route.toSubscriptionBilling()}},attached:function(){var me=this;me.$on("proofit:show:error:payment",function(){console.log("user",this);me.showPopup()})}});module.exports=Vue.component("editor:proofit-error",el)});window.require.register("/component/editor/proofit/popup-inprogress/popup-inprogress.js",function(exports,module,require){var Popup=require("../popup/popup"),_docs=require("/js/docs"),route=require("/js/route");var el=Popup.extend({isFn:true,data:{content:Handlebars.partials.proofit_document_proofreading(),pclass:"in-progress",doc:""},methods:{download:function(doc){_docs.download(doc.id,doc.title)},closePopup:function(){if(/\d/g.test(document.location.pathname)){route.toIndex()}else{this.hidePopup()}}},attached:function(){var me=this;me.$on("proofit:open-proofreading-document",function(doc){me.doc=doc;me.showPopup()})}});module.exports=Vue.component("editor:proofit-inprogress",el)});window.require.register("/component/editor/proofit/popup-success/popup-success.js",function(exports,module,require){var Popup=require("../popup/popup"),_docs=require("/js/docs"),route=require("/js/route");var el=Popup.extend({data:{content:Handlebars.partials.proofit_success(),pclass:"success",doc:"",proofit:{}},methods:{closePopup:function(){this.hidePopup();route.toIndex()}},attached:function(){var me=this;me.$on("proofit:show:success",function(id,settings){me.proofit=settings.proofit;me.showPopup()});me.$on("proofit:show:cancelled",function(id,settings){me.hidePopup()});me.$on("proofit:show:completed",function(id,settings){me.proofit=settings.proofit;me.hidePopup()})}});module.exports=Vue.component("editor:proofit-success",el)});window.require.register("/component/editor/proofit/popup/popup.js",function(exports,module,require){module.exports=Vue.extend({template:Handlebars.partials.proofit__popup(),replace:true,data:{show:false},created:function(){this.$appendTo("body")},methods:{showPopup:function(){this.show=true},hidePopup:function(){this.show=false},closePopup:function(){this.hidePopup()},onEscClick:function(e){if(e.keyCode==27&&this.show)this.closePopup()}},beforeDestroy:function(){$(window).off("keydown",this.onEscClick.bind(this));this.$remove()},attached:function(){$(window).on("keydown",this.onEscClick.bind(this))}})});window.require.register("/component/editor/proofit/progressbar/progressbar.js",function(exports,module,require){function parseDate(str){if(!str)return new Date;var pieces=str.split(" "),date=pieces[0].split("-"),time=pieces[1].split(":");return new Date(Date.UTC(date[0],date[1]-1,date[2],time[0],time[1],time[2]))}function secondsToTime(sec){var sec_num=parseInt(sec,10);var hours=Math.floor(sec_num/3600);var minutes=Math.floor((sec_num-hours*3600)/60);var seconds=sec_num-hours*3600-minutes*60;if(hours<10){hours="0"+hours}if(minutes<10){minutes="0"+minutes}if(seconds<10){seconds="0"+seconds}return{h:hours,m:minutes,s:seconds}}function formatTime(sec,short){var time=secondsToTime(sec),msg="";msg+=time.h>0?time.h+" "+(short==true?"h ":time.h>1?"hours ":"hour "):"";msg+=time.m>0?time.m+" "+(short==true?"min ":time.m>1?"minutes ":"minute "):"";msg+=time.h===0?time.s+" "+(short==true?"sec":time.s>1?" seconds":" second"):"";return msg}module.exports=Vue.component("editor:proofit-progressbar",{template:Handlebars.partials.proofit__progressbar(),replace:true,data:{value:0,label:"",interval:null,remaning:"","short":true},methods:{start:function(proofit){this.stop();if(!proofit||this.value>100)return false;var start=parseDate(proofit.submitted).getTime(),now=(new Date).getTime(),end=parseDate(proofit.due).getTime(),value,difference;difference=(now-start)/(end-start);value=difference*100;this.value=value;this.remaning=(end-now)/1e3;this.tick()},tick:function(){this.interval=setInterval(this.start.bind(this,this.$get("proofit")),1e3)},stop:function(){if(this.interval)clearInterval(this.interval)}},filters:{formatDate:function(value){return formatTime(value,this.short)}},attached:function(){var me=this;this.$on("proofit",function(){me.start(me.proofit)});me.start(me.proofit)},detached:function(){this.stop()}})});window.require.register("/component/editor/proofit/proofit.js",function(exports,module,require){var user=require("/js/user"),config=require("/js/config"),selectProofread=require("/component/editor/proofit/select-plans/select-plans");function createWsConnection(vm){vm.docsWs=createWs({token:user.$get("token"),url:config.DOCS_API_URL_WS+"/ws"});vm.docsWs.on("message",function(message){if(message.op!=="mongodb_change")return;if(message.data.proofit.status=="Building"){vm.$dispatch("proofread:status:building",message.id,message.data)}if(message.data.proofit.status=="Completed"){vm.$dispatch("proofread:status:completed",message.id,message.data)}if(message.data.proofit.status=="Cancelled"){vm.$dispatch("proofread:status:cancelled",message.id,message.data)}});vm.docsWs.connect()}module.exports=Vue.component("editor:proofit-main",{template:Handlebars.partials.editor__proofit_main(),replace:true,data:{loading:true,proofit:{},user:{},subscriptionData:{}},attached:function(){var me=this;me.$on("proofit:show:plans",function(){me.$["proofit:select"].showProofitSelect()});me.$on("proofit:error:payment",function(){me.$broadcast("proofit:show:error:payment")});me.$on("proofit:error:duplicate",function(){me.$broadcast("proofit:show:error:duplicate")});if(!me.docsWs)createWsConnection(me)},components:{"editor:select-proofit":selectProofread},beforeDestroy:function(){if(this.docsWs)this.docsWs.close()}})});window.require.register("/component/editor/proofit/select-plans/select-plans.js",function(exports,module,require){var Popup=require("../popup/popup"),user=require("/js/user"),config=require("/js/config"),proofit=window.GrammarlyApi.Proofit({irbisUrl:config.IRBIS_URL}),editor,turnarounds={Instant:{},ThreeHours:{label:"3 hours",mostPopular:true},TwentyFourHours:{label:"24 hours"}};module.exports=Popup.extend({isFn:true,data:{loading:true,content:Handlebars.partials.proofit_dlg(),pclass:"options",proofitData:[],user:"",selecting:"",placeOrder:false,send_to_proofit:false},ready:function(){this.user=user.$data},methods:{showProofitSelect:function(){var me=this;me.showPopup();editor=require("/component/page/editor/editor").$.editor;app.getDocument().then(function(doc){proofit.getOptions(doc.id).then(function(data){me.proofitData=me.processingProofitOptions(data);me.loading=false})})},proofread:function(enable,element){if(!enable)return;element.selecting="selecting"},closePopup:function(){this.hidePopup();this.loading=true;this.$broadcast("changeSelect");this.$broadcast("proofit:sending:plan",false)},processingProofitOptions:function(data){var proofitOptions=data.turnaroundOptions,words=data.words,processingData=[];proofitOptions.forEach(function(optionsElement){var turnaroundElement=turnarounds[optionsElement.turnaround];turnaroundElement.perWord=optionsElement.perWord;turnaroundElement.price=optionsElement.price;turnaroundElement.enabled=optionsElement.enabled;turnaroundElement.words=words;turnaroundElement.turnaround=optionsElement.turnaround;turnaroundElement.label=optionsElement&&optionsElement.minutesToProcess?optionsElement.minutesToProcess+" minute"+(optionsElement.minutesToProcess%10!=1?"s":""):turnaroundElement.label});Object.keys(turnarounds).forEach(function(value){processingData.push(turnarounds[value])});processingData.reverse();return processingData}},attached:function(){var me=this;me.$on("proofit:show:plans",function(){me.showPopup()});me.$on("proofit:show:error:payment",function(){me.closePopup()});me.$on("proofit:show:error:duplicate",function(){me.closePopup()});me.$on("proofit:show:success",function(){me.closePopup()});me.$on("proofit:sending:plan",function(value){me.$broadcast("proofit:sending:plan",value)});me.$on("proofit:select:plan",function(vm){me.showPopup();me.$broadcast("changeSelect",vm)})}})});window.require.register("/component/editor/proofit/status-cancelled/status-cancelled.js",function(exports,module,require){var dialog=require("/component/editor/advanced-dialog/advanced-dialog"),_docs=require("/js/docs");module.exports=Vue.component("editor:status-cancelled",{template:Handlebars.partials.message__status_cancelled(),replace:true,data:{loading:true,proofit:{},user:{},show:false,name:"cancelled",content:{title:"Your order has been cancelled",description:"Your proofreading order has been cancelled and the payment refunded. Please&nbsp;check your email for more information, or contact Grammarly support."},button:{label:"Open document"}},methods:{showStatusMessage:function(){this.show=true},dismiss:function(){this.show=false},action:function(){location.href="/docs/"+this.docId}},attached:function(){var me=this;this.close=this.dismiss;this.$on("proofit:show:cancelled",function(id,settings){me.proofit=settings.proofit;me.docId=id;me.showStatusMessage()})}})});window.require.register("/component/editor/proofit/status-complete/status-complete.js",function(exports,module,require){var dialog=require("/component/editor/advanced-dialog/advanced-dialog"),_docs=require("/js/docs");module.exports=Vue.component("editor:status-complete",{template:Handlebars.partials.message__proofread_download(),replace:true,data:{loading:true,proofit:{},user:{},show:false},methods:{showStatusMessage:function(){this.show=true},closeStatusMessage:function(){this.show=false},downloadProofread:function(){location.href=this.proofit.downloadResultUrl}},attached:function(){var me=this;this.$on("proofit:show:completed",function(id,settings){me.proofit=settings.proofit;me.showStatusMessage()})}})});window.require.register("/component/editor/proofit/status-proofreading/status-proofreading.js",function(exports,module,require){var dialog=require("/component/editor/advanced-dialog/advanced-dialog"),_docs=require("/js/docs");module.exports=Vue.component("editor:status-complete",{template:Handlebars.partials.message__proofread_download(),replace:true,data:{loading:true,proofit:{},user:{},show:false},methods:{showStatusMessage:function(){this.show=true},closeStatusMessage:function(){this.show=false},downloadProofread:function(){location.href=this.proofit.downloadResultUrl}},attached:function(){var me=this;this.$on("test",function(){me.showStatusMessage()});this.$on("proofit:show:completed",function(id,settings){me.proofit=settings.proofit;me.showStatusMessage()})}})});window.require.register("/component/editor/referral/referral-iframe.js",function(exports,module,require){var user=require("/js/user");var config=require("/js/config");module.exports=Vue.component("editor:referral-iframe",{template:Handlebars.partials.referral_iframe(),replace:true,data:{show:false,indicator:true,referralSrc:config.FUNNEL.REFERRAL},attached:function(){var self=this;$(document).on("keydown",closeIframeKeyDown.bind(this))},deattached:function(){$(document).off("keydown",closeIframeKeyDown.bind(this))},created:function(){app.$on("referral:show-dialog",this.openIframe.bind(this))},methods:{openIframe:function(){this.$set("show",true);this.$set("indicator",true);bindLoadIframe.call(this)},closeIframe:function(){unBindLoadIframe.call(this);this.$set("show",false);this.$set("indicator",false)}}});function closeIframeKeyDown(e){if(e.keyCode==27){this.closeIframe()}}function bindLoadIframe(){var self=this;var openIframeAnyWay=setTimeout(function(){self.$set("indicator",false)},6e3);app.$dispatch("track:referral-iframe-open-start",Date.now());Vue.nextTick(function(){$(".js-referal-iframe").on("load",function(){self.$set("indicator",false);clearTimeout(openIframeAnyWay)})});window.addEventListener("message",receiveMessage,false)}function receiveMessage(e){if(event.origin!=="https://grammarly.com"||e.data&&e.data.indexOf("referral")==-1)return;app.$dispatch("track:referral-iframe-open-end",Date.now())}function unBindLoadIframe(){var self=this;$(".js-referal-iframe").off("load")}});window.require.register("/component/editor/referral/referral-menu.js",function(exports,module,require){var user=require("/js/user");var referral=require("/component/editor/referral/referral");module.exports=Vue.component("editor:referral-menu",{template:Handlebars.partials.editor__referral_menu(),data:{show:false,clicked:0},attached:function(){var show=referral.showSidebar();this.$set("show",show);if(show)this.$dispatch("track:referral-sidebar-shown",{placement:"referral_sidebar",product:"editor"})},methods:{showDialog:function(){this.$dispatch("track:referral-button-clicked",{placement:"referral_sidebar",product:"editor"});this.$dispatch("referral:show-dialog")}}})});window.require.register("/component/editor/referral/referral-tool.js",function(exports,module,require){var user=require("/js/user");var config=require("/js/config");var referral=require("/component/editor/referral/referral");module.exports=Vue.component("editor:referral-tool",{template:Handlebars.partials.editor__referral_tool(),data:{show:false},attached:function(){var mimic=user.$get("mimic");var isLearnMore=mimic.indexOf("editor_upgrade_variation_1")>-1;var isNewUpgrade=mimic.indexOf("editor_upgrade_variation_2")>-1;var show=referral.showPopup()&&!isLearnMore&&!isNewUpgrade;this.$set("show",show);show&&this.$dispatch("track:referral-popuptool-shown",{placement:"referral_popup",product:"editor"})},methods:{showDialog:function(){this.$dispatch("referral:show-dialog");window.open(config.FUNNEL.REFERRAL,"_blank")}}})});window.require.register("/component/editor/referral/referral.js",function(exports,module,require){var user=require("/js/user");var utils=require("/js/referral_util");exports.showSidebar=function(){return show("locked","sidebar")};exports.showBanner=function(){return show("locked","topBanner")};exports.showPopup=function(){return show("locked","popup")};function createPath(prefix,type){return prefix+"_"+type}function show(id,type){var premium=user.isPremiumNotFreeUser(),prefix=utils.prefix(),path=createPath(prefix,type),cta=user.$get("settings."+path+".cta")||user.$get("settings."+path+".ctaClicked")||0;return cta<3&&utils.isThreeDayGoneAfterClose(type)&&!premium&&utils.isWeekGone(type)}});window.require.register("/component/editor/report-button/report-button.js",function(exports,module,require){var user=require("/js/user");var model=Vue.extend({data:{isScoreDisable:false},template:Handlebars.partials.editor__report_button(),replace:true,created:function(){this.$set("isScoreDisable",user.isInstitutionUser()&&user.$get("institutionScoreDisabled"))}});Vue.component("editor:report-button",model);module.exports=model});window.require.register("/component/editor/report/report-config.js",function(exports,module,require){var ReportHeaderConfig={top:{title:"That’s impressive",description:"We did not find any errors in your text. Keep up the great work."},middle:{title:["Very nice","Excellent job"],description:["Your document is strong, but still needs some revisions.","It looks like you just need a little polishing.","This text is solid but could still be improved."],attention:["When you are reviewing your work, pay close attention to <cat1> and <cat2> errors.","Look out for <cat1> and <cat2> mistakes during your review.","<cat1> and <cat2> seem to be giving you trouble. Review your work carefully."],handbook:["You may want to consult the Grammarly Handbook on","The Grammarly Handbook might help you with","If you need more help, check the Grammarly Handbook for"]},bottom:{title:["Nobody’s perfect","Keep at it","Back to work"],description:["You still have room for improvement. (Don’t we all?)","The best is ahead.","You’ll need to make some changes."],attention:["When you are reviewing your work, pay close attention to <cat1> and <cat2> errors.","Look out for <cat1> and <cat2> mistakes during your review.","<cat1> and <cat2> seem to be giving you trouble. Review your work carefully."],handbook:["You may want to consult the Grammarly Handbook on","The Grammarly Handbook might help you with","If you need more help, check the Grammarly Handbook for"]}};module.exports={ReportHeaderConfig:ReportHeaderConfig}});window.require.register("/component/editor/report/report-generator.js",function(exports,module,require){module.exports=function(data){var config=require("/js/config");var user=require("/js/user");var ids=_.uniq($(".gr-alert").map(function(){return this.id}));var cont=$(".error-list-errors");var i=ids.length-1;while(i>=0){var id=ids[i];cont.prepend($(".b-card[data-id='"+id+"']"));i--}var cards=$(".error-list").html();var text=$(".clone-val").html();var alerts=cards.match(/data-id="\d+"/gi)||[];alerts=alerts.map(function(str){return str.replace('data-id="',"").replace('"',"")});var doubledIndexes=[];var tripledIndexes=[];for(var i=0;i<alerts.length;i++){var id=alerts[i];var index=text.lastIndexOf("gr_"+id);if(index!=-1){text=text.substring(0,index)+"last "+text.substring(index,text.length);while(text.substring(index,index+4)!="</g>"){index++;if(text.substring(index,index+12)=="</g></g></g>"){tripledIndexes.push(i);i++}if(text.substring(index,index+8)=="</g></g>"){doubledIndexes.push(i);i++}}}}text=text.replace(/f<\/g>/gi,"f<span class='spacer'></span></g>");text=text.replace(/([.,-])<\/g>/gi,"<span class='negative-spacer'>$1</span></g><span class='spacer'></span>");var styles=[];for(var i=0;i<alerts.length;i++){var cls=alerts[i];var t=(i+1).toString();if(tripledIndexes.indexOf(i)!=-1){t+=", "+(i+2)+", "+(i+3);styles.push(".gr_"+cls+".last:after { box-sizing: content-box; padding-right: 0.38em; background: #fff; }")}if(doubledIndexes.indexOf(i)!=-1){t+=", "+(i+2);styles.push(".gr_"+cls+".last:after { box-sizing: content-box; padding-right: 0.38em; background: #fff; }")}styles.push(".gr_"+cls+".last:after { content: '"+t+"'; }")}var offset=(new Date).getTimezoneOffset()*-1*60*1e3;var time=(new Date).getTime();var dStr=new Date(time+offset).toUTCString().replace(/:\d\d\sGMT/gi,"");var report=_.extend({text:text,cards:cards,styles:styles.join(" "),date:dStr},data);var html=Handlebars.partials.report(report);var iframe=document.createElement("iframe");iframe.name="reportIframe";function calcPositions(document){var cards=document.querySelectorAll(".b-card");var len=cards.length;var prevTop=0;for(var i=0;i<len;i++){var c=cards[i];var id=c.getAttribute("data-id");var underline=document.querySelectorAll(".gr_"+id);underline=underline[underline.length-1];var underlineTop=underline.offsetTop;var cardTop=underlineTop;if(underlineTop<=prevTop+3){cardTop=prevTop+5}c.style.top=cardTop+"px";prevTop=cardTop+c.clientHeight}}var mainDocument=document;document.body.appendChild(iframe);addEventListener("message",function(e){if(e.source.name!="reportIframe")return;if(e.data=="loaded"){function _css(){iframe.contentWindow.document.body.innerHTML=html;$(iframe).css({visibility:"hidden",height:"100%",width:"100%",top:-5e3,left:-500,position:"absolute",zIndex:"99999999"})}if(iframe.contentWindow.document.body)_css();else setTimeout(_css,100)}setTimeout(function(){mainDocument.querySelector(".report-finish").classList.add("disable");calcPositions(iframe.contentDocument);var frames=iframe.contentDocument.querySelectorAll("iframe");for(var i=0;i<frames.length;i++){frames[i].parentNode.removeChild(frames[i])}var html='<!doctype html>\n<html lang="en">'+iframe.contentWindow.document.documentElement.innerHTML+"</html>";var form=document.createElement("form");var field=document.createElement("input");field.type="hidden";field.name="source_file";form.action=config.REPORT_API;form.method="post";form.target="reportIframe";form.enctype="multipart/form-data";form.appendChild(field);document.body.appendChild(form);var cssLink=html.match(/<link.*?href="(.*?)".*>/);$.ajax(cssLink[1]).done(function(result){html=html.replace(cssLink[0],"<style>"+result+"</style>");html=html.replace(/→/g,"&rarr;").replace(/–/g,"&#45;").replace(/’/g,"&#39;").replace(/“|”/g,"&quot;");field.value=html;try{form.submit()}catch(e){console.error(e);window.tracker.felog.exception(e,{errorType:"report form send fail"});setTimeout(function(){form.submit()},50)}}).fail(function(e){console.error(e);window.tracker.felog.exception(new Error("report inject css fail"),e)})},200)},false);iframe.src=config.REPORT_TEMPLATE_URL}});window.require.register("/component/editor/report/report.js",function(exports,module,require){var DialogHeight=require("/js/util").DialogHeight,reportConfig=require("report-config"),ReportConfig=human_categories.getConfig,ReportHeaderConfig=reportConfig.ReportHeaderConfig,generateReport=require("report-generator"),user=require("/js/user");module.exports=function(config){var matches=config.matches,text=config.text,score=require("../score/score")(text,matches),plagiarism=require("../plagiarism-percent/plagiarism-percent")(text,matches),apps=config.apps,title=config.title,track=config.track,userName=config.userName;var reportEl,dialogHeight;drawReport(matches);function filterMatches(matches){matches=matches.filter(function(m){return!m.syn&&m.undoed!==false});return matches}function drawReport(matches){var _matches=filterMatches(matches);var curMatches=perehach(_matches);var container=$("body");var data=getReportData(_matches,curMatches);data.header=composeHeader(score,curMatches);reportEl=$(Handlebars.partials.report_page(data));reportEl.css("visibility","hidden");container.append(reportEl);dialogHeight=DialogHeight(reportEl.find(".scroller"),120);reportEl.css("visibility","");$(window).on("keyup",keyup);$(".report-finish").click(download);$(".report-close").click(remove)}function getReportData(matches,curMatches){var plagiarismCount=plagiarism;var scoreCount=score;var showPlagiarism=true;if(user.isInstitutionUser()){plagiarismCount=!user.$get("institutionPlagiarismDisabled")&&plagiarism;score=!user.$get("institutionScoreDisabled")&&score;showPlagiarism=!user.$get("institutionPlagiarismDisabled")&&plagiarism}return{groups:curMatches,score:scoreCount,issues:matches.filter(function(m){return m.category!="Plagiarism"}).length,plagiarism:plagiarismCount,title:title,showPlagiarism:showPlagiarism,isPlagiarismActive:apps.Plagiarism&&apps.Plagiarism.active,isInstituteUser:user.isInstitutionUser()&&user.$get("institutionScoreDisabled")}}function download(e){if($(e.target).hasClass("disable"))return false;track("track:report-download",score);var data=getReportData(filterMatches(matches),perehach(matches));return generateReport(data)}function keyup(e){if(e.keyCode==27)remove()}function remove(){if(!reportEl)return;dialogHeight.stop();reportEl.remove();$(window).off("keyup",keyup);track("track:report-closed")}function get3MatchesWithHandbook(){var matchesWithHanbookUrl=matches.filter(function(m){return m.handbookLink});var handbookCategories=_.sortBy(_.groupBy(matchesWithHanbookUrl,function(o){return o.category}),function(k){return-k.length});var handbookMatches=[];for(var i=0;i<handbookCategories.length;i++){if(handbookCategories[i].length==0)continue;if(handbookMatches.length==3)continue;handbookMatches.push(handbookCategories[i].pop())}var labels=_.groupBy(_.flatten(ReportConfig().map(function(o){return o.items})),function(o){return o.type});handbookMatches=handbookMatches.map(function(m){var url=m.handbookLink||"";return{url:url.split("\n")[0],label:labels[m.category]&&labels[m.category][0].name}});return handbookMatches}function composeHeader(score,matches){var obj={};if(score==100){obj=_.extend({},ReportHeaderConfig.top)}else if(score<100&&score>=80){obj=randomize(ReportHeaderConfig.middle)}else if(score<80){obj=randomize(ReportHeaderConfig.bottom)}if(obj.attention)obj.attention=getCat(matches,obj.attention);function getCat(matches,str){var a=_.sortBy(matches,function(o){return-o.value}),b=[a[0].name,a[1].name],tmpl=['<span class="recommendation">',"</span>"];b[0]=tmpl.join(b[0]);b[1]=tmpl.join(b[1]);str=str.replace("<cat1>",b[0]).replace("<cat2>",b[1]);return str}obj.handbook="";if(score!=100){var handbookMatches=get3MatchesWithHandbook();var handbookLabel=obj.handbook;var handbookSentence=handbookLabel+" ";var len=handbookMatches.length;for(var i=0;i<len;i++){handbookSentence+="<a target='__blank' href='http://www.grammarly.com/handbook/"+handbookMatches[i].url+"'>"+handbookMatches[i].label+"</a>";var sep=", ";if(i==len-2)sep=" and ";if(i==len-1)sep=".";handbookSentence+=sep}if(len==0||typeof len=="undefined")handbookSentence="";obj.handbook=handbookSentence}function randomize(data){var obj={};for(var i in data){var r=_.random(0,data[i].length-1);obj[i]=data[i][r]}return obj}obj.title+=", "+userName.split(" ")[0];obj.title=responsiveTitle(obj.title);obj.score=score;return obj}function responsiveTitle(title){var measureElement=$("<div>");var fs=43;measureElement.css({fontSize:fs,marginBottom:10,paddingRight:40,width:449,visibility:"hidden"});measureElement.html("L");$(document.body).append(measureElement);var oneLineHeight=measureElement.height();measureElement.html(title);if(measureElement.height()==oneLineHeight){measureElement.remove();return title}while(measureElement.height()-oneLineHeight>0){measureElement.css({fontSize:fs});measureElement.html("L");oneLineHeight=measureElement.height();measureElement.html(title);fs--}measureElement.remove();return"<span style='font-size:"+fs+"px;'>"+title+"</span>"}function perehach(matches){var matchesGroup=_.groupBy(matches,"category"),max=_.chain(matchesGroup).values().max("length").value().length;return ReportConfig().map(groupUpdate.bind(this,matchesGroup,max));function groupUpdate(matchesGroup,max,group){group.items=group.items.map(function(item){item.value=matchesGroup[item.type]&&matchesGroup[item.type].length||0;item.percent=(item.value/max*100).toFixed(2);return item}).filter(function(item){return item.value}).sort(function(a,b){return b.value-a.value});group.value=group.items.reduce(function(total,item){return total+=item.value},0);var app=apps[group.app];if(app){group.active=app.active;group.zero=group.value==0&&app.active}return group}}return{close:remove,score:score}}});window.require.register("/component/editor/score/score.js",function(exports,module,require){var SCORE_CATEGORIES={ContextualSpelling:1.2,Grammar:1,SentenceStructure:.9,Punctuation:.7,Style:.3,Enhancement:0,Plagiarism:0};var wordCount=require("/js/util").wordCount;module.exports=function(text,matches){var k=11;var words=wordCount(text);var alertWeight=0;for(var i=0;i<matches.length;i++){var val=SCORE_CATEGORIES[matches[i].group];if(isNaN(val))val=0;alertWeight+=val}var result=Math.floor((1-Math.min(1,k*alertWeight/words))*100);if(isNaN(result))result="";return result}});window.require.register("/component/editor/subscription/billing/billing.js",function(exports,module,require){var app=require("/js/app"),user=require("/js/user"),config=require("/js/config"),route=require("/js/route"),validator=require("/component/common/util/validators"),subscription=require("/component/page/subscription/subscription-api"),notification=require("/component/editor/notification/notification");module.exports=Vue.component("subscription-billing",{template:Handlebars.partials.editor__subscription_billing(),replace:true,data:{disabled:false,sesionId:"",loading:false,plans:[]},methods:{handleClickPaypal:function(e,name,resumeVM){this.$set("loading",true);var token=this.$get("tokens.paypal");if(!token)subscription.generatePaypalToken().then(subscribe.bind(this));else subscribe.call(this,token)},handleChange:function(status){this.$set("loading",status);this.$set("fieldsValid.cvv",status);this.$set("fieldsValid.cc_no",status);this.$set("fieldsValid.cc_exp_mm ",status);this.$set("fieldsValid.cc_exp_yyyy",status);this.$set("fieldsValid.zip",true)}},directives:{"date-in-past":function(date){var month=date[0],year=date[1],vm=this.vm,options={cc_exp_yyyy:year,cc_exp_mm:month};if(validator["cc_exp_mm"](month)&&validator["cc_exp_yyyy"](year)&&validator["dateinpast"](options)){Vue.nextTick(function(){vm.$broadcast("field:nonvalid",["cc_exp_mm","cc_exp_yyyy","encryptedMonth","encryptedYear"])})}else if(validator["cc_exp_mm"](month)&&validator["cc_exp_yyyy"](year)&&!validator["dateinpast"](options)){Vue.nextTick(function(){vm.$broadcast("field:valid",["cc_exp_mm","cc_exp_yyyy","encryptedMonth","encryptedYear"])})}}},attached:function(){}});function subscribe(token){token=typeof token=="string"&&token||token&&token.requestId;setTimeout(function(){subscription.generateRequestToken({token:token},function(res){return res&&res.paypalRedirectPage}).always(redirectToPaypal)},1e3)}function redirectToPaypal(data){if(data.paypalRedirectPage)document.location=data.paypalRedirectPage}});window.require.register("/component/editor/subscription/billing/card/card.js",function(exports,module,require){var config=require("/js/config"),user=require("/js/user"),route=require("/js/route"),subscription=require("/component/page/subscription/subscription-api"),notification=require("/component/editor/notification/notification"),startTime;
module.exports=Vue.component("drop-in-ui",{template:Handlebars.partials.drop_in_ui(),data:{session:{},loading:false},ready:function(){var ccToken=this.$get("tokens.creditcard");if(ccToken)this.getToken(ccToken);else this.generateToken();if(!this.$get("session.sessionId"))this.$set("session.sessionId",makeid())},methods:{generateToken:function(){subscription.generateCardToken().then(function(requestData){setTimeout(this.getToken.bind(this,requestData.requestId),1e3)}.bind(this))},getToken:function(token){subscription.generateRequestToken({token:token},function(res){return res&&res.token}).then(function(data){this.initBraintreeFields(data.token)}.bind(this)).fail(function(){this.$dispatch("notification:show",{className:"fail",type:"unknown_error"});this.$dispatch("track:subscription-token-retries-failed")}.bind(this))},initBraintreeFields:function(token){braintree.setup(token,"custom",{id:"subscription-form__credit-card",hostedFields:{number:{selector:"#encryptedCardNumber",placeholder:"Card Number"},cvv:{selector:"#encryptedCvv"},expirationMonth:{selector:"#encryptedMonth",placeholder:"MM"},expirationYear:{selector:"#encryptedYear",placeholder:"YY"},styles:{input:{"font-size":"16px","font-family":"Helvetica, Arial"},".invalid":{color:"#e2534f"},"::-webkit-input-placeholder":{color:"#b1b1b1","font-weight":"300"},":-moz-placeholder":{color:"#b1b1b1","font-weight":"300"},"::-moz-placeholder":{color:"#b1b1b1","font-weight":"300"},":-ms-input-placeholder":{color:"#b1b1b1","font-weight":"300"},":focus::-webkit-input-placeholder":{color:"#e8e8e8"},":focus:-moz-placeholder":{color:"#e8e8e8"},":focus::-moz-placeholder":{color:"#e8e8e8"},":focus:-ms-input-placeholder":{color:"#e8e8e8"}},onFieldEvent:function(e){if(e.type!=="fieldStateChange")return}},onPaymentMethodReceived:this.processResponseBraintree.bind(this)})},handleChange:function(status){this.$set("loading",status)},processResponseBraintree:function(receivedData){var data={};data.nonce=receivedData.nonce;return subscription.updateCard(data).then(this.handleSubmitted.bind(this),this.responseError.bind(this))},handleSubmitted:function(param){var me=this;this.handleChange(false);if(param.status=="error"){this.responseError()}else{subscription.getPaymentProfile().then(function(paymentInfo){route.toSubscription();me.$dispatch("subscription:reflow",paymentInfo);me.$dispatch("notification:show",{className:"success",type:"update_billing"});me.$dispatch("track:subscription-card-update",true,Date.now()-startTime);me.handleChange(false);me.$set("loading",false)})}},responseError:function(){this.$dispatch("notification:show",{className:"fail",type:"6003"});this.handleChange(true);this.$set("disabled",true);this.$set("loading",false)},submitForm:function(){setTimeout(function(){var errorField=document.querySelectorAll(".braintree-hosted-fields-invalid");if(!errorField.length)this.handleChange(true)}.bind(this),500)}},directives:{months:function(params){params.article=params.article?params.article+" ":"";this.el.innerHTML=params.months>1?params.months+"&nbsp;months":params.article+"month"}}});function makeid(){var text="";var possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<32;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}});window.require.register("/component/editor/subscription/billing/field/field.js",function(exports,module,require){var validator=require("/component/common/util/validators");module.export=Vue.component("billing-input",{replace:true,data:{disabled:false,valid:true,max:null},template:Handlebars.partials.editor__billing_input(),methods:{handleFieldBlur:function(e){var name=this.$get("name"),value=this.$get(name),isValid=validator[name](value);if(name=="encryptedYear"||name=="encryptedMonth"){var secondField=name=="encryptedMonth"?"encryptedYear":"encryptedMonth",secondSmall=name=="encryptedMonth"?"cc_exp_yyyy":"cc_exp_mm",secondVal=this.$get(secondField),isValidSecond=validator[secondField](secondVal);!isValidSecond&&this.$parent.$broadcast("field:nonvalid",[secondSmall,secondField])}this.$set(name,value);this.$set("valid",isValid);this.$dispatch("form:validate-field",{name:name,isValid:isValid})},handleFieldFocus:function(e){this.$set("valid",true)},handleChange:function(e){},handleFieldKeyup:function(e){if(e.keyCode==13)this.$dispatch("form:submit",e);var name=this.$get("name"),value=$.trim(this.$get(name)),isValid=validator[name](value);this.$dispatch("form:validate-field",{name:name,isValid:isValid});emulateTab.call(this,e);divideCreditCard(e)},transform:function(type){var name=this.$get("name"),value=this.$get(name),transformValue=parseInt(value);if(name=="cc_exp_yyyy")transformValue=type=="after"?transformValue-2e3:transformValue+2e3;if(name=="cc_no")transformValue=type=="after"?value.replace(/([\d]{4})/g,"$1 "):value.replace(/\s/g,"");if(transformValue<10&&type=="after")transformValue="0"+transformValue;this.$set(name,transformValue)},getValue:function(){},changeState:function(state){this.$el.removeAttribute("disabled");if(state)this.$el.setAttribute("disabled",state)}},ready:function(){var me=this;this.$on("field:nonvalid",function(names){var name=me.$get("name");if(_.contains(names,name)){me.$set("valid",false);me.$dispatch("form:validate-field",{name:name,isValid:false})}});this.$on("field:valid",function(names){var name=me.$get("name");if(_.contains(names,name)){me.$set("valid",true);me.$dispatch("form:validate-field",{name:name,isValid:true})}});this.$on("field:disable",this.changeState.bind(this,true));this.$on("field:enable",this.changeState.bind(this,false));this.$on("field:getValue",this.getValue.bind(this));if(this.$get("transformBeforeSend"))this.$on("transform:beforeSend",this.transform.bind(this,"before"));if(this.$get("transformBeforeSend"))this.$on("transform:afterSend",this.transform.bind(this,"after"))}});function emulateTab(e){var id=$(e.target).attr("id"),value=e.target.value,input=$(e.target).parents("form").find("input:visible"),index=input.index(e.target),keyCode=e.keyCode,valueNoSpace=value.replace(/\s/g,""),max=e.targetVM.$get("max");if(valueNoSpace.length>=max&&checkKeyCode(keyCode)){input.eq(index+1).focus()}}function divideCreditCard(e){var vm=e.targetVM,el=e.target,keyCode=e.keyCode,nameList=["cc_no","encryptedCardNumber"],value=$.trim(e.target.value),valueNoSpace=value.replace(/\s/g,""),name=$.trim(vm.$get("name")),max=e.targetVM.$get("max");if(_.contains(nameList,name)&&checkKeyCode(keyCode)){el.value=valueNoSpace.replace(/([\d]{4})/g,"$1 ").replace(/\s$/,"").slice(0,19).toString()}}function checkKeyCode(keyCode){return keyCode!=8&&keyCode!=9&&keyCode!=39&&keyCode!=37&&keyCode!=91&&keyCode!=17&&keyCode!=65}});window.require.register("/component/editor/subscription/cancel/cancel.js",function(exports,module,require){var app=require("/js/app"),user=require("/js/user"),config=require("/js/config"),route=require("/js/route"),subscription=require("/component/page/subscription/subscription-api"),notification=require("/component/editor/notification/notification"),startTime;module.exports=Vue.component("subscription-cancel",{template:Handlebars.partials.editor__subscription_cancel(),data:{disabled:false},methods:{cancelSubscription:function(){return subscription.cancel()},handleCancel:function(e,name,buttonVM){var me=this;if(this.$get("disabled"))return false;this.$set("disabled",true);buttonVM.loading=true;startTime=Date.now();this.cancelSubscription().then(subscription.getPaymentProfile).then(function(payment){var paymentInfo=payment;route.toCancelled();me.$dispatch("subscription:reflow",paymentInfo);me.$dispatch("notification:show",{className:"success",type:"cancelled"});me.$dispatch("track:cancel-subscription",true,Date.now()-startTime)},function(){me.$dispatch("notification:show",{className:"fail",type:"unknown_error"});me.$dispatch("track:cancel-subscription",false,Date.now()-startTime);console.error("problem cancel subscription")}).always(function(){me.$set("disabled",false);buttonVM.loading=false})}},directives:{date:function(val){var date=new Date(val),month=date.getMonth(),day=date.getDate(),year=date.getFullYear(),monthsList=["January","February","March","April","May","June","July","August","September","October","November","December"];return this.el.innerHTML=monthsList[month]+"&nbsp;"+day+",&nbsp;"+year}},created:function(){this.$set("selectedTab","cancel")},attached:function(){this.$set("selectedTab","cancel")}})});window.require.register("/component/editor/subscription/manage/manage.js",function(exports,module,require){var app=require("/js/app"),user=require("/js/user"),config=require("/js/config"),route=require("/js/route"),isMobile=require("/component/common/util/mobile"),subscription=require("/component/page/subscription/subscription-api"),notification=require("/component/editor/notification/notification"),startTime;module.exports=Vue.component("subscription-manage",{template:Handlebars.partials.editor__subscription_manage(),data:{disabled:false,queuedPlan:{},currentPlan:{},isMobile:isMobile(window.navigator.userAgent)},methods:{updatePlan:function(e,plan,id){var data={plan:plan};var plans=user.$get("paymentProfile.plans")||[];var isRegularPlan=plans.some(function(item){return item.regularPlanId==id});if(!isRegularPlan){plan=plans.filter(function(item){return item.title==plan})[0];id=plan&&plan.id||id}if(this.$get("status.usesNewBilling"))data.planId=id;return subscription.changePlan(id)},handleClickUpdate:function(e,name,id,buttonVM){var me=this;if(me.$get("disabled"))return false;me.$set("disabled",true);buttonVM.$set("loading",true);if(/annual/gi.test(name))name="Yearly";startTime=Date.now();me.updatePlan(e,name,id).then(subscription.getPaymentProfile).then(function(paymentInfo){me.$dispatch("subscription:reflow",paymentInfo);me.$dispatch("notification:show",{className:"success",type:"upgraded",data:{name:/year/i.test(name)?"Annual":name}});route.toSubscription();me.$dispatch("track:update-subscription-plan",true,Date.now()-startTime,name)},function(){me.$dispatch("notification:show",{className:"fail",type:"cant_upgrade"});me.$dispatch("track:update-subscription-plan",false,Date.now()-startTime,name);console.error("problem update plan")}).always(function(){me.$set("disabled",false);buttonVM.$set("loading",false)})},handleClickCancel:function(){this.$set("selectedTab","cancel")}},computed:{canChange:function(){var plans=this.$get("plans");if(!plans)return false;return plans.some(function(plan){return plan.id==this.$get("currentPlan.id")},this)}},attached:function(){this.$set("$data.fieldsValid",{cvv:false,cc_no:false,cc_exp_mm:false,cc_exp_yyyy:false});this.$set("disabled",false);this.$set("disabled",false);if(this.isMobile)this.$dispatch("notification:show",{className:"info",type:"mobile_cancel"})}})});window.require.register("/component/editor/subscription/notification/notification.js",function(exports,module,require){var app=require("/js/app"),user=require("/js/user"),config=require("/js/config"),route=require("/js/route"),notification=require("/component/editor/notification/notification");module.exports=Vue.component("subscription_notification",{template:Handlebars.partials.subscription_notification(),data:{content:""},methods:{setContent:function(){var notification=this.$get("notification");var template=Handlebars.partials["message_"+notification.type];if(typeof template=="function"){this.content=template({data:notification.data})}else{this.content=""}}},computed:{},ready:function(){this.$watch("notification",function(data){this.$set("message",data.type);this.setContent()})}})});window.require.register("/component/editor/subscription/proofit_notification/proofit_notification.js",function(exports,module,require){});window.require.register("/component/editor/subscription/summary/main/main.js",function(exports,module,require){var app=require("/js/app"),user=require("/js/user"),config=require("/js/config"),route=require("/js/route"),subscription=require("/component/page/subscription/subscription-api"),startTime;module.exports=Vue.component("editor:subscription-main",{template:Handlebars.partials.editor__subscription_main(),data:{disabled:false,plans:[]},methods:{handleClickResume:function(e,name,resumeVM){var me=this;if(this.$get("disabled"))return false;this.$set("disabled",true);resumeVM.$set("loading",true);startTime=Date.now();this.resumePlan().then(subscription.getPaymentProfile).then(function(paymentInfo){route.toSubscription();me.$dispatch("subscription:reflow",paymentInfo);me.$dispatch("notification:show",{className:"success",type:"resumed"});me.$dispatch("track:resume-subscription-plan",true,Date.now()-startTime)},function(){me.$dispatch("notification:show",{className:"fail",type:"cant_resume"});me.$dispatch("track:resume-subscription-plan",false,Date.now()-startTime)}).always(function(){me.$set("disabled",false);resumeVM.$set("loading",false)})},resumePlan:function(){return subscription.renew()}}})});window.require.register("/component/editor/subscription/summary/referral/referral.js",function(exports,module,require){var app=require("/js/app"),user=require("/js/user"),config=require("/js/config"),route=require("/js/route"),subscription=require("/component/page/subscription/subscription-api"),startTime;module.exports=Vue.component("editor:subscription-referral",{template:Handlebars.partials.editor__subscription_referral(),data:{disabled:false,plans:[]},methods:{goToUpgrade:function(){this.$dispatch("track:hook-clicked")}}})});window.require.register("/component/editor/subscription/summary/summary.js",function(exports,module,require){var app=require("/js/app"),user=require("/js/user"),config=require("/js/config"),route=require("/js/route"),subscription=require("/component/page/subscription/subscription-api"),startTime;module.exports=Vue.component("subscription-summary",{template:Handlebars.partials.editor__subscription_summary()})});window.require.register("/component/editor/text-stat/text-stat.js",function(exports,module,require){var me,text;var util=require("/js/util");module.exports=Vue.component("editor:text-stat",{template:Handlebars.partials.editor__text_stat(),replace:true,attached:function(){me=this},data:{value:""},methods:{update:function(_text){text=_text||text;me.value=modes[modeKeys[mode]](text)},onClick:function(){mode++;if(mode==modeKeys.length)mode=0;me.update()}},beforeDestroy:function(){text=null}});var modeKeys=["word","char","speaking","reading"],mode=0,modes={word:function(text){var c=util.wordCount(text);if(c==0)return"";return c+util.declension(c,[" word"," words"])},"char":function(text){var c=charCount(text);if(c==0)return"";return c+util.declension(c,[" character"," characters"])},speaking:function(text){return calculateTime(text,130,"Speaking time: ")},reading:function(text){return calculateTime(text,250,"Reading time: ")}};function calculateTime(text,wordsPerMinute,lbl){var wordsPerSecond=wordsPerMinute/60;var words=util.wordCount(text);var time=words/wordsPerSecond;var hours=Math.floor(time/3600);time=time-hours*3600;var minutes=Math.floor(time/60);var seconds=time-minutes*60;var result="";if(hours>0)result=hours+" h ";if(minutes>0)result+=minutes+" min ";if(minutes>=10)seconds=0;if(seconds>0)result+=Math.floor(seconds)+" s";return lbl+result}function charCount(text){return text?_decode(text).length:0}function _decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if((value&63488)==55296&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value,extra)}}else{output.push(value)}}return output}});window.require.register("/component/editor/tool/checks/apps/apps.config.js",function(exports,module,require){var freeApps=["ContextualSpelling","Grammar","Punctuation","SentenceStructure","Style"],activeByDefault=["ContextualSpelling","Grammar","Punctuation","SentenceStructure","Style"],apps={ContextualSpelling:{active:true,count:0,id:"ContextualSpelling",name:"Contextual spelling",tooltip:"Checks for spelling errors and correctly spelled words used in the wrong context, such as erroneous use of <i>lose/loose</i>, <i>affect/effect</i>, <i>lie/lay</i>, <i>there/their/they're</i> and many others."},Grammar:{active:true,count:0,id:"Grammar",name:"Grammar",tooltip:"Checks text for subject-verb agreement, misused articles, consistent verb forms and tenses and many more grammar rules."},Punctuation:{active:true,count:0,id:"Punctuation",name:"Punctuation",tooltip:"Checks for missing or redundant commas, periods, colons and semicolons."},SentenceStructure:{active:true,count:0,id:"SentenceStructure",name:"Sentence structure",tooltip:"Identifies misplaced words, faulty word order and incorrect sentence structure."},Style:{active:true,count:0,id:"Style",name:"Style",tooltip:"Checks for potential problems in writing style and helps to avoid redundancy and wordiness."}};module.exports={active:apps,free:freeApps}});window.require.register("/component/editor/tool/checks/apps/apps.js",function(exports,module,require){var notification=require("/component/editor/notification/notification"),user;var config=require("/component/editor/tool/checks/apps/apps.config");Vue.component("editor:tool-apps",{template:Handlebars.partials.editor__tool_apps(),replace:true,data:{apps:{},freeApps:[],proVersion:false,someactive:true},attached:function(){user=user||require("/js/user");this.apps=config.active;this.freeApps=config.freeApps;this.proVersion=user.isPremiumUser()},beforeDestroy:function(){this.apps={}},created:function(){this.$watch("apps",function(apps){this.someactive=_.some(apps,{active:true});this.$dispatch("set:someactive",this.someactive)});this.$on("checks:toogle-all",this.toggleAll.bind(this))},methods:{toggle:function(vm,evt){evt.preventDefault();evt.stopPropagation();if(isTooltip(evt.target))return false;var app=this.apps[vm.id];app.active=!app.active;notification.show({message:"message_app_state",data:app,delay:3e3});this.$emit("appToggled",app)},current:current,load:function(saved){var me=this;if(!me.apps||!saved)return;_.each(this.apps,function(app){var id=app["id"];_.extend(me.apps[id],saved[id])})},update:update,toggleAll:function(){function changActive(state,app){app.active=state}if(this.someactive)_.forEach(this.apps,changActive.bind(this,false));else _.forEach(this.apps,changActive.bind(this,true));this.$emit("appToggled",this.apps)}}});function isTooltip(el){return $(el).hasClass("tooltip-content")}function current(){var actives={};for(var oneapp in this.apps){var app=this.apps[oneapp];actives[oneapp]={active:app.active}}return actives}function update(matches){for(var i in this.apps){var _matches=matches.filter(function(m){return m.group==i&&!m.syn&&!m.replaced});this.apps[i].count=_matches.length}}});window.require.register("/component/editor/tool/checks/genres/genres.config.js",function(exports,module,require){var genres=[{id:"general",name:"General (default)"},{id:"academic",name:"Academic",sub:[{name:"General academic",id:"academic_general"},{name:"Essay",id:"academic_essay"},{name:"Report",id:"academic_report"},{name:"Case study",id:"academic_case"},{name:"Book/literature review",id:"academic_review"},{name:"Research proposal",id:"academic_proposal"},{name:"Research results",id:"academic_results"},{name:"Dissertation",id:"academic_disser"},{name:"Admission letter",id:"academic_letter"}]},{id:"business",name:"Business",sub:[{id:"business_other",name:"General business"},{id:"business_letter",name:"Business letter"},{id:"business_email",name:"Business email"},{id:"business_report",name:"Report"},{id:"business_memo",name:"Memo"},{id:"business_proposal",name:"Proposal"},{id:"business_article",name:"Article/blog post"},{id:"business_adv",name:"Ad/website copy"}]},{id:"technical",name:"Technical",sub:[{name:"General technical",id:"technical_other"},{name:"End-user assistance document",id:"technical_manual",tooltip:"Various types of technical user manuals"},{name:"Technical documentation",id:"technical_documentation",tooltip:"Specifications, repair guides, technical articles"},{name:"Marketing document",id:"technical_marketing",tooltip:"Brochures, product catalogs"}]},{id:"medical",name:"Medical",sub:[{name:"General medical",id:"medical_other"},{name:"Regulatory writing",id:"medical_regulatory",tooltip:"Clinical study protocols, reports, consent forms"},{name:"Educational writing",id:"medical_educational",tooltip:"Healthcare marketing literature and presentations"}]},{id:"creative",name:"Creative",sub:[{id:"creative_other",name:"General creative"},{id:"creative_nonfiction",name:"Creative non-fiction"},{id:"creative_novel",name:"Novel"},{id:"creative_script",name:"Script"},{id:"creative_story",name:"Short story"}]},{id:"casual",name:"Casual",sub:[{id:"casual_other",name:"General casual"},{id:"casual_email",name:"Personal email"},{id:"casual_blog",name:"Personal blog post"}]}];module.exports=genres});window.require.register("/component/editor/tool/checks/genres/genres.js",function(exports,module,require){var notification=require("/component/editor/notification/notification"),genres=require("/component/editor/tool/checks/genres/genres.config"),timer;var defaultGenre="general",model=Vue.extend({template:Handlebars.partials.editor__tool_genres(),replace:true,data:{genres:genres,current:defaultGenre},methods:{setActive:function(item,evt){evt.preventDefault();evt.stopPropagation();if(item.sub)return;var title=getTitle(item.id,this.genres);this.current=item.id;notification.show({message:"message_genre",data:title.join(" - "),autohide:true,delay:3e3});closeMenu();this.$emit("genreChanged",{id:item.id,title:title});this.$dispatch("track:genre",item.id)},load:function(saved){if(!saved)return;this.current=saved},getTitle:function(id){return getTitle(id||this.current,this.genres)}},filters:{genresname:function(name){if(!name)return"";var genreName=name;genres.forEach(function(genre){if(genre.id==name)genreName=genre.name;if(genre.sub)genre.sub.forEach(function(subgenre){if(subgenre.id==name)genreName=subgenre.name})});return genreName}}});Vue.component("editor:tool-genres",model);module.exports=model;function getTitle(id,genre){var parentId=id.split("_")[0],group=_.find(genre,{id:parentId}),title=[group.name||""];if(group.sub){var subgroup=_.find(group.sub,{id:id});title.push(subgroup.name)}return title}function closeMenu(){$(".editor__tool_checks").removeClass("hover")}});window.require.register("/component/editor/tool/common/common.js",function(exports,module,require){var notification=require("/component/editor/notification/notification");module.exports=Vue.extend({template:Handlebars.partials.editor__tool_common(),replace:true,methods:{toggle:function(vm,evt){evt.preventDefault();evt.stopPropagation();if(this.$get("user.type")=="Free")return false;this.active=!this.active;notification.show({message:"message_app_state",data:this.$get("$data"),delay:3e3});this.$emit("appToggled",this.$get("$data"))},current:function(){var obj={};obj[this.id]={active:this.active};return obj},load:function(saved){if(!saved)return;this.active=saved[this.id]&&saved[this.id].active},hideTemplate:function(){if(this.$el)this.$el.style.display="none"}}})});window.require.register("/component/editor/tool/enchantment/enchantment.config.js",function(exports,module,require){module.exports={placement:"popup_editor_enhancement",active:true,count:0,id:"Enhancement",uuid:"enhancement",name:"Vocabulary enhancement",description:"Provides vocabulary enhancement suggestions to diversify your writing.",plus:"editor:plus-enhancement"}});window.require.register("/component/editor/tool/enchantment/enchantment.js",function(exports,module,require){var data=require("/component/editor/tool/enchantment/enchantment.config"),common=require("/component/editor/tool/common/common"),element=common.extend({data:data,methods:{update:function update(matches){var _matches=matches.filter(function(m){return m.group=="Enhancement"&&!m.syn&&!m.replaced});this.count=_matches.length}}});module.exports=Vue.component("editor:tool-enhancement",element)});window.require.register("/component/editor/tool/menu/menu.js",function(exports,module,require){var dialog=require("/component/common/dialog/dialog"),detect=require("/detect/detect"),notification=require("/component/editor/notification/notification"),isNavigationAllowed=require("/js/persistence-monitor").isNavigationAllowed,lbl=detect.OS=="mac"?"⌘":"Ctrl+",flashUnusable=true,items,icon__download,model=Vue.extend({template:Handlebars.partials.editor__tool_menu(),replace:true,data:{showMenu:false,label:lbl,flashUnusable:flashUnusable,supportUrl:"http://support.grammarly.com/login"},attached:function(){ZeroClipboard.config({swfPath:swf_url});if(flashUnusable)return;icon__download=$(".icon__download");items=$(".icon__download > .items");icon__download.on("mouseenter",showZeroClipboard);icon__download.on("mouseleave",hideZeroClipboard);items.on("mouseleave",hideZeroClipboard);var $clippy=$(".copy-btn"),client=new ZeroClipboard($clippy),clipboard;client.on("copy",function(event){clipboard=event.clipboardData;clipboard.setData("text/plain",app.$.editor.getText())})},methods:{fire:function(e,name){e.preventDefault();this.$emit(name,this)},support:function(e){this.$dispatch("track:support-button-clicked");this.$dispatch("track:menu-action","support")},update:function(showMenu){this.showMenu=showMenu},create:function(e){if(!isNavigationAllowed())return e.preventDefault();this.$dispatch("track:new-document-button-clicked");this.$dispatch("track:menu-action","create");this.fire(e,"create")},copyClick:copyClick,pasteClick:pasteClick,isUploadAllowed:function(e){!isNavigationAllowed()&&e.preventDefault()},upload:function(e){this.$emit("upload",e);this.$dispatch("track:menu-action","upload")},download:function(e){this.fire(e,"download");this.$dispatch("track:menu-action","download")},myGrammarly:function(e){if(!isNavigationAllowed())return e.preventDefault();this.$dispatch("track:menu-action","myGrammarly")},tutorial:function(){if(!isNavigationAllowed())return e.preventDefault();this.$dispatch("track:tutorial");this.$dispatch("track:menu-action","tutorial")}}});Vue.component("editor:tool-menu",model);module.exports=model;function showZeroClipboard(){icon__download.css({"background-color":"#242629"});items.css({display:"block","z-index":"1230"})}function hideZeroClipboard(){icon__download.css({"background-color":"#323439"});items.css({display:"none","z-index":"-1"})}function copyClick(){if(flashUnusable){dialog.show("editor__copy_paste",{label:lbl})}else{notification.show("message_copy_done");hideZeroClipboard()}this.$dispatch("track:menu-action","copy")}function pasteClick(){dialog.show("editor__copy_paste",{label:lbl,onlyPaste:!flashUnusable});this.$dispatch("track:menu-action","paste")}});window.require.register("/component/editor/tool/plagiarism/plagiarism.config.js",function(exports,module,require){module.exports={placement:"popup_editor_plagiarism",active:false,count:"",id:"Plagiarism",uuid:"plagiarism",name:"Plagiarism",description:"Finds unoriginal text by checking against<br>a database of over 8 billion web pages.",plus:"editor:plus-plagiarism"}});window.require.register("/component/editor/tool/plagiarism/plagiarism.js",function(exports,module,require){var data=require("/component/editor/tool/plagiarism/plagiarism.config"),plagiarismPercent=require("/component/editor/plagiarism-percent/plagiarism-percent"),common=require("/component/editor/tool/common/common"),user=require("/js/user");element=common.extend({data:data,methods:{calculatePlagiarism:function(text,matches){var count=plagiarismPercent(text,matches)||"";if(count){count+="%"}this.$set("count",count)},plagiarismActive:function(){return user.isInstitutionUser()&&user.$get("institutionPlagiarismDisabled")?false:this.active},hideElement:function(){this.$el&&(this.$el.style.display="none")}},created:function(){this.$on("plagiarsim:calculate-percent",this.calculatePlagiarism.bind(this));if(user.isInstitutionUser()&&user.$get("institutionPlagiarismDisabled"))this.hideElement()}});Vue.component("editor:tool-plagiarism",element);module.exports=element});window.require.register("/component/editor/tool/plus/plus.config.js",function(exports,module,require){module.exports={genres:{placement:"popup_editor_genre",header:"Specialty checking",description:"Get the most accurate and relevant corrections for your specific writing situation."},tool:{placement:"popup_editor_checks",bottom:true},plagiarism:{placement:"popup_editor_plagiarism",header:"Plagiarism checker",description:"Detect unoriginal text by&nbsp;checking against a&nbsp;database of&nbsp;over 8&nbsp;billion web pages."},proofit:{placement:"popup_editor_proofit",header:"Professional proofreading",description:"Get your document professionally <br />proofread in&nbsp;real time."},enhancement:{placement:"popup_editor_enhancement",header:"Vocabulary enhancement",description:"Provides vocabulary enhancement suggestions to&nbsp;diversify your writing."}}});window.require.register("/component/editor/tool/plus/plus.js",function(exports,module,require){var config=require("/component/editor/tool/plus/plus.config");var Plus=Vue.extend({template:Handlebars.partials.editor__tool_plus(),replace:true,data:{premiumMatches:null},methods:{goToUpgrade:function(){this.$emit("upgradeClicked")}},created:function(){var me=this;this.$on("set:premium-matches",function(number){me.$set("premiumMatches",number)})}});var PlusTool=Plus.extend({data:config.tool});var PlusGenre=Plus.extend({data:config.genres});var PlusPlagiarism=Plus.extend({data:config.plagiarism});var PlusProofit=Plus.extend({data:config.proofit});var PlusEnhancement=Plus.extend({data:config.enhancement});Vue.component("editor:plus-tool",PlusTool);Vue.component("editor:plus-genre",PlusGenre);Vue.component("editor:plus-plagiarism",PlusPlagiarism);Vue.component("editor:plus-proofit",PlusProofit);Vue.component("editor:plus-enhancement",PlusEnhancement)});window.require.register("/component/editor/tool/popup-button/popup-button.js",function(exports,module,require){module.exports=Vue.component("editor:popup-button",{template:Handlebars.partials.editor__popup_button(),replace:true,data:{favicon:"",label:""},methods:{close:function(){this.$emit("close")}}})});window.require.register("/component/editor/tool/proofit/proofit.config.js",function(exports,module,require){module.exports={active:false,count:0,id:"Proofit",name:"Professional proofreading",description:"A professional proofreader is ready to check your document right now.",nameD:"This text has already been<br>corrected by our proofreaders",descriptionD:"Please edit your text or start<br>a new document."}});window.require.register("/component/editor/tool/proofit/proofit.js",function(exports,module,require){var dialog=require("/component/common/dialog/dialog"),user=require("/js/user"),config=require("/js/config"),data=require("/component/editor/tool/proofit/proofit.config"),element=Vue.extend({template:Handlebars.partials.editor__tool_proofit(),replace:true,data:{loading:true,user:{},tool:data},methods:{proofread:function(){if(this.user.type=="Free"||this.history)return false;var me=this;me.$dispatch("editor-to-profit:show:plans")},load:function(saved){this.$set("history",saved)},hideElement:function(){this.$el&&(this.$el.style.display="none")}},attached:function(){var me=this;me.user=user.$data;me.$on("proofit:show:tool-panel",function(){me.show=true});me.$on("proofit:show:completed",function(){this.$set("history",true)})},partials:{send_proofread:Handlebars.partials.proofit_tool_button()}});Vue.component("editor:tool-proofit",element);module.exports=element});window.require.register("/component/editor/tool/tool/tool.js",function(exports,module,require){var dialog=require("/component/common/dialog/dialog"),user=require("/js/user"),config=require("/js/config"),timer,pathname=document.location.pathname.replace("/","");module.exports=Vue.component("editor:tool-panel",{template:Handlebars.partials.editor__tool(),replace:true,data:{popup:window.popupMode||pathname=="popup"||pathname=="popup2"||document.location.pathname.indexOf("popup2.html")!=-1,someactive:false,showProofit:true,isInstitution:false},methods:{load:function(config){var me=this;
me.$.apps&&me.$.apps.load(config.apps);me.$.enhancement&&me.$.enhancement.load(config.enhancement);me.$.plagiarism&&me.$.plagiarism.load(config.plagiarism);me.$.genres&&me.$.genres.load(config.genres);me.$.proofit&&me.$.proofit.load(config.proofit)},preventDefault:function(evt){evt.preventDefault();evt.stopPropagation()},getCurrentApp:function(){var me=this,apps=me.$.apps,enhancement=me.$.enhancement,plagiarism=me.$.plagiarism;return _.extend(apps&&apps.current(),enhancement&&enhancement.current(),plagiarism&&plagiarism.current())},getGenreTitle:function(){var me=this;var genres=me.$.genres;if(!genres||!genres.getTitle)return;return genres.getTitle()},updateApps:function(matches){var me=this,apps=me.$.apps,enhancement=me.$.enhancement;enhancement&&enhancement.update(matches);apps&&apps.update(matches)},plagiarismActive:function(){var plagiarism=this.$.plagiarism;return plagiarism&&plagiarism.plagiarismActive()},menuUpdate:function(status){this.$.menu.update(status)},setPremiumMatches:function(matches){this.$broadcast("set:premium-matches",matches)},calculatePlagiarism:function(text,matches){this.$broadcast("plagiarsim:calculate-percent",text,matches)},toggleAll:function(){this.$broadcast("checks:toogle-all")}},created:function(){this.$on("set:someactive",function(value){this.someactive=value});this.$set("showProofit",user.isProofitVisible());this.$set("isInstitution",user.isInstitutionUser())},attached:menuAim});function menuAim(){var opts={rowSelector:"> .editor__document_tools_item > div",exitMenu:exit,activate:activate,deactivate:deactivate};$(".editor__document_tools").menuAim(opts);$(".editor__tool_genres").menuAim(_.extend(opts,{rowSelector:"> div"}));$(".b-genre-container").menuAim(_.extend(opts,{rowSelector:" > div"}));function exit(){return true}function deactivate(row){if(timer)clearTimeout(timer);$(row).removeClass("hover");$(document.body).removeClass("gpu")}function activate(row){var $row=$(row);if($row.hasClass("delay-element"))return delayHover();if($row.hasClass("invisible-element"))return closeOnTimer(closeMenu);$row.addClass("hover");if($row.hasClass("b-genre-item")&&!$row.hasClass("active")){var genres=$row.children(".b-genre-items")[0];if(!genres)return;var rect=genres.getBoundingClientRect();if(rect.bottom>(window.innerHeight||document.documentElement.clientHeight)){$(genres).css({top:-(rect.bottom-(window.innerHeight||document.documentElement.clientHeight))})}}if($row.children(".editor__tool_proofit").length==0){$(document.body).addClass("gpu")}}function delayHover(){$(".b-genre").addClass("hover");closeOnTimer(closeGenreMenu)}}function closeOnTimer(cb){if(timer)clearTimeout(timer);timer=setTimeout(cb,400)}function closeGenreMenu(){$(".b-genre").removeClass("hover")}function closeMenu(){$(".editor__tool_checks").removeClass("hover")}});window.require.register("/component/editor/tour/tour.js",function(exports,module,require){module.exports=function(){var $window=$(window),$document=$(document),$container=$("body"),$footer,$header,$tourContainer,$overlay,$oneStepContainer;function showWelcomeScreen(){var user=require("/js/user"),storage=require("/js/local-storage"),userInfo=user.$data,settings=userInfo.settings;if(settings.seenWelcome||storage.get("seenWelcome"))return;var template,name=userInfo.name,isFreemium=userInfo.freemium,config=require("/js/config");if(isFreemium)return;template=user.isMigration()?Handlebars.partials.tour_old_user__container({name:name}):Handlebars.partials.tour_new_user__container({name:name});show(template,"generalTour")}function showWelcomeForLiteUsers(){isFromLite()&&show(Handlebars.partials.tour_lite_user__container(),"chromeExtensionTour")}function isFromLite(){if($.cookie("litemigrate")){$.removeCookie("litemigrate",{domain:".grammarly.com"});return true}return false}function show(template,tourType){$container.append(template);$tourContainer=$(".b-tour");$overlay=$tourContainer.find(".tour-finish");$oneStepContainer=$(".b-tour-step");$footer=$(".b-tour-footer");$header=$(".b-tour-header");bindEvents();$("#textarea").blur();trackTour(tourType,"systemFired")}function trackTour(tourType,generator){window.tracker.mixpanel.track("WE:Editor_Notification_Displayed",{messageType:tourType,messageGenerator:generator});window.tracker.gnar.send("editor/editorNotificationDisplayed",{messageType:tourType,messageGenerator:generator})}function onDocsEnter(){var user=require("/js/user"),storage=require("/js/local-storage"),userInfo=user.$data,settings=userInfo.settings,isFreemium=userInfo.freemium,name=userInfo.name;if(settings.seenWelcome||storage.get("seenWelcome")||user.isPhoenix())return;if(user.isMigration()&&!settings.seenSplash)return showSplashScreen();if(!isFreemium)return;var template=Handlebars.partials.tour_freemium_user__container({name:name});show(template,"freemiumTour")}function showSplashScreen(){var template=Handlebars.partials.welcome_tour(),$close;$container.append(template);$tourContainer=$(".b-tour");$close=$(".tour-finish",$tourContainer);trackTour("migrationTour","systemFired");$document.on("keyup",function(e){if(e.keyCode===27)hide()});$close.on("click",hide);function hide(){var user=require("/js/user");user.setSettings({seenSplash:true});unbind();$tourContainer.hide();$("#textarea").focus()}function unbind(){$close.off("click",hide);$document.off("keyup",closeOnEscButton)}}function hideTour(){var user=require("/js/user"),storage=require("/js/local-storage");user.setSettings({seenWelcome:true});storage.save("seenWelcome",true);removeHighlite();unBindEvents();$("#textarea").focus();$tourContainer.hide()}function bindEvents(){$footer.on("click",".tour-next",function(){showSlide("next")});$footer.on("click",".tour-back",function(){showSlide("previous")});$footer.on("click",".tour-close",hideTour);$header.on("click",".tour-close",hideTour);$overlay.on("click",hideTour);$window.on("resize",changePositionTour);$document.on("keyup",closeOnEscButton)}function unBindEvents(){$footer.off();$header.off();$overlay.off("click",hideTour);$window.off("resize",changePositionTour);$document.off("keyup",closeOnEscButton)}function addHighlite(){var $highLite=$("<div />",{addClass:"b-tour-menu-item-selected"});$container.append($highLite)}function removeHighlite(){var $highLite=$(".b-tour-menu-item-selected");if($highLite.length)$highLite.remove()}function getStepElementContainer(){return $(".b-tour-step.active")}function showSlide(whichSlideShow){var activeClassName="active",$activeSlide=$(".b-tour-step.active"),nextShowSlide=null,nextShowSlideNumber=null;nextShowSlide=whichSlideShow==="next"?$activeSlide.next(".b-tour-step"):$activeSlide.prev(".b-tour-step");if(!nextShowSlide.length){hideTour()}else{nextShowSlideNumber===5?addHighlite():removeHighlite();$activeSlide.removeClass(activeClassName);nextShowSlide.addClass(activeClassName);changePositionTour()}}function changePositionTour(){var $window=$(window),DEFAULT_TOP_VALUE=60,stepChangePosition=10,$oneStepContainer=getStepElementContainer(),topContainer=$oneStepContainer.offset().top,heightContainer=$oneStepContainer.outerHeight(),previousWindowHeight=changePositionTour.prev,currentWindowHeight=$window.height();if(topContainer+heightContainer>currentWindowHeight&&currentWindowHeight-previousWindowHeight<0){$oneStepContainer.css({top:topContainer-=DEFAULT_TOP_VALUE+stepChangePosition})}else if(currentWindowHeight-previousWindowHeight>0&&0>topContainer-DEFAULT_TOP_VALUE){$oneStepContainer.css({top:topContainer-=DEFAULT_TOP_VALUE-stepChangePosition})}changePositionTour.prev=currentWindowHeight}function closeOnEscButton(e){var ESC_CHARACTERS=27;if(e.keyCode===ESC_CHARACTERS)hideTour()}return{welcome:showWelcomeScreen,welcomeLite:showWelcomeForLiteUsers,onDocsEnter:onDocsEnter}}});window.require.register("/component/editor/tour/tutorial.js",function(exports,module,require){module.exports=function(){var $body=$("body"),dimensions={},ui={};function initialize(){showTutorial();setElements(ui,{menuWrapper:"menu-wrapper",menuItem:"navigation-items",tutorialStep:"tutorial-step",closeButton:"tutorial-close",tutorialLayout:"tutorial-layout",tutorialContainer:"tutorial-container",tutorialScrollBlock:"tutorial-scroll-block"});calculateRelativePosition();calculatePercentWhenSwitchMenu();bindEvents()}function setElements(elementsContainer,elementsMap){for(var element in elementsMap){elementsContainer["$"+element]=$("."+elementsMap[element])}}function showTutorial(){window.tracker.mixpanel.track("WE:Editor_Notification_Displayed",{messageType:"tutorial",messageGenerator:"userRequested"});window.tracker.gnar.send("editor/editorNotificationDisplayed",{messageType:"tutorial",messageGenerator:"userRequested"});$body.append(Handlebars.partials.tutorial_container)}function bindEvents(params){var trotHandleScrollContainer=_.throttle(handleScrollContainer,100);$(document).on("keyup",handleEsc);$(".tutorial-finish").on("click",handleCloseClick);if(params==="scroll"){ui.$tutorialScrollBlock.on("scroll",trotHandleScrollContainer)}else{ui.$closeButton.on("click",handleCloseClick);ui.$menuItem.on("click",handleMenuItemClick);ui.$tutorialScrollBlock.on("scroll",trotHandleScrollContainer)}}function unbindEvents(params){$(document).off("keyup",handleEsc);$(".tutorial-finish").off("click",handleCloseClick);if(params==="scroll"){ui.$tutorialScrollBlock.off("scroll")}else{ui.$closeButton.off("click");ui.$menuItem.off("click");ui.$tutorialScrollBlock.off("scroll")}}function handleEsc(e){if(e.keyCode===27)handleCloseClick()}function calculateRelativePosition(){var _percentCommon=0,stepHeight,containerHeightWithMargin,containerHeight;containerHeightWithMargin=ui.$tutorialScrollBlock[0].scrollHeight;containerHeight=containerHeightWithMargin-ui.$tutorialScrollBlock.outerHeight(true);dimensions.containerHeightWithMargin=containerHeightWithMargin;dimensions.containerHeight=containerHeight;dimensions.elementBottomPercent=[];ui.$tutorialStep.each(function(number){stepHeight=$(this).outerHeight(true);_percentCommon+=parseFloat((stepHeight/containerHeightWithMargin).toFixed(3))*100;dimensions.elementBottomPercent.push(_percentCommon);dimensions[number]=$(this)})}function calculatePercentWhenSwitchMenu(){var percentOfBlockWhenItShouldBeActive=1/2;var calculationResult;dimensions.percentWhenSwitch=[];dimensions.elementBottomPercent.map(function(element,index,array){if(index==0){calculationResult=element*2/3}else{calculationResult=array[index-1]+(element-array[index-1])*percentOfBlockWhenItShouldBeActive}dimensions.percentWhenSwitch[index]=Math.abs(calculationResult)})}function handleScrollContainer(e){var percentScroll=e.target.scrollTop/dimensions.containerHeightWithMargin*100;var currentElement;var slideName;dimensions.percentWhenSwitch.map(function(element,index){if(percentScroll<element&&!currentElement){currentElement=dimensions[index]}});slideName=currentElement.data("slide");switchActiveElement(slideName)}function switchActiveElement(slideName){var activeClassName="active";if(switchActiveElement.previosSlideName==slideName)return;ui.$menuItem.removeClass(activeClassName);ui.$tutorialStep.removeClass(activeClassName);ui.$menuWrapper.find("[data-slide="+slideName+"]").addClass(activeClassName);ui.$tutorialScrollBlock.find("[data-slide="+slideName+"]").addClass(activeClassName);switchActiveElement.previosSlideName=slideName}function handleMenuItemClick(e){var $clickedMenuItem=$(e.target),slideName,activeClass="active";if($clickedMenuItem.hasClass(activeClass))return;slideName=$clickedMenuItem.data("slide");switchActiveElement(slideName);scrollToElement(slideName)}function handleCloseClick(){hideTutorial();unbindEvents("all")}function removeTutorial(){ui.$tutorialLayout.remove()}function hideTutorial(){ui.$tutorialLayout.on("transitionend webkitTransitionEnd",removeTutorial);ui.$tutorialLayout.css("opacity","0")}function scrollToElement(slideName){var $currentSlide=ui.$tutorialScrollBlock.find('[data-slide="'+slideName+'"]');var index=$currentSlide.index();var paddingTop=60;var topPosition=dimensions.containerHeightWithMargin*dimensions.elementBottomPercent[index]/100;var elementHeight=$currentSlide.outerHeight(true);var calculateTopPosition=topPosition-elementHeight-paddingTop;unbindEvents("scroll");ui.$tutorialScrollBlock.stop().animate({scrollTop:calculateTopPosition},1e3,function(){setTimeout(function(){bindEvents("scroll")},0)})}return{init:initialize}}});window.require.register("/component/editor/upgrade-learn-more/upgrade-learn-more.js",function(exports,module,require){module.exports=Vue.component("editor:upgrade-learn-more",{template:Handlebars.partials.editor__upgrade_learn_more_popup(),data:{features:[{text:"150 critical grammar and spelling checks",free:true},{text:"100+ additional advanced checks"},{text:"Vocabulary enhancement suggestions"},{text:"Genre-specific writing style checks"},{text:"Sophisticated plagiarism detector"}]},replace:true})});window.require.register("/component/page/apps/apps.js",function(exports,module,require){var me,user=require("/js/user"),formDefaults={data:{},show:false,invalid:[],style:{}},notification=require("/component/editor/notification/notification");Vue.component("editor__apps",{template:Handlebars.partials.editor__apps(),data:{user:{}},attached:function(){me=this;me.user=user.$data;me.$dispatch("subview-load-start");me.$dispatch("subview-load-end");me.$dispatch("track:go-to-apps");document.title="Grammarly Apps"},methods:{showDialog:function(e){var el=$(e.target),pos=el.position(),data=this.form;data.show=true;data.style={position:"absolute",top:parseInt(pos.top-25)+"px",left:parseInt(pos.left-30)+"px"}}}})});window.require.register("/component/page/docs/docs.js",function(exports,module,require){var me,documents,documentItems,app,api,docsLength,SEARCH_LOCAL_WHEN_DOCS_COUNT=100,localSearchMode,timeout,user;var user=require("/js/user"),_docs=require("/js/docs"),route=require("/js/route"),notification=require("/component/editor/notification/notification"),banner=require("/component/editor/banner/banner.controller");function setDateBreaks(docs){var now=new Date;now.setHours(0);now.setMinutes(0);now.setSeconds(0);var yesterday=+now,msInDay=24*60*60*1e3,today=yesterday+msInDay,earlier=yesterday-msInDay,todayDone,yesterdayDone,earlierDone;for(var i=0;i<docs.length;i++){var doc=docs[i],date=+new Date(doc.updated_at);if(doc.removed)continue;if(date<today&&date>yesterday&&!todayDone){todayDone=true;doc.cls="today";continue}if(date<yesterday&&date>earlier&&!yesterdayDone){yesterdayDone=true;doc.cls="yesterday";continue}if(date<earlier&&!earlierDone){earlierDone=true;doc.cls="earlier"}if(todayDone&&yesterdayDone&&earlierDone)break}}function filterEmpty(docs){if(!docs&&docs.length)return[];return docs.filter(function(doc){return doc.title||doc.first_content})}function correctTitles(docs){for(var i=0,l=docs.length;i<l;i++){if(!docs[i].title&&docs[i].first_content){docs[i].title=_docs.titleFromContent(docs[i].first_content)}}}function getOldEditorText(){var migration=user.isMigration()||{};return migration.oldText}function addDoc(text){var user=require("/js/user"),userInfo=user.$data,settings=userInfo.settings,justMigrated=!settings.migrationTextSet,doc;if(userInfo.experiment&&userInfo.experiment.migration){delete userInfo.experiment.migration.oldText}text=$("<div>").html(text).text();doc={content:text};if(justMigrated){doc.mongodb={migrationDocument:true}}user.setSettings({migrationTextSet:true});_docs.save(doc).then(loadDocuments)}function addDemoDoc(docs){if(user.isSampleRemoved())return;for(var i=0;i<docs.length;i++){if(docs[i].settings.sample)return}if(localSearchMode){DemoDoc.first_content=DemoDoc.content;if(me.query&&!matchDoc(DemoDoc,me.query))return;docs.push(DemoDoc)}}function processDocuments(docs){correctTitles(docs);setDateBreaks(docs);_docs.loadSettings(docs);addDemoDoc(docs);return docs}function loadDocuments(){api=app.docsApi;me.$dispatch("subview-load-start");api.search().success(function(docs){docs=filterEmpty(docs);documents=docs;docsLength=docs.length;localSearchMode=docsLength<SEARCH_LOCAL_WHEN_DOCS_COUNT;me.documents=processDocuments(docs);me.$dispatch("subview-load-end","documents")}).fail(function(e){console.error(e);route.toError()})}function serverSearch(){api.search({search:encodeURIComponent(me.query)}).success(function(docs){me.searching=false;timeout=null;me.documents=processDocuments(docs)})}function search(str){str=str.toLowerCase().trim();me.query=str;if(!localSearchMode){me.searching=true;timeout&&clearTimeout(timeout);timeout=setTimeout(serverSearch,500);return}me.documents=documents.filter(function(doc){return matchDoc(doc,str)})}function matchDoc(doc,str){return~doc.title.toLowerCase().indexOf(str)||~doc.first_content.toLowerCase().indexOf(str)}function download(doc){_docs.download(doc.id,doc.title);this.$dispatch("track:document-download",this.errors)}function downloadProofread(doc){this.$dispatch("track:proofread-document-download");location.href=doc.settings.proofit.downloadResultUrl}function remove(doc){doc.removed=true;var profileApi={set:function(){}};setDateBreaks(documentItems);if(doc.settings.sample||doc.id==0){user.setSettings({sample:"removed"});doc.id&&api.remove(doc);undo=function(){doc.removed=false;notification.hide();user.setSettings({sample:"show"});doc.id&&api.restore(doc)}}else{api.remove(doc);undo=function(){doc.removed=false;notification.hide();api.restore(doc)}}var title=doc.title?"“"+doc.title+"”":"Document";notification.show("message_doc_deleted",title);$(".undo-delete").one("click",function(e){e.stopPropagation();undo();setDateBreaks(documentItems)})}function upload(e){_docs.uploadWithProgress({event:e,context:me,onsuccess:trackUploadAccepted,onerror:trackUploadRejected})}function trackUploadRejected(errorKey){me.$dispatch("track:document-upload-rejected",errorKey)}function trackUploadAccepted(){me.$dispatch("track:document-upload-accepted")}function drop(cfg){var _old=cfg.onsuccess;cfg.onsuccess=function(doc){_old&&_old(doc);trackUploadAccepted()};cfg.onerror=trackUploadRejected;_docs.upload(cfg)}function createDemo(doc){_docs.save({content:doc.content,title:doc.title,mongodb:{sample:true}}).then(function(doc){doc.matches=DemoDoc.matches;app.toDocument(doc)})}function documentProofreading(document){this.$broadcast("proofit:open-proofreading-document",document)}function create(){_docs.newDoc()}Vue.component("editor__docs",{template:Handlebars.partials.editor__docs(),data:{documents:[],searching:false,uploading:false},created:function(){var text=getOldEditorText();me=this;app=app||require("/js/app");if(text)addDoc(text);else loadDocuments();documentItems=[];module.exports=me;me.$on("createdItem",this.createdItem);me.$on("proofit:open-proofreading-document",this.documentProofreading)},attached:function(){me.$dispatch("track:docs-created");me.$on("proofread:status:completed",function(id,settings){me.$broadcast("document-item:status:change",id,settings)});me.$on("proofread:status:building",function(id,settings){me.$broadcast("document-item:status:change",id,settings)});me.$on("proofread:status:cancelled",function(id,settings){me.$broadcast("document-item:status:change",id,settings);me.$broadcast("proofit:show:cancelled",id,settings)});me.$dispatch("track:documents");banner.init();banner.show();document.title="Grammarly"},detached:function(){banner.destroy()},methods:{documentProofreading:documentProofreading,download:download,downloadProofread:downloadProofread,upload:upload,ondrop:drop,create:create,remove:remove,search:search,createDemo:createDemo,createdItem:function(docItem){documentItems.push(docItem)}}})});window.require.register("/component/page/editor/editor.js",function(exports,module,require){var app,me,doc,editor,cards,status,prevMatches,cardsBg,tools;var textareaClient=require("/js/textarea-client"),docs=require("/js/docs"),Report=require("../../editor/report/report"),report={close:_f},user=require("/js/user"),detect=require("/detect/detect"),storage=require("/js/local-storage"),persistenceMonitor=require("/js/persistence-monitor"),firstCheckTracked=false;Vue.component("editor__editor",{template:Handlebars.partials.editor__editor(),data:{$document:{},title:"",showInitialMenu:false,uploading:false,showProgress:true,proVersion:false,user:{},newUnderline:false,premiumUnderlineYellow:false},attached:function(){me=this;app=app||require("/js/app");app.loading();setTimeout(initEditor,0);trackEditorApp()},methods:{isDocumentProofreading:isDocumentProofreading,saveDoc:saveDoc,selectedMatch:selectedMatch,deselectedMatch:deselectedMatch,rendered:rendered,plagiarismChecked:plagiarismChecked,serviceState:serviceState,serverRemove:trackServerRemove,onTracking:onTracking,onCapiError:onCapiError,fix:fix,undo:undo,createDoc:createDoc,downloadDoc:downloadDoc,uploadDoc:uploadDoc,ondrop:drop,genreChanged:genreChanged,appToggled:appToggled,hookClicked:hookClicked,sending:sending,finish:finish,replaceSyn:replaceSyn,removeSyn:removeSyn,undoSyn:undoSyn,showReport:showReport,closeDialog:closeDialog},beforeDestroy:closeEditor});var ot_handleChange=track.bind(me,"track:docs-ot-change"),ot_send=track.bind(me,"track:docs-ot-send"),trackClose=track.bind(me,"track:document-close"),trackOpen=track.bind(me,"track:document-open"),trackServiceState=track.bind(me,"track:service-state"),trackCapiError=track.bind(me,"track:capi-error"),trackDocCheck=track.bind(me,"track:document-check"),trackSessionFinished=track.bind(me,"track:document-session-finished"),trackDocumentCopied=track.bind(me,"track:document-copied"),trackDocumentPaste=track.bind(me,"track:document-paste"),trackDownloadDoc=track.bind(me,"track:document-download"),trackUploadAccepted=track.bind(me,"track:document-upload-accepted"),trackUploadRejected=track.bind(me,"track:document-upload-rejected"),trackEditorApp=track.bind(me,"track:editor-app"),trackAppToggled=track.bind(me,"track:document-app-toggled"),trackGenre=track.bind(me,"track:document-genre-changed"),trackReportOpen=track.bind(me,"track:report-open");var revokeMonitor;function track(name,value){me.$dispatch(name,value)}var lazyUpdateInterface=_.throttle(updateInterface,100),lazyLayout=_.debounce(onResize,200),lazyScroll=_.debounce(onScroll,200),lazyUpdateHeight=_.throttle(updateHeight,1e3),lazySendErrors=_.throttle(sendErrors,1e3);var $w=$(window);function initEditor(){me.$watch("title",changedTitle);app.getDocument().done(function(_doc){me.isDocumentProofreading(_doc);docs.loadMatches(_doc);doc=_doc;me.title=doc.title;setDocTitle(doc.title);me.showInitialMenu=doc.content||doc.title?false:true;me.proVersion=user.isPremiumUser();me.user=user.$data;var underlines=user.getUnderlineType();me.newUnderline=underlines.newUnderline;me.premiumUnderlineYellow=underlines.premiumUnderlineYellow;if(!me.$.ddUpload)return;me.$.progressbar=me.$.ddUpload.$.progressbar;me.$.ddUpload.showProgress=true;cards=me.$.cards;editor=app.$.editor=me.$.editor;status=me.$.status;tools=me.$.tool_panel;var apps=doc.settings.apps;var plagiarism=!localStorage.initialPlagiarismSet&&doc.settings.apps||false;tools.load({apps:apps,enhancement:apps,plagiarism:plagiarism,genres:doc.settings.genre,proofit:doc.settings.proofit});if(apps&&apps.Plagiarism&&apps.Plagiarism.active){storage.save("initialPlagiarismSet",true)}tools.menuUpdate(me.showInitialMenu);firstCheckTracked=false;docs.fixTabs(doc);cardsBg=$(".error-container, .error-list");textareaClient.create($(editor.$el),doc.id);textareaClient.on("ot",onOt);textareaClient.on("serviceState",serviceState);textareaClient.on("socketReconnect",updateDoc);textareaClient.on("handleChange",ot_handleChange);textareaClient.on("send",ot_send);revokeMonitor=persistenceMonitor.watch(textareaClient,app);editor.create({doc:doc,apps:tools});trackOpen(doc);module.exports=me;updateInterface();app.loaded()});$(document).on("copy",handleCopy);$(document).on("paste",handlePaste);if(detect.browser!="ie"){$("#editor, .error-panel").click(focusTextarea)}$(window).resize(lazyLayout);$(".main-scroller").scroll(lazyScroll);me.$broadcast("proofit:show:tool-panel");me.$on("proofread:status:building",function(id,settings){me.$broadcast("proofit:show:success",id,settings)});me.$on("editor-to-profit:show:plans",function(id,settings){window.tracker.mixpanel.track("PROOF:Main_Dialog_Displayed");me.$broadcast("proofit:show:plans",id,settings)});me.$on("proofread:status:completed",function(id,settings){me.$broadcast("proofit:show:completed",id,settings)});me.$on("proofread:status:cancelled",function(id,settings){if(doc.id==id)me.$broadcast("proofit:show:cancelled",id,settings)});me.$on("proofit:document:changed",function(id,doc){docs.saveSettings(doc,{proofit:null});tools.load({proofit:doc.settings.proofit})});app.__editor=me}function onOt(text){editor.setText(text);editor.render()}function closeEditor(){sendErrors();textareaClient.release();textareaClient.un&&textareaClient.un("handleChange",ot_handleChange);textareaClient.un&&textareaClient.un("send",ot_send);revokeMonitor&&revokeMonitor();$(document).off("copy",handleCopy);$(document).off("paste",handlePaste);$(window).off("resize",lazyLayout);$("#editor, .error-panel").off("click",focusTextarea);$(".main-scroller").off("scroll",lazyScroll);cards&&cards.close();report.close();editor&&editor.exit();trackClose();trackSessionFinished();if(!app.documentWasLoaded)app.route.toIndexHard();app.documentWasLoaded=false}function focusTextarea(e){if($(e.target).is("input,a,select,button,.b-card *,.error-list,.error-panel"))return;$("textarea").focus()}function isDocumentProofreading(doc){var proofit=doc.settings&&doc.settings.proofit;if(!proofit||proofit.status!="Building")return;this.$broadcast("proofit:open-proofreading-document",doc)}function uploadDoc(e){docs.upload({event:e,onsuccess:function(doc){trackUploadAccepted();app.toDocument(doc)},onerror:trackUploadRejected})}function drop(cfg){docs.upload(cfg)}function downloadDoc(){trackDownloadDoc();docs.download(doc.id,doc.title)}function createDoc(){docs.newDoc()}function updateDoc(){saveDoc(editor.getText())}function saveDoc(value){doc.content=value;textareaClient.save(value)}function genreChanged(data){trackGenre(data.id);docs.saveSettings(doc,{genre:data.id});editor.hardReset();tools.plagiarismActive()&&editor.checkPlagiarism()}function setDocTitle(title){document.title=title||"Grammarly"}function hookClicked(placement){track("track:hook-clicked",{matches:editor.getMatches(),placement:placement})}function appToggled(app){cards.removeUndo();trackAppToggled(app);var _matches=editor.getMatches();_matches.forEach(function(m){if(m.selected)delete m.selected});editor.render();if(app.id=="Plagiarism"&&app.active){editor.checkPlagiarism();tools.calculatePlagiarism(editor.getText(),_matches);!localStorage.initialPlagiarismSet&&storage.save("initialPlagiarismSet",true)}docs.saveSettings(doc,{apps:tools.getCurrentApp()});onScroll()}function changedTitle(title){setDocTitle(title);doc.title=title;showMenu();docs.saveTitle(doc)}function excludeReplaced(matches){return matches.filter(function(m){return!m.replaced})}function sendErrors(){if(!editor)return;var matchesToSave=excludeReplaced(editor.getMatches());var count=editor.getFiltered().filter(function(item){return item.group!="Plagiarism"}).length;docs.saveErrors(doc,matchesToSave,count)}function selectedMatch(match){if($(match.getEl()).css("visibility")=="hidden")return;if(match.replaced)return;cards.select(match,true)}function deselectedMatch(match){cards.deselect(match);cards.removeUndo()}function undoSyn(match){cards.toggleExpand(match.card,true)}function removeSyn(match){cards.deselect(match);if(!match.card)return;match.card.remove();delete match.card}function replaceSyn(){editor.synonyms.removeUnderline()}function rendered(){lazyUpdateInterface();lazySendErrors()}function fix(){status.incFixed();window.GR_EXTENSION_SEND&&window.GR_EXTENSION_SEND("editor-fix")}function onTracking(data){me.$dispatch("tracking",data)}function onCapiError(data){trackCapiError(data)}function serviceState(data){trackServiceState(data)}function trackServerRemove(match){onTracking({event:"matchRemovedByServer",matches:match})}function plagiarismChecked(){status.unhighlight()}function undo(){status.decFixed()}function sending(){status.highlight()}function finish(){status.unhighlight();sendErrors();updateInterface();trackDocCheck({doc:doc,initial:!firstCheckTracked,apps:tools.getCurrentApp(),genre:tools.getGenreTitle()});firstCheckTracked=true}function onResize(){lazyUpdateHeight();var _matches=editor.getMatches();cards.updateDimensions(_matches);updateInterface()}function onScroll(){editor.generateMatchPositions();updateInterface()}function getHidden(){var matches=editor.getMatches();return _.filter(matches,function(m){return m.hidden})}function showMenu(){if(!me.showInitialMenu)return;if(!editor.getText()&&!me.title)return;me.showInitialMenu=false;tools.menuUpdate(me.showInitialMenu)}function updateInterface(){var _matches=editor.getFiltered(),_hiddenMatches=getHidden(),removed=_.difference(prevMatches,_matches),added=_.difference(_matches,prevMatches),text=editor.getText();showMenu();status.update({text:text,matches:_matches,hiddenMatches:_hiddenMatches,genre:tools.getGenreTitle()});tools.updateApps(_matches);tools.setPremiumMatches(_hiddenMatches.length);tools.calculatePlagiarism(text,_matches);editor.generateMatchPositions();cards.render(_matches,added,removed);prevMatches=_.clone(_matches);if(added.length)onTracking({event:"matchVisible",matches:added});if(removed.length)onTracking({event:"matchRemoved",matches:removed})}function updateHeight(){var wH=$w.height();var gH=editor.dom.cloneVal.clientHeight;var height=wH>gH?wH:gH+140;cardsBg.css("height",height);editor.updateTextareaHeight()}function showReport(){cards.collapse();report=Report({matches:editor.getFiltered(),title:doc.title,text:editor.getText(),userName:user.$get("name"),user:user.$data,apps:tools.getCurrentApp(),track:track});trackReportOpen(report.score)}function handleCopy(){var text=editor.getText(),el=editor.el,selText;if(typeof el.selectionStart=="undefined")return;var start=el.selectionStart,end=el.selectionEnd;selText=el.value.substring(start,end)||"";if(text.length>1e3&&selText.length>.9*text.length){firstCheckTracked=false;trackDocumentCopied();trackSessionFinished()}}function handlePaste(e){var text=(e.originalEvent||e).clipboardData.getData("text/plain");if(text&&text.length>100){trackDocumentPaste()}}function closeDialog(vm){vm.show=false}});window.require.register("/component/page/error/error.js",function(exports,module,require){var app=require("/js/app");module.exports=function(){["404","500"].forEach(function(name){Vue.template("editor__error_"+name)})}()});window.require.register("/component/page/free/free.js",function(exports,module,require){var config=require("/js/config"),user=require("/js/user");Vue.component("editor__free",{template:Handlebars.partials.editor__free(),attached:function(){this.name=user.$get("name");$(this.$el).find(".js-subscription").attr("href",config.FUNNEL.SUBSCRIBE)},methods:{logout:function(){user.logout()},logoClick:function(e){e.preventDefault();document.location=document.location.origin}}})});window.require.register("/component/page/index/index.js",function(exports,module,require){var me,startLoad,finishLoad,model=Vue.extend({template:Handlebars.partials.editor__index(),data:{subLoading:false},created:function(){me=this;me.$on("subview-load-start",loading);me.$on("subview-load-end",loaded)},beforeDestroy:function(){me.$off("subview-load-start",loading);me.$off("subview-load-end",loaded)}});Vue.component("editor__index",model);module.exports=model;function loaded(subview){me.subLoading=false;finishLoad=Date.now();me.$dispatch("track:subview-loaded",finishLoad-startLoad,subview)}function loading(){me.subLoading=true;startLoad=Date.now()}});window.require.register("/component/page/popup/popup-integration.js",function(exports,module,require){var editorId,scrollEl,socket,unprocessedMsg,editor,popupButton,parentObject,isText=false,$body=$(document.body);isOpenened=false;window.addEventListener("message",onMessage,false);$body.on("keydown",onkey);var port=emitter({send:send});
var isIframe=window.top!=window;if(!isIframe)activateTracking();function onhide(){parentObject.$.cards.removeUndo();editor.synonyms.removeUnderline();socket.deactivate();sendText()}function onkey(e){if(e.keyCode!=27)return;if($(".b-card.expand",document.body).length)return;sendClose()}function sendClose(){console.log("sending close to plugin");send({action:"close"})}function track(name,value){parentObject.$dispatch(name,value)}function trackOpen(data){track("track:popup-opened",data)}function trackClose(data){track("track:popup-opened",data)}function activateTracking(){if(!isOpenened){isOpenened=true;tracking=require("/js/tracking/tracking-popup");tracking.init();tracking.onlogin(require("/js/app"))}}function onMessage(e){if(!e.data.grammarly)return;if(!editor){unprocessedMsg=e;return}var data=e.data;send({action:"accepted"});activateTracking();if(data.action=="enable_menu"){items.css("display","");return}if(data.action=="hide"){return onhide()}if(isImmutableObject(data))data=_.cloneDeep(data);if(data.action=="socket"){return port.emit("message",data)}if(data.action=="destroy"){parentObject.closeEditor()}scrollEl.scrollTop=0;if(data.html==undefined&&data.text==undefined)return;isText=data.text!=undefined;socket.activate(port,data.socketId);trackOpen(data);data=processData(data);editor.setState(data);popupButton.favicon=data.favicon;popupButton.label=data.page;if(data.selectedMatchId){var m=editor.matches.byId(data.selectedMatchId);if(m){m.select();m.selectCard=true}}if(data.editorId&&data.editorId!=editorId){editorId=data.editorId;send({action:"acceptedEditorId",editorId:editorId})}}function processData(data){if(!data.matches||!data.matches.length||data.matches.rHtml)return data;for(var i=0;i<data.matches.length;i++){var match=data.matches[i];if(!match.r||match.rHtml)continue;match.rHtml=[];for(var j=0;j<match.r.length;j++){match.rHtml.push({label:match.r[j],value:match.r[j]})}data.matches[i]=match}return data}function send(data){data.editorId=editorId;data.grammarly=true;window.top.postMessage(data,"*")}function setEditor(_parentObject,userType){parentObject=_parentObject;editor=parentObject.$.editor;popupButton=parentObject.$.tool_panel.$.popupButton;popupButton.$on("close",sendClose);send({action:"initialized",userType:userType});scrollEl=$(".main-scroller")[0];socket=editor.api.ws;if(unprocessedMsg){var msg=unprocessedMsg;unprocessedMsg=null;onMessage(msg)}}function sendText(){var data=editor.getState(isText);data.action="edit";trackClose(data);send(data)}function incFixed(){send({action:"popup-editor-fix"})}function isFF(){return window.navigator.userAgent.indexOf("Firefox")!==-1}function isImmutableObject(obj){if(typeof obj!=="object")return false;if(!isFF())return false;var __testProp=obj.__testProp,_f=function(){return 1};try{obj.__testProp=_f;if(obj.__testProp===_f){obj.__testProp=__testProp;return false}}catch(e){}return true}exports.port=port;exports.setEditor=setEditor;exports.incFixed=incFixed});window.require.register("/component/page/popup/popup-socket.js",function(exports,module,require){module.exports=function(config){if(window.top==window)return createWs(config);var socketId,port,methods=["connect","send","close","reconnect","release","wsPause","wsPlay"],activated=false;var me=emitter({activate:activate,deactivate:deactivate});window.addEventListener("beforeunload",deactivate);for(var i=0;i<methods.length;i++){var m=methods[i];me[m]=send.bind(null,m)}return me;function send(method,arg){if(!socketId||!port)return;port.send({action:"socket",socketId:socketId,method:method,arg:arg})}function activate(_port,_socketId){socketId=_socketId;port=_port;if(!activated){port.on("message",onMessage);activated=true}}function deactivate(){}function onMessage(data,sender){me.emit(data.event,data.msg)}}});window.require.register("/component/page/popup/popup.js",function(exports,module,require){var app,me,editor,cards,status,prevMatches,cardsBg,tools;var config=require("/js/config"),user=require("/js/user"),integration=require("popup-integration"),PopupSocket=require("popup-socket");Vue.component("editor__popup",{template:Handlebars.partials.editor__popup(),data:{$document:{},title:"",showInitialMenu:false,uploading:false,showProgress:true,proVersion:false,user:{},newUnderline:false,premiumUnderlineYellow:false},attached:function(){me=this;app=app||require("/js/app");app.isPopup=true;setTimeout(initEditor,0);trackEditorApp()},methods:{selectedMatch:selectedMatch,deselectedMatch:deselectedMatch,rendered:rendered,plagiarismChecked:plagiarismChecked,fix:fix,undo:undo,ignore:ignore,appToggled:appToggled,hookClicked:hookClicked,sending:sending,genreChanged:genreChanged,replaceSyn:replaceSyn,removeSyn:removeSyn,undoSyn:undoSyn,finish:finish,closeEditor:closeEditor},beforeDestroy:closeEditor});var trackClose=track.bind(me,"track:document-close"),trackOpen=track.bind(me,"track:document-open"),trackAlertShown=track.bind(me,"track:document-alert-shown"),trackAlertFixed=track.bind(me,"track:document-alert-fixed"),trackAlertUndo=track.bind(me,"track:document-alert-undo"),trackAlertIgnored=track.bind(me,"track:document-alert-ignored"),trackAlertRemoved=track.bind(me,"track:document-alert-removed"),trackEditorApp=track.bind(me,"track:editor-app"),trackAppToggled=track.bind(me,"track:document-app-toggled"),trackGenre=track.bind(me,"track:document-genre-changed");function track(name,value){me.$dispatch(name,value)}var lazyUpdateInterface=_.throttle(updateInterface,100),lazyLayout=_.debounce(onResize,200),lazyScroll=_.debounce(onScroll,200),lazyUpdateHeight=_.throttle(updateHeight,1e3);var $w=$(window);function initEditor(){me.proVersion=user.isPremiumUser();me.user=user.$data;var underlines=user.getUnderlineType();me.newUnderline=underlines.newUnderline;me.premiumUnderlineYellow=underlines.premiumUnderlineYellow;cards=me.$.cards;editor=me.$.editor;status=me.$.status;tools=me.$.tool_panel;cardsBg=$(".error-container, .error-list");if(me.proVersion){tools.$.enhancement.active=true}me.doc={settings:{}};editor.create({apps:tools,type:"contenteditable",socket:PopupSocket,doc:me.doc,created:function(){module.exports=me;updateInterface();app.loaded();$(window).resize(lazyLayout);$(".main-scroller").scroll(lazyScroll);app.__editor=me;var userType=me.user&&me.user.type||"";integration.setEditor(me,userType)}})}function closeEditor(){$(window).off("resize",lazyLayout);$(".main-scroller").off("scroll",lazyScroll);cards.close();editor.exit()}function hookClicked(placement){track("track:hook-clicked",{matches:editor.getMatches(),placement:placement})}function appToggled(app){var _matches=editor.getMatches();_matches.forEach(function(m){if(m.selected)delete m.selected});editor.render();if(app.id=="Plagiarism"&&app.active)editor.checkPlagiarism();onScroll();trackAppToggled(app)}function selectedMatch(match){if($(match.getEl()).css("visibility")=="hidden")return;if(match.replaced)return;if(window.event&&window.event.type=="click"){window.event.stopPropagation()}cards.select(match,true)}function undoSyn(match){cards.toggleExpand(match.card,true)}function replaceSyn(match){editor.synonyms.removeUnderline()}function removeSyn(match){cards.deselect(match);if(!match.card)return;match.card.remove();delete match.card}function deselectedMatch(match){cards.deselect(match);cards.removeUndo()}function rendered(){lazyUpdateInterface()}function fix(){status.incFixed();integration.incFixed();trackAlertFixed()}function ignore(){trackAlertIgnored()}function plagiarismChecked(){status.unhighlight()}function undo(){status.decFixed();trackAlertUndo()}function sending(){status.highlight()}function finish(msg){status.unhighlight();updateInterface()}function onResize(){lazyUpdateHeight();var _matches=editor.getMatches();cards.updateDimensions(_matches);updateInterface()}function onScroll(){editor.generateMatchPositions();updateInterface()}function getHidden(){var matches=editor.getMatches();return _.filter(matches,function(m){return m.hidden})}function genreChanged(data){trackGenre({id:data.id});me.doc.settings.genre=data.id;editor.hardReset()}function updateInterface(){var _matches=editor.getFiltered(),_hiddenMatches=getHidden(),removed=_.difference(prevMatches,_matches),added=_.difference(_matches,prevMatches),text=editor.getText();status.update({text:text,matches:_matches,hiddenMatches:_hiddenMatches});tools.updateApps(_matches);tools.setPremiumMatches(_hiddenMatches.length);tools.calculatePlagiarism(text,_matches);editor.generateMatchPositions();cards.render(_matches,added,removed);prevMatches=_.clone(_matches);if(added.length)trackAlertShown(added.length);if(removed.length)trackAlertRemoved(removed.length)}function updateHeight(){var wH=$w.height();var gH=editor.el.clientHeight;var height=wH>gH?wH:gH+140;cardsBg.css("height",height)}});window.require.register("/component/page/popup2/popup-integration2.js",function(exports,module,require){var editorId,scrollEl,socket,unprocessedMsg,editor,popupButton;isText=false,parent,$body=$(document.body);addEventListener("message",onMessage,false);$body.on("keydown",onkey);var port=emitter({send:send});function onhide(){parent.$.cards.removeUndo();editor.synonyms.removeUnderline();socket.deactivate();sendText()}function onkey(e){if(e.keyCode!=27)return;if($(".b-card.expand",document.body).length)return;sendClose()}function sendClose(){console.log("sending close to plugin");send({action:"close"})}function track(name,value){parent.$dispatch(name,value)}function trackOpen(data){track("track:popup-opened",data)}function trackClose(data){track("track:popup-opened",data)}function onMessage(e){if(!e.data.grammarly)return;if(!editor){unprocessedMsg=e;return}var data=e.data;send({action:"accepted"});if(data.action=="enable_menu"){items.css("display","");return}if(data.action=="hide"){return onhide()}if(data.action=="socket"){return port.emit("message",data)}scrollEl.scrollTop=0;if(data.html==undefined&&data.text==undefined)return;isText=data.text!=undefined;socket.activate(port,data.socketId);trackOpen(data);data=processData(data);editor.setState(data);popupButton.favicon=data.favicon;popupButton.label=data.page;if(data.selectedMatchId){var m=editor.matches.byId(data.selectedMatchId);if(m){m.select();m.selectCard=true}}if(data.editorId&&data.editorId!=editorId){editorId=data.editorId;send({action:"acceptedEditorId",editorId:editorId})}}function processData(data){if(!data.matches||!data.matches.length||data.matches.rHtml)return data;for(var i=0;i<data.matches.length;i++){var match=data.matches[i];if(!match.r||match.rHtml)continue;match.rHtml=[];for(var j=0;j<match.r.length;j++){match.rHtml.push({label:match.r[j],value:match.r[j]})}data.matches[i]=match}return data}function send(data){data.editorId=editorId;window.top.postMessage(data,"*")}function setEditor(_parent,userType){parent=_parent;editor=parent.$.editor;popupButton=_parent.$.tool_panel.$.popupButton;popupButton.$on("close",sendClose);send({action:"initialized",userType:userType});scrollEl=$(".main-scroller")[0];socket=editor.api.ws;if(unprocessedMsg){var msg=unprocessedMsg;unprocessedMsg=null;onMessage(msg)}}function sendText(){var data=editor.getState(isText);data.action="edit";trackClose(data);send(data)}exports.port=port;exports.setEditor=setEditor});window.require.register("/component/page/popup2/popup-socket2.js",function(exports,module,require){module.exports=function(config){if(window.top==window)return createWs(config);var socketId,port,methods=["connect","send","close","reconnect","release","wsPause","wsPlay"],activated=false;var me=emitter({activate:activate,deactivate:deactivate});addEventListener("beforeunload",deactivate);for(var i=0;i<methods.length;i++){var m=methods[i];me[m]=send.bind(null,m)}return me;function send(method,arg){if(!socketId||!port)return;port.send({action:"socket",socketId:socketId,method:method,arg:arg})}function activate(_port,_socketId){socketId=_socketId;port=_port;if(!activated){port.on("message",onMessage);activated=true}}function deactivate(){}function onMessage(data,sender){me.emit(data.event,data.msg)}}});window.require.register("/component/page/popup2/popup2.js",function(exports,module,require){var app,me,editor,cards,status,prevMatches,cardsBg,tools;var textareaClient=require("/js/textarea-client"),config=require("/js/config"),user=require("/js/user"),integration=require("popup-integration2"),PopupSocket=require("popup-socket2");Vue.component("editor__popup2",{template:Handlebars.partials.editor__popup2(),data:{$document:{},title:"",showInitialMenu:false,uploading:false,showProgress:true,proVersion:false,user:{}},attached:function(){me=this;app=app||require("/js/app");app.isPopup=true;setTimeout(initEditor,0);trackEditorApp()},methods:{selectedMatch:selectedMatch,deselectedMatch:deselectedMatch,rendered:rendered,plagiarismChecked:plagiarismChecked,fix:fix,undo:undo,ignore:ignore,appToggled:appToggled,hookClicked:hookClicked,sending:sending,genreChanged:genreChanged,replaceSyn:replaceSyn,removeSyn:removeSyn,undoSyn:undoSyn,finish:finish},beforeDestroy:closeEditor});var trackClose=track.bind(me,"track:document-close"),trackOpen=track.bind(me,"track:document-open"),trackAlertShown=track.bind(me,"track:document-alert-shown"),trackAlertFixed=track.bind(me,"track:document-alert-fixed"),trackAlertUndo=track.bind(me,"track:document-alert-undo"),trackAlertIgnored=track.bind(me,"track:document-alert-ignored"),trackAlertRemoved=track.bind(me,"track:document-alert-removed"),trackEditorApp=track.bind(me,"track:editor-app"),trackAppToggled=track.bind(me,"track:document-app-toggled"),trackGenre=track.bind(me,"track:document-genre-changed");function track(name,value){me.$dispatch(name,value)}var lazyUpdateInterface=_.throttle(updateInterface,100),lazyLayout=_.debounce(onResize,200),lazyScroll=_.debounce(onScroll,200),lazyUpdateHeight=_.throttle(updateHeight,1e3);var $w=$(window);function initEditor(){me.proVersion=user.isPremiumUser();me.user=user.$data;cards=me.$.cards;editor=me.$.editor;status=me.$.status;tools=me.$.tool_panel;cardsBg=$(".error-container, .error-list");if(me.proVersion){tools.$.enhancement.active=true}me.doc={settings:{}};editor.create({apps:tools,type:"contenteditable",socket:PopupSocket,doc:me.doc,created:function(){module.exports=me;updateInterface();app.loaded();$(window).resize(lazyLayout);$(".main-scroller").scroll(lazyScroll);app.__editor=me;var userType=me.user&&me.user.type||"";integration.setEditor(me,userType)}})}function closeEditor(){$(window).off("resize",lazyLayout);$(".main-scroller").off("scroll",lazyScroll);cards.close();report.close();editor.exit()}function hookClicked(placement){track("track:hook-clicked",{matches:editor.getMatches(),placement:placement})}function appToggled(app){var _matches=editor.getMatches();_matches.forEach(function(m){if(m.selected)delete m.selected});editor.render();if(app.id=="Plagiarism"&&app.active)editor.checkPlagiarism();onScroll();trackAppToggled(app)}function selectedMatch(match){if($(match.getEl()).css("visibility")=="hidden")return;if(match.replaced)return;if(window.event&&window.event.type=="click"){window.event.stopPropagation()}cards.select(match,true)}function undoSyn(match){cards.toggleExpand(match.card,true)}function replaceSyn(match){editor.synonyms.removeUnderline()}function removeSyn(match){cards.deselect(match);if(!match.card)return;match.card.remove();delete match.card}function deselectedMatch(match){cards.deselect(match);cards.removeUndo()}function rendered(){lazyUpdateInterface()}function fix(){status.incFixed();trackAlertFixed()}function ignore(){trackAlertIgnored()}function plagiarismChecked(){status.unhighlight()}function undo(){status.decFixed();trackAlertUndo()}function sending(){status.highlight()}function finish(msg){status.unhighlight();updateInterface()}function onResize(){lazyUpdateHeight();var _matches=editor.getMatches();cards.updateDimensions(_matches);updateInterface()}function onScroll(){editor.generateMatchPositions();updateInterface()}function getHidden(){var matches=editor.getMatches();return _.filter(matches,function(m){return m.hidden})}function genreChanged(data){trackGenre({id:data.id});me.doc.settings.genre=data.id;editor.hardReset()}function updateInterface(){var _matches=editor.getFiltered(),_hiddenMatches=getHidden(),removed=_.difference(prevMatches,_matches),added=_.difference(_matches,prevMatches),text=editor.getText();status.update({text:text,matches:_matches,hiddenMatches:_hiddenMatches});tools.updateApps(_matches);tools.setPremiumMatches(_hiddenMatches.length);tools.calculatePlagiarism(text,_matches);editor.generateMatchPositions();cards.render(_matches,added,removed);prevMatches=_.clone(_matches);if(added.length)trackAlertShown(added.length);if(removed.length)trackAlertRemoved(removed.length)}function updateHeight(){var wH=$w.height();var gH=editor.el.clientHeight;var height=wH>gH?wH:gH+140;cardsBg.css("height",height)}});window.require.register("/component/page/profile/profile.js",function(exports,module,require){var me,user=require("/js/user"),tabs=[{link:"dictionary",description:"Personal dictionary"},{link:"language",description:"American/British"},{link:"account",description:"Account"}],defaultTab=defaultSubSection="dictionary";Vue.component("editor__profile",{template:Handlebars.partials.editor__profile(),data:{tabs:tabs},attached:function(){me=this;me.$dispatch("subview-load-start");user.fetch(false).then(function(settings){me.$dispatch("subview-load-end");me.$dispatch("track:profile");document.title="Profile";me.$broadcast("settings-update",settings)})},computed:{subView:function(){return this.$get("subSectionView")||"dictionary"}}})});window.require.register("/component/page/subscription/subscription-api.js",function(exports,module,require){var config=require("/js/config"),subscription=window.GrammarlyApi.Irbis({irbisUrl:config.IRBIS_URL});exports.cancel=function(){return subscription.cancel()};exports.renew=function(){return subscription.renew()};exports.changePlan=function(planId){return subscription.changePlan({planId:planId})};exports.generateTokens=function(){var paypalLinks=_generatePaypalLinks();return $.when(subscription.generateTokenCreditCard(),subscription.generateTokenPaypal(paypalLinks))};function _generatePaypalLinks(){var origin,url={};origin=document.location.protocol+"//"+document.location.host+document.location.pathname.replace(/\/$/,"");url.cancelUrl=origin+"?paypal=error";url.returnUrl=origin+"?paypal=ok";return url}exports.createBraintreeSender=function(cb){return function(paymentData,tokenData){var client=new braintree.api.Client({clientToken:tokenData.token});client.tokenizeCard({number:paymentData.number,cvv:paymentData.cvv,expiration_month:paymentData.cc_exp_mm,expiration_year:paymentData.cc_exp_yyyy},cb)}};exports.generateCardToken=function(){return subscription.generateTokenCreditCard()};exports.generatePaypalToken=function(planId){return subscription.generateTokenPaypal(_generatePaypalLinks.call(null,planId))};exports.generateRequestToken=function(token,isValid){var isNonEmptyObject=function(res){return res&&Object.keys(res)>0};var promise=$.Deferred();var retryCounter=0;function requestRetry(){retryCounter++;setTimeout(requestToken,retryCounter*500,token)}function requestToken(token){if(retryCounter<10){subscription.getTokenRequest(token).then(function(res){if(isValid&&isValid(res)||isNonEmptyObject(res)){promise.resolve(res)}else requestRetry()}).fail(requestRetry)}else{promise.reject("getTokenRequest failed")}}requestToken(token);return promise};exports.getPaymentProfile=function(){return subscription.status()};exports.subscribeCard=function(data){return subscription.subscribeCard(data)};exports.updateCard=function(data){return subscription.updateCreditcard(data)};exports.updatePaypal=function(data){return subscription.updatePaypal(data)};exports.subscribePaypal=function(data){return subscription.subscribePaypal(data)}});window.require.register("/component/page/subscription/subscription.js",function(exports,module,require){var app=require("/js/app"),user=require("/js/user"),config=require("/js/config"),route=require("/js/route"),isMobile=require("/component/common/util/mobile"),subscription=require("/component/page/subscription/subscription-api"),tabs=[{link:"summary",description:"Summary"},{link:"manage",description:"Manage subscription"},{link:"billing",description:"Edit billing information"}],defaultSubSection,defaultTab=defaultSubSection="summary",proofit_notification=require("/component/editor/subscription/proofit_notification/proofit_notification");module.exports=Vue.component("editor__subscription",{template:Handlebars.partials.editor__subscription(),data:{isMobile:isMobile(window.navigator.userAgent),tabs:tabs,selectedMethod:"creditCard",subscriptionData:{},proofitData:{},disabled:false,tokens:{paypal:false,creditcard:false},notification:{}},computed:{selectedTab:function(){return this.getCurrentTab()},subView:function(){var subSection=this.getCurrentSubView("view");return"editor__subscription_"+subSection},nonePayMethod:function(){if(!_.size(this.subscriptionData))return false;var payMethod=this.subscriptionData.paymentMethod;return payMethod=="none"},nextBillingMethodLabel:function(){if(!_.size(this.subscriptionData))return false;var payMethod=this.subscriptionData.paymentMethod,label="Grammarly account";if(payMethod=="creditCard")label="credit card";if(payMethod=="payPal")label="PayPal account";return label},subscriptionSubSectionView:function(){return this.$get("subSectionView")||"summary"},isDiscount:function(){if(!_.size(this.subscriptionData)||!this.subscriptionData.currentPlan)return false;var currPrice=this.subscriptionData.currentPlan.price,nextPaymentPrice=this.subscriptionData.currentPlan.nextPaymentPrice;return nextPaymentPrice&&currPrice!=nextPaymentPrice},isUserReferral:function(){var currentPlan={};if(!_.size(this.subscriptionData)||!this.subscriptionData.currentPlan)return false;var currentPlan=this.subscriptionData.currentPlan;return currentPlan&&currentPlan.title.toLowerCase().indexOf("referral")>-1}},methods:{fetch:function(){return $.when(subscription.getPaymentProfile(),subscription.generateTokens())},getCurrentTab:function(){var currentTab=this.$get("subSectionView")||defaultTab;if(this.$get("subSectionView")=="cancel"){currentTab="manage"}else if(this.$get("subSectionView")=="cancelled"){currentTab="summary"}return currentTab},getCurrentSubView:function(){var currentSubView=this.$get("subSectionView")||defaultSubSection;if(this.$get("subSectionView")=="cancelled"||this.$get("subscriptionData.status.isSuspended")){currentSubView="summary"}return currentSubView},isEmptyCurrentPlan:function(){return!!this.subscriptionData.currentPlan},filterTabs:function(data){data.isSuspended||data.isCancelled?this.$set("tabs",[]):this.$set("tabs",tabs)},changeTab:function(event,link){var data=this.$get("subscriptionData");if(_.size(this.notification)&&event)this.notification={};if(link=="summary")isNotificationShow.call(this,data);if(link=="manage")mobileCancelletionMessage.call(this)},processing:function(subscription,proofit,tokens){var proofitData=proofit?proofit[0]:undefined,processedData=_.isArray(subscription)?subscription[0]:subscription;return $.Deferred().resolve(processedData,proofitData,tokens)},redirect:function(subscription,proofit,tokens){var Def=$.Deferred();if(user.isFreebie()||!subscription.isPremium)return route.toIndex();Def.resolve(subscription,proofit,tokens);return Def},reflow:function(subscriptionData,proofitData,tokens){if(!subscriptionData)return;this.subscriptionData=subscriptionData;if(subscriptionData&&subscriptionData.paymentMethod&&subscriptionData.paymentMethod!=="none")this.selectedMethod=subscriptionData.paymentMethod;if(proofitData)this.proofitData=proofitData;this.filterTabs(this.subscriptionData);this.tokens.creditcard=tokens?tokens[0].requestId:false;this.tokens.paypal=tokens?tokens[1].requestId:false;isNotificationShow.call(this,subscriptionData)},showNotification:function(data){this.notification=data},fetchAndReflow:function(){var me=this;var reflow=this.reflow.bind(me);this.$dispatch("subview-load-start");this.fetch().then(this.processing).then(this.redirect).done(reflow).always(function(data){me.$dispatch("subview-load-end","subscription");changeUrl()})}},components:{"subscription:proofit-notification-summary":proofit_notification.summary,"subscription:proofit-notification-cancel":proofit_notification.cancel},filters:{date:function(val){var date=new Date(val);if(!(date instanceof Date&&isFinite(date)))return;var month=date.getMonth(),day=date.getDate(),year=date.getFullYear(),monthsList=["January","February","March","April","May","June","July","August","September","October","November","December"];return monthsList[month]+"&nbsp;"+day+",&nbsp;"+year},period:function(value){if(/month/gi.test(value))return"month";else if(/quart/gi.test(value))return"quarter";else if(/annual|year/gi.test(value))return"year";else return value},sortPlans:function(plans){var me=this;if(!plans)return;return plans.sort(function(a,b){if(!me.queuedPlan)return 0;if(a.title==me.$get("queuedPlan.title"))return-1;else if(b.title==me.$get("queuedPlan.title"))return 1;return 0}).sort(function(a,b){if(a.title==me.$get("currentPlan.title"))return-1;else if(b.title==me.$get("currentPlan.title"))return 1;return 0})},planTitle:function(planName){if(this.$get("currentPlan")&&this.$get("currentPlan.title")==planName)return"Current plan";if(this.$get("queuedPlan")&&this.$get("queuedPlan.title")==planName)return"Queued plan"},planName:function(value){if(/month/gi.test(value))return"Monthly";else if(/quart/gi.test(value))return"Quarterly";else if(/annual|year/gi.test(value))return"Annual"},planType:function(planName){var planType="";if(/month/i.test(planName))planType="1-month Grammarly Subscription";if(/quater|quart/i.test(planName))planType="3-month Grammarly Subscription";if(/annu|year/i.test(planName))planType="1-year Grammarly Subscription";return planType},encodeURI:function(value){return encodeURI(value)},saveInMonth:function(value){if(!this.$get("plans").length)return;var plans=this.$get("plans"),monthlyPlan=_.find(plans,function(plan){return/month/i.test(plan.title)})||{},monthlyPrice=monthlyPlan["price"];if(!monthlyPrice){var plan=plans[0];return(plan.regularPrice/plan.periodMonths-value).toFixed(2)}return monthlyPrice-value},monthPrice:function(price,plan){if(!price)return;var planName=this.$get(plan);return calculateMonthPrice(price,planName)}},directives:{"loading-button":function(){this.vm.$data["loading"]=false},"selected-class":function(name){var me=this.vm,currentPlan=me.$get("currentPlan"),queuedPlan=me.$get("queuedPlan");if(name==currentPlan.title)this.el.classList.add("selected")},"save-percent":function(plans){if(!plans.length)return;var me=this.vm,monthlyPlan,filterPlans,maxPlan,maxPlanPerMonth,monthlyPrice,savePercent,queued=me.$get("queuedPlan"),current=me.$get("currentPlan");monthlyPlan=_.find(plans,function(plan){return/month/i.test(plan.title)})||{};filterPlans=plans.filter(function(plan){if(!queued)return true;return queued.title!=plan.title}).filter(function(plan){return current.title!=plan.title&&!/month/i.test(plan.title)});maxPlan=_.min(filterPlans,function(plan){return parseInt(plan.price)});monthlyPrice=monthlyPlan.price||29;maxPlanPerMonth=calculateMonthPrice(maxPlan.price,maxPlan.title);savePercent=Math.floor(maxPlanPerMonth/monthlyPrice*10)*10;this.el.innerHTML="Save up&nbsp;to&nbsp;"+savePercent+"%"},"save-plans":function(plans){if(!plans.length)return;var me=this.vm,plansDescribe,queued=me.$get("queuedPlan"),current=me.$get("currentPlan");plansDescribe=plans.filter(function(plan){if(!queued)return true;return queued.title!=plan.title}).filter(function(plan){return current.title!=plan.title&&!/month/i.test(plan.title)}).reduce(function(prev,plan,index){if(index>0)prev+="&nbsp;or&nbsp;";return prev+=/year/i.test(plan.title)?"Annual":plan.title}," ");this.el.innerHTML=plansDescribe},"save-container":function(arg){var vm=this.vm,classList=this.el.classList,current=arg[0]&&arg[0].title,queued=arg[1]&&arg[1].title,isSuspended=vm.$get("status.isSuspended"),isAnnual=/year|annual/i.test(current)||/year|annual/i.test(queued);if(!isAnnual&&!isSuspended)classList.add("show");else classList.add("hide")}},created:function(){var me=this;if(isTokenExist())subscription.updatePaypal({payPalToken:getQueryParam("token")}).always(this.fetchAndReflow.bind(this));else this.fetchAndReflow();this.$on("notification:show",this.showNotification.bind(this));this.$on("subscription:reflow",this.fetchAndReflow);this.$dispatch("track:subscription")},ready:function(){},attached:function(){this.$dispatch("subview-load-start");document.title="Subscription"}});function calculateMonthPrice(price,plan){var monthlyPrice=null;if(/month/i.test(plan))monthlyPrice=price;else if(/quater|quart/i.test(plan))monthlyPrice=price/3;else if(/year|annual/i.test(plan))monthlyPrice=price/12;return monthlyPrice}function isNotificationShow(data){var now=new Date,year=now.getFullYear(),month=now.getMonth()+1;var indunning=data.isDunning;var isPaymentMethodFailed=data.isPaymentMethodFailed;var isCardExpireSoon=data.creditCard&&year==data.creditCard.expirationYear&&month==data.creditCard.expirationMonth;if(isCardExpireSoon&&!data.isCancelled)cardExpire.call(this);if(indunning&&!isPaymentMethodFailed)inDunningCorrect.call(this);else if(indunning)inDunning.call(this);if(isUrlPaypal()){showPaypalNotification.call(this)}deletePaypalCookie()}function isUrlPaypal(){var url=document.location.search.replace("?","").split("=");return url[0]=="paypal"}function isPaypalCookie(){return $.cookie("method")==="paypal"}function deletePaypalCookie(){return $.removeCookie("method",{domain:".grammarly.com",expires:1,path:"/"})}function cardExpire(){this.showNotification({className:"fail",type:"expire_soon"})}function showPaypalNotification(){if(isPaypalOk())this.showNotification({className:"info",type:"paypal"});if(isPaypalError())this.showNotification({className:"fail",type:"paypal_error"})}function getQueryParam(val){var queryParams=document.location.search.split("&");return queryParams.filter(function(el){return el.indexOf(val)>-1}).reduce(function(prev,curr){return curr.split("=")[1]},"")}function isPaypalOk(){return getQueryParam("paypal")=="ok"}function isPaypalError(){return getQueryParam("paypal")=="error"}function inDunning(){this.showNotification({className:"info",type:"dunning_card"})}function inDunningCorrect(){this.showNotification({className:"success",type:"527"})}function isTokenExist(){return getQueryParam("token").length}function mobileCancelletionMessage(){if(!this.isMobile)return false;this.showNotification({className:"info",type:"mobile_cancel"})}function changeUrl(){var loc=document.location;history.pushState("","",loc.pathname+loc.search)}});window.require.register("/component/page/util/directives.js",function(exports,module,require){module.exports=function(){var route=require("/js/route");Vue.directive("href",{update:function(value){var state=this.key,href=route.url(state);$(this.el).attr("href",href)}})}()});window.require.register("/custom/phoenix/genres/genres.config.js",function(exports,module,require){var genres=[{id:"general",name:"General"},{id:"academic",name:"Academic",sub:[{name:"General academic (default)",id:"academic_general"},{name:"Essay",id:"academic_essay"},{name:"Report",id:"academic_report"},{name:"Case study",id:"academic_case"},{name:"Book/literature review",id:"academic_review"},{name:"Research proposal",id:"academic_proposal"},{name:"Research results",id:"academic_results"},{name:"Dissertation",id:"academic_disser"},{name:"Admission letter",id:"academic_letter"}]},{id:"business",name:"Business",sub:[{id:"business_other",name:"General business"},{id:"business_letter",name:"Business letter"},{id:"business_email",name:"Business email"},{id:"business_report",name:"Report"},{id:"business_memo",name:"Memo"},{id:"business_proposal",name:"Proposal"},{id:"business_article",name:"Article/blog post"},{id:"business_adv",name:"Ad/website copy"}]},{id:"technical",name:"Technical",sub:[{name:"General technical",id:"technical_other"},{name:"End-user assistance document",id:"technical_manual",tooltip:"Various types of technical user manuals"},{name:"Technical documentation",id:"technical_documentation",tooltip:"Specifications, repair guides, technical articles"},{name:"Marketing document",id:"technical_marketing",tooltip:"Brochures, product catalogs"}]},{id:"medical",name:"Medical",sub:[{name:"General medical",id:"medical_other"},{name:"Regulatory writing",id:"medical_regulatory",tooltip:"Clinical study protocols, reports, consent forms"},{name:"Educational writing",id:"medical_educational",tooltip:"Healthcare marketing literature and presentations"}]},{id:"creative",name:"Creative",sub:[{id:"creative_other",name:"General creative"},{id:"creative_nonfiction",name:"Creative non-fiction"},{id:"creative_novel",name:"Novel"},{id:"creative_script",name:"Script"},{id:"creative_story",name:"Short story"}]},{id:"casual",name:"Casual",sub:[{id:"casual_other",name:"General casual"},{id:"casual_email",name:"Personal email"},{id:"casual_blog",name:"Personal blog post"}]}];
module.exports=genres});window.require.register("/custom/phoenix/genres/genres.js",function(exports,module,require){var model=require("/component/editor/tool/checks/genres/genres"),genres=require("/custom/phoenix/genres/genres.config");Vue.component("editor:tool-genres",model.extend({data:{genres:genres,current:"academic_general"}}))});window.require.register("/custom/phoenix/menu/menu.js",function(exports,module,require){var model=require("/component/editor/tool/menu/menu");Vue.component("editor:tool-menu",model.extend({template:Handlebars.partials.editor__phoenix__tool_menu(),data:{supportUrl:"https://ecampus.phoenix.edu/common/contactus/reportProblem.jsp",writingHelpUrl:"https://portal.phoenix.edu/social/community/support/writing"}}))});window.require.register("/custom/phoenix/page/index/index.js",function(exports,module,require){var model=require("/component/page/index/index");Vue.component("editor__index",model.extend({template:Handlebars.partials.editor__phoenix_index()}))});window.require.register("/custom/phoenix/phoenix.js",function(exports,module,require){module.exports=function(){require("/custom/phoenix/**/*.js");$("body").addClass("phoenix");overrideTemplates()};function overrideTemplates(){Handlebars.partials.tour_new_user__container=Handlebars.partials.tour_new_user__container__phoenix;Handlebars.partials.tour_old_user__container=Handlebars.partials.tour_old_user__container_phoenix;Handlebars.partials.tutorial_container=Handlebars.partials.tutorial_container__phoenix}});window.require.register("/custom/phoenix/popup-cancelled/popup-cancelled.js",function(exports,module,require){var model=require("/component/editor/proofit/popup-cancelled/popup-cancelled");Vue.component("editor:proofit-cancelled",model.extend({data:{supportUrl:"https://ecampus.phoenix.edu/common/contactus/reportProblem.jsp"}}))});window.require.register("/custom/phoenix/report-button/report-button.js",function(exports,module,require){var model=require("/component/editor/report-button/report-button");Vue.component("editor:report-button",model.extend({template:Handlebars.partials.editor__phoenix_report_button()}))});window.require.register("/custom/phoenix/terms/terms.js",function(exports,module,require){var user=require("/js/user");Vue.component("editor:terms-of-service",Vue.extend({template:Handlebars.partials.editor__terms_of_service_dialog(),replace:true,data:{visible:false},created:function(){var userInfo=user.$data;var settings=userInfo.settings;this.$set("visible",!settings.acceptedTerms)},methods:{accept:function(){user.setSettings({acceptedTerms:true});this.$set("visible",false)}}}))});window.require.register("/js/superfasthash/index.js",function(exports,module,require){"use strict";var util=require("./util");function getU16Int(u8IntArray,index){return u8IntArray[index]<<8|u8IntArray[index+1]}function hash(inputString){var u8IntArray=util.toU8IntArray(inputString+"");var hash=0;var tmp;var rem;if(!inputString){return hash.toString(16)}var len=u8IntArray.length;var pointer=0;rem=len&3;len>>>=2;for(var i=0;i<len;i++){hash+=getU16Int(u8IntArray,pointer);tmp=getU16Int(u8IntArray,pointer+2)<<11^hash;hash=hash<<16^tmp;pointer+=4;hash+=hash>>11}switch(rem){case 3:hash+=getU16Int(u8IntArray,pointer);hash^=hash<<16;hash^=u8IntArray[pointer+2]<<18;hash+=hash>>11;break;case 2:hash+=getU16Int(u8IntArray,pointer);hash^=hash<<11;hash+=hash>>17;break;case 1:hash+=u8IntArray[pointer];hash^=hash<<10;hash+=hash>>1;break}hash^=hash<<3;hash+=hash>>5;hash^=hash<<4;hash+=hash>>17;hash^=hash<<25;hash+=hash>>6;return util.intToUnsignedHex(hash)}module.exports={hash:hash}});window.require.register("/js/superfasthash/util.js",function(exports,module,require){function toU8IntArray(inputString){var array=[];var tempArrayOfChar=[];for(var i=0;i<inputString.length;i++){var charCode=inputString.charCodeAt(i);var temp;tempArrayOfChar.length=0;while((temp=charCode&255)||charCode){tempArrayOfChar.push(temp);charCode>>>=8}array=array.concat(tempArrayOfChar.reverse())}return array}function intToUnsignedHex(number){var temp;var hexArray=[];while((temp=number&65535)||number){temp=temp.toString(16);temp="0000".slice(temp.length)+temp;hexArray.push(temp);number>>>=16}return hexArray.reverse().join("")}module.exports={toU8IntArray:toU8IntArray,intToUnsignedHex:intToUnsignedHex}});window.require.register("/js/index.js",function(exports,module,require){});